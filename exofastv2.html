<!-- This file was generated by mk_html_help.pro -->
<html>
 
<head>
<TITLE>Extended IDL Help</TITLE>
</head>
 
<body>
<H1>Extended IDL Help</H1>
<P>
This page was created by the IDL library routine 
<CODE>mk_html_help</CODE>.  For more information on 
this routine, refer to the IDL Online Help Navigator 
or type: <P>
<PRE>     ? mk_html_help</PRE><P>
at the IDL command line prompt.<P>
<STRONG>Last modified: </STRONG>Fri Jun 25 09:51:24 2021.<P>
 
<HR>
 
<A NAME="ROUTINELIST">
<H1>List of Routines</H1></A>
<UL>
<LI><A HREF="#"></A>
<LI><A HREF="#ANGSEP">ANGSEP</A>
<LI><A HREF="#BJD2TARGET">BJD2TARGET</A>
<LI><A HREF="#CALCB[1]">CALCB[1]</A>
<LI><A HREF="#CALCB[2]">CALCB[2]</A>
<LI><A HREF="#COMPARESTARS">COMPARESTARS</A>
<LI><A HREF="#CONVERT_TRANSIT_TIMES">CONVERT_TRANSIT_TIMES</A>
<LI><A HREF="#CROSSREF">CROSSREF</A>
<LI><A HREF="#ELLKE">ELLKE</A>
<LI><A HREF="#ELLPIC_BULIRSCH">ELLPIC_BULIRSCH</A>
<LI><A HREF="#EXOFAST">EXOFAST</A>
<LI><A HREF="#EXOFASTV2">EXOFASTV2</A>
<LI><A HREF="#EXOFAST_AMOEBA">EXOFAST_AMOEBA</A>
<LI><A HREF="#EXOFAST_ASTROM">EXOFAST_ASTROM</A>
<LI><A HREF="#EXOFAST_BLACKBODY">EXOFAST_BLACKBODY</A>
<LI><A HREF="#EXOFAST_CHI2">EXOFAST_CHI2</A>
<LI><A HREF="#EXOFAST_DEMC">EXOFAST_DEMC</A>
<LI><A HREF="#EXOFAST_ERRELL">EXOFAST_ERRELL</A>
<LI><A HREF="#EXOFAST_GELMANRUBIN">EXOFAST_GELMANRUBIN</A>
<LI><A HREF="#EXOFAST_GETB">EXOFAST_GETB</A>
<LI><A HREF="#EXOFAST_GETB2">EXOFAST_GETB2</A>
<LI><A HREF="#EXOFAST_GETMCMCSCALE">EXOFAST_GETMCMCSCALE</A>
<LI><A HREF="#EXOFAST_GETPHASE">EXOFAST_GETPHASE</A>
<LI><A HREF="#EXOFAST_GETTC">EXOFAST_GETTC</A>
<LI><A HREF="#EXOFAST_GETTT[1]">EXOFAST_GETTT[1]</A>
<LI><A HREF="#EXOFAST_GETTT[2]">EXOFAST_GETTT[2]</A>
<LI><A HREF="#EXOFAST_KEPLEREQ">EXOFAST_KEPLEREQ</A>
<LI><A HREF="#EXOFAST_LATEXTAB[1]">EXOFAST_LATEXTAB[1]</A>
<LI><A HREF="#EXOFAST_LATEXTAB[2]">EXOFAST_LATEXTAB[2]</A>
<LI><A HREF="#EXOFAST_LIKE">EXOFAST_LIKE</A>
<LI><A HREF="#EXOFAST_MULTIPLOT">EXOFAST_MULTIPLOT</A>
<LI><A HREF="#EXOFAST_OCCULTQUAD">EXOFAST_OCCULTQUAD</A>
<LI><A HREF="#EXOFAST_OCCULTQUAD_CEL">EXOFAST_OCCULTQUAD_CEL</A>
<LI><A HREF="#EXOFAST_PLOTDIST_CORNER">EXOFAST_PLOTDIST_CORNER</A>
<LI><A HREF="#EXOFAST_QUERYVIZIER">EXOFAST_QUERYVIZIER</A>
<LI><A HREF="#EXOFAST_RANDOM">EXOFAST_RANDOM</A>
<LI><A HREF="#EXOFAST_RECENTER">EXOFAST_RECENTER</A>
<LI><A HREF="#EXOFAST_ROSSITER">EXOFAST_ROSSITER</A>
<LI><A HREF="#EXOFAST_RV">EXOFAST_RV</A>
<LI><A HREF="#EXOFAST_TEXTOIDL[1]">EXOFAST_TEXTOIDL[1]</A>
<LI><A HREF="#EXOFAST_TEXTOIDL[2]">EXOFAST_TEXTOIDL[2]</A>
<LI><A HREF="#EXOFAST_TRAN">EXOFAST_TRAN</A>
<LI><A HREF="#EXOFAST_TWILIGHT">EXOFAST_TWILIGHT</A>
<LI><A HREF="#GETAVPRIOR">GETAVPRIOR</A>
<LI><A HREF="#GETBURNNDX">GETBURNNDX</A>
<LI><A HREF="#GOLDENRATIO">GOLDENRATIO</A>
<LI><A HREF="#JSON_PARSE">JSON_PARSE</A>
<LI><A HREF="#KTOM2">KTOM2</A>
<LI><A HREF="#LEGEND">LEGEND</A>
<LI><A HREF="#LINLD">LINLD</A>
<LI><A HREF="#MASSRADIUS_MIST[1]">MASSRADIUS_MIST[1]</A>
<LI><A HREF="#MASSRADIUS_MIST[2]">MASSRADIUS_MIST[2]</A>
<LI><A HREF="#MASSRADIUS_MIST[3]">MASSRADIUS_MIST[3]</A>
<LI><A HREF="#MASSRADIUS_TORRES">MASSRADIUS_TORRES</A>
<LI><A HREF="#MKCONSTANTS">MKCONSTANTS</A>
<LI><A HREF="#MKPRIOR">MKPRIOR</A>
<LI><A HREF="#MKSED">MKSED</A>
<LI><A HREF="#OMC">OMC</A>
<LI><A HREF="#PARS2STR">PARS2STR</A>
<LI><A HREF="#PLOTIMAGE">PLOTIMAGE</A>
<LI><A HREF="#QUADLD">QUADLD</A>
<LI><A HREF="#READIPAC">READIPAC</A>
<LI><A HREF="#SETDEFAULTVALUE">SETDEFAULTVALUE</A>
<LI><A HREF="#SPLITPDF">SPLITPDF</A>
<LI><A HREF="#STROM_CONV[1]">STROM_CONV[1]</A>
<LI><A HREF="#STROM_CONV[2]">STROM_CONV[2]</A>
<LI><A HREF="#TEXTOIDL_MATCHDELIM">TEXTOIDL_MATCHDELIM</A>
<LI><A HREF="#TEXTOIDL_NEXTTOK">TEXTOIDL_NEXTTOK</A>
<LI><A HREF="#TEXTOIDL_STRCNT">TEXTOIDL_STRCNT</A>
<LI><A HREF="#TEXTOIDL_STRTOK">TEXTOIDL_STRTOK</A>
<LI><A HREF="#TEXTOIDL_STRTRANS">TEXTOIDL_STRTRANS</A>
<LI><A HREF="#TEXTOIDL_SUB_SUP">TEXTOIDL_SUB_SUP</A>
<LI><A HREF="#TEXTOIDL_TABLE">TEXTOIDL_TABLE</A>
<LI><A HREF="#TEXTOIDL_TRANS_SUB_SUPER">TEXTOIDL_TRANS_SUB_SUPER</A>
<LI><A HREF="#TRANSITGIF">TRANSITGIF</A>
<LI><A HREF="#UPDATETIME">UPDATETIME</A>
<LI><A HREF="#WAVELETLIKE">WAVELETLIKE</A>
<LI><A HREF="#WEBGET()">WEBGET()</A>
</UL><P>
 
<HR>
 
<H1>Routine Descriptions</H1>
<A NAME="">
<H2></H2></A>
<A HREF="#ANGSEP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:

  pg_ran

 PURPOSE:

 generates uniform random numbers

 CATEGORY:

 numeric utils

 CALLING SEQUENCE:

 data=pg_ran(seed,n)

 INPUTS:

 n: number of uniform random deviates to produce

 OPTIONAL INPUTS:

 seed: seed for the random number generator. Input is either a scalar integer
       or an array of 3 UL64 integers. The internal seed of the routine is the
       array of 3 UL64 integers.

 KEYWORD PARAMETERS:

 double: if set, output is double precision instead of ulong64

 OUTPUTS:

 data: a set of ulong64 integers, uniformly randomly distributed
       between 0ULL and 2ULL^64-1
       (if keyword /double is set - doubles between 0d and 1d will
       be returned instead)

 OPTIONAL OUTPUTS:

 seed: the seed to be used to get the next number in the sequence.
       It's an array of 3 L64 integers.

 none

 COMMON BLOCKS:

 none

 SIDE EFFECTS:

 none

 RESTRICTIONS:



 PROCEDURE:

 IDL implementation of the routine "ran" of numerical
 recipes 3d edition (page 342). This is a high quality
 random generator with a period of ~ 3.138x10^57.

 EXAMPLE:


 seed=17
 print,pg_ran(seed,10)
    269952321389814056
   7477734313819993120
  16294976781531816119
  17039904789424739738
   4945048831639962635
   1565409385732501729
   7095006703038622919
  13927236388846696772
    150171266583137103
   8092874815854888167
 seed=17
 print,pg_ran(seed,10,/double),format='(d17.15)'
     0.014634144665917
     0.405368789415652
     0.883352461356882
     0.923735089582023
     0.268071634315548
     0.084861012842019
     0.384621084061685
     0.754996997475338
     0.008140800673717
     0.438715622850155
     

 MODIFICATION HISTORY:

 2008 Paolo C. Grigis written
 07-AUG-2009 Paolo C. Grigis updated documentation
 12-NOV-2009 PG added /double keyword 
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/pg_ran.pro)</STRONG><P>
<HR>
 
<A NAME="ANGSEP">
<H2>ANGSEP</H2></A>
<A HREF="#">[Previous Routine]</A>
<A HREF="#BJD2TARGET">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
  angsep
 PURPOSE:
  Compute the angular distance between two spherical coordinates.
 DESCRIPTION:

 CATEGORY:
  Mathematical
 CALLING SEQUENCE:
  ans=angsep(ra1,dec1,ra2,dec2)

 INPUTS:
  ra1  - RA of first position (radians)
  dec1 - Dec of first position (radians)
  ra2  - RA of second position (radians)
  dec2 - Dec of second position (radians)

 OPTIONAL INPUT PARAMETERS:

 KEYWORD INPUT PARAMETERS:

 OUTPUTS:
  return value is the angular distance in radians.

 KEYWORD OUTPUT PARAMETERS:

 COMMON BLOCKS:

 SIDE EFFECTS:

 RESTRICTIONS:

 PROCEDURE:

 MODIFICATION HISTORY:
  Written by Marc W. buie, Lowell Observatory, 1997/09/08
  2009/02/26, MWB, added protection against round off error generating NaN
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/angsep.pro)</STRONG><P>
<HR>
 
<A NAME="BJD2TARGET">
<H2>BJD2TARGET</H2></A>
<A HREF="#ANGSEP">[Previous Routine]</A>
<A HREF="#CALCB[1]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   BJD2TARGET
 PURPOSE:
   Iteratively calls TARGET2BJD to convert a BJD in Barycentric
   Dynamical Time (BJD_TDB) to a BJD in the target barycenter
   time (BJD_TARGET) within TOL days.

 DESCRIPTION:
   The opposite of TARGET2BJD; see description there.

 INPUTS:
   BJD_TDB     - A scalar or array of BJDs in TDB. Must be double
                 precision.
   INCLINATION - The inclination of the orbit
   A           - The semi-major axis of the orbit (AU)
   TP          - The time of periastron of the orbit (BJD_TARGET)
   PERIOD      - The period of the orbit (days)
   E           - Eccentricity of the orbit
   OMEGA       - Argument of Periastron of the orbit (radians)
   
 OPTIONAL INPUTS:
   Q          - The mass ratio of the targets (M1/M2). If not
                specified, an infinite mass ratio is assumed (M1 is
                stationary at the barycenter) (8 ms effect for Hot
                Jupiters).
   TOL        - The tolerance, in days. The iterative procedure will
                stop after the worst-case agreement is better than this.
                Default = 1d-8 (1 ms).

 OPTIONAL KEYWORDS:
   PRIMARY    - If set, the information comes from the position of
                the primary (as in RV), and therefore the correction
                will be the light travel time from the center of the
                primary to the Barycenter -- analagous to the
                difference between HJD and BJD in our solar system
                (only ~8 ms for Hot Jupiters, but increasing with a).    
                Otherwise, the correction will be the light
                travel time from the smaller body to the barycenter
                (as in transits) -- analagous to the difference
                between JD and BJD in the Solar System.

                NOTE: if Q is not specified and PRIMARY is, no
                correction is applied.

 OUTPUTS:
   BJD_TARGET - The time as it would flow in the Barycenter of the target.

 LIMITATIONS:
   We ignore the distance to the object (plane parallel waves), which
   should have a similar effect as the distance plays in the BJD
   correction (< 1 ms). We also ignore the systemic velocity, which
   will compress/expand the period by a factor gamma/c.

 REVISION HISTORY:
 2011/06: Written by Jason Eastman (OSU)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/bjd2target.pro)</STRONG><P>
<HR>
 
<A NAME="CALCB[1]">
<H2>CALCB[1]</H2></A>
<A HREF="#BJD2TARGET">[Previous Routine]</A>
<A HREF="#CALCB[2]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   CALCB

 PURPOSE: 
   Calculates the impact parameter of a given time. The function to minimize

   Implementation translated from here:
   https://en.wikipedia.org/wiki/Golden-section_search

 CALLING SEQUENCE:
    min = goldenratio('func', min, max)

 INPUTS:

    FUNC - A string specifying the name of the function to be
           minimized
    A    - The minimum bound on the function to be minimized
    B    - The maximum bound on the function to be minimized

 RESULT:

    The minimum value

 MODIFICATION HISTORY
 
  2018/11/13 -- Written by Jason Eastman, CfA

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast.gettt.bak.pro)</STRONG><P>
<HR>
 
<A NAME="CALCB[2]">
<H2>CALCB[2]</H2></A>
<A HREF="#CALCB[1]">[Previous Routine]</A>
<A HREF="#COMPARESTARS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   CALCB

 PURPOSE: 
   Calculates the impact parameter of a given time. The function to minimize

   Implementation translated from here:
   https://en.wikipedia.org/wiki/Golden-section_search

 CALLING SEQUENCE:
    min = goldenratio('func', min, max)

 INPUTS:

    FUNC - A string specifying the name of the function to be
           minimized
    A    - The minimum bound on the function to be minimized
    B    - The maximum bound on the function to be minimized

 RESULT:

    The minimum value

 MODIFICATION HISTORY
 
  2018/11/13 -- Written by Jason Eastman, CfA

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_gettt.pro)</STRONG><P>
<HR>
 
<A NAME="COMPARESTARS">
<H2>COMPARESTARS</H2></A>
<A HREF="#CALCB[2]">[Previous Routine]</A>
<A HREF="#CONVERT_TRANSIT_TIMES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   COMPARESTARS

 PURPOSE: 
   Compares the stellar parameters of several different fits using
   the IDL save files as output by exofastv2.pro.

 CALLING SEQUENCE:
   comparestars, 'savpath' [,TAGS=,PSNAME=]

 INPUTS:
   SAVPATH - A string resolved by file_search to specify the names of
             all the idl save files to compare.
   TAGS    - A string array specifying the tagnames (parameters) to
             compare. Default is 
             ['mstar','rstar','rhostar','logg','teff','feh','initfeh','age','lstar','eep']
   PSNAME  - A string specifying the name of the postscript file to
             output. If not specified, the plots are made to the screen.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/comparestars.pro)</STRONG><P>
<HR>
 
<A NAME="CONVERT_TRANSIT_TIMES">
<H2>CONVERT_TRANSIT_TIMES</H2></A>
<A HREF="#COMPARESTARS">[Previous Routine]</A>
<A HREF="#CROSSREF">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 KEYWORDS:
    By default, the code will convert from time of inferior
    conjunction to time of minimum projected separation. The
    following keywords can change the inputs and outputs.

    TS_IN - Time of superior conjunction is the input time, time of
            minimum projected separation at secondary eclipse is the
            output
    TE_IN - Time of minimum projected separation at secondary eclipse
            is the input, time of superior conjunction is the output.
    TT_IN - Time of minimum rojected separation at primary eclipse
            is the input, time of inferior conjunction is the output.

    Given one time, eccentricity, inclination, omega, and period, we
    will return all other times:
       TC - Time of inferior conjunction, commonly reported as the
            transit time
       TT - Time of minimum projected separation. This is the
            intuitive definition of the transit time.
       TS - Time of superior conjunction, commonly reported as the
            secondary ecclipse time
       TE - The time of minimum projected separation during secondary
            eclipse.
       TP - Time of periastron
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/convert_transit_times.pro)</STRONG><P>
<HR>
 
<A NAME="CROSSREF">
<H2>CROSSREF</H2></A>
<A HREF="#CONVERT_TRANSIT_TIMES">[Previous Routine]</A>
<A HREF="#ELLKE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   CROSSREF
 PURPOSE:
     Finds the closest match to refra and refdec from an array of RAs
     and Decs.
 Modification 
    2018-04-12: Jason Eastman, CfA
                Renamed, documented, and cleaned up for distribution with EXOFASTv2

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mksed.pro)</STRONG><P>
<HR>
 
<A NAME="ELLKE">
<H2>ELLKE</H2></A>
<A HREF="#CROSSREF">[Previous Routine]</A>
<A HREF="#ELLPIC_BULIRSCH">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   ELLKE

 PURPOSE: 
   Computes Hasting's polynomial approximation for the complete 
   elliptic integral of the first (ek) and second (kk) kind. Combines
   the calculation of both so as not to duplicate the expensive
   calculation of alog10(1-k^2).

 CALLING SEQUENCE:
    ellke, k, ek, kk

 INPUTS:

    k - The elliptic modulus.

 OUTPUTS:

    ek - The elliptic integral of the first kind
    kk - The elliptic integral of the second kind

 MODIFICATION HISTORY
 
  2009/04/06 -- Written by Jason Eastman (Ohio State University)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/ellke.pro)</STRONG><P>
<HR>
 
<A NAME="ELLPIC_BULIRSCH">
<H2>ELLPIC_BULIRSCH</H2></A>
<A HREF="#ELLKE">[Previous Routine]</A>
<A HREF="#EXOFAST">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   ELLPIC_BULIRSCH

 PURPOSE: 
   Computes the complete elliptical integral of the third kind using
   the algorithm of Bulirsch (1965):

   Bulirsch 1965, Numerische Mathematik, 7, 78
   Bulirsch 1965, Numerische Mathematik, 7, 353

 CALLING SEQUENCE:
    result = ellpic_bulirsch(n, k)

 INPUTS:

    n,k - int(dtheta/((1-n*sin(theta)^2)*sqrt(1-k^2*sin(theta)^2)),0, pi/2)

 RESULT:

    The complete elliptical integral of the third kind

 MODIFICATION HISTORY
 
  2009/03 -- Written by Eric Agol
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/ellpic_bulirsch.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST">
<H2>EXOFAST</H2></A>
<A HREF="#ELLPIC_BULIRSCH">[Previous Routine]</A>
<A HREF="#EXOFASTV2">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST

 PURPOSE:

 Creates a stellar system structure that describes an arbitrary
 number of planets, observed bands, rv telescopes (a new zero point
 for each), and observed transits.  This structure is the input to
 basically everything in EXOFASTv2 and is designed to be easily
 extensible. To add a new derived parameter to the output table, add it here,
 then calculate it in DERIVEPARS. To add a new fitted parameter, add
 it here, then use it in EXOFAST_CHI2V2 to influence the model or
 the likelihood/chi^2 directly.

 Priors may be applied to any parameter (fitted or derived).

 CALLING SEQUENCE:
   ss = mkss(nplanets=nplanets, circular=circular, $
             fitslope=fitslope, fitquad=fitquad, ttvs=ttvs, tdvs=tdvs, $
             rossiter=rossiter, fitdt=fitdt, eprior4=eprior4, fittran=fittran, fitrv=fitrv, $
             nvalues=nvalues, debug=debug, priorfile=priorfile, $
             rvpath=rvpath, tranpath=tranpath, longcadence=longcadence, earth=earth)

 INPUTS:
 
  NPLANETS - The number of planets to fit
  CIRCULAR - An NPLANETS boolean array describing which
             planets should be fixed to have circular orbits. If not
             specified, all planets will be fit with eccentric models.
  FITTRAN  - An NPLANETS boolean array specifying which planets
             should be fit with a transit model. By default, all
             planets are fit with transit photometry. 
  FITRV    - An NPLANETS boolean array specifying which planets
             should be fit with a radial velocity model. By default, all
             planets are fit with radial velocities.
  CHEN     - An NPLANETS boolean array specifying which planets
             should have the Chen & Kipping, 2017 mass-radius
             relation applied. By default CHEN = FITRV xor
             FITTRAN. That is, only apply the mass-radius prior when
             RV is not fit (to derive the planet mass) or when a
             transit is not fit (to derive the radius). If the
             defaults have been overridden and FITRV and CHEN are
             both false for a given planet, the RV semi-amplitude
             (planet mass) and all derived parameters will not be
             quoted. Multi-planet systems will be constrained not to
             cross orbits, but the Hill Sphere will be set to zero.
             If FITTRAN and CHEN are both false for a given planet,
             the planetary radius and all derived parameters will not
             be quoted.
  I180     - An NPLANETS boolean array specifying which planets'
             inclination should be allowed to be between 0 and 180
             instead of the default of 0 to 90. Note that a normal
             transiting planet has a perfect degeneracy between i and
             180-i which is likely to cause convergence
             problems. Additional information (e.g., from astrometry
             or mutual eclipses) must be used for this keyword to be
             used properly. Even in the case of mutual eclipses
             (which is currently not supported), at least one planet must be
             arbitrarily constrained from 0 to 90.
  ROSSITER - An NPLANETS boolean array specify which planets to fit a
             rossiter model to the RV data. Fit lambda and
             V_rot*sin(I_*) from RV data during transit using the
             Ohta approximations (has known issues)
  FITDT    - An NPLANETS boolean array specifying which planets to
             fit a Doppler tomography model to the RV data
             (*** Currently unsupported***)
  THERMAL  - A string array specifying which bands to fit thermal
             emission for. This is what you want to set to fit an
             isolated secondary eclipse. All observations in this
             band will be modeled with a baseline of 1 between t2 and
             t3 of the secondary eclipse and 1 + thermal emission (in
             PPM) out of eclipse.
  REFLECT  - A string array specifying which bands to fit reflected
             light for. Set this along with thermal if you're
             fitting a full phase curve. It will be modeled as a
             sinusoid with the orbital period, a minimum at the
             primary transit, and a fitted amplitude (in PPM).
  DILUTE   - A string array specifying which bands to fit a dilution
             term for. Set this if the star is blended with a
             neighbor and you expect color-dependent depth
             variations.
             Note: May be degenerate with F0 (transit normalization) 
             Note: this only affects the transit model. It is not
             accounted for in the SED fitting.
             TODO: automatically model dilution based on multiple
             SEDs
  NVALUES  - By default, parameter.value is a scalar. Set this
             to make it an array of length NVALUES.
  PRIORFILE - The name of the file that specifies all the priors. The
              prior file is an ASCII file with each line containing
              three white space delimited columns: NAME, VALUE,
              WIDTH. NAME must match a parameter.label. If in an
              array (e.g., of planets), add "_i", where "i" is the
              zero-indexed index into the array.  If WIDTH is set to
              0, the parameter is fixed at VALUE (this is generally
              not recommended; it's far better to apply a realistic
              prior). If WIDTH is set to -1, the fit starts at VALUE,
              but there is no penalty if the model deviates from
              VALUE. If WIDTH is positive, a gaussian prior is
              applied. That is, a chi^2 penalty equal to ((parameter
              - VALUE)/WIDTH)^2 is applied to the likelihood
              function. Here is the contents of a sample priorfile
              for the EPXXXXXXXXX system published in Eastman et al,
              2017:

              teff 6167 78 # Gaussian prior on T_eff of 6167 +/- 78 K
              feh -0.04 0.1 # Gaussian prior on [Fe/H] of -0.04 +/- 0.1 dex
              logg 4.22 0.06 # Gaussian prior on logg of 4.22 +/- 0.06
              vsini 9400 300 # Gaussian prior on vsini of 9400 +/- 300 (ignored since vsini is not fitted)
              av 0.15 0.30 # Gaussian prior on A_V (extinction) of 0.15 +/- 0.30
              ma 11.529 0.142 # Gaussian prior on ma (apparent V mag) of 11.529 +/- 0.142
              distance 247.87 57.223 # Gaussian prior on distance of 247.87 +/- 57.223 pc
              tc_0 2457166.0543 -1 # start the fit with a TC for planet 0 (EPXXXXXXXXb) at BJD_TDB=2457166.0543
              p_0 0.020 -1 # start the fit with Rp/Rstar for planet 0 at 0.020
              period_0 26.847 -1 # start the fit with period for planet 0 at 26.847 days
              tc_1 2457213.5328 -1 # start the fit with a TC for planet 1 (EPXXXXXXXXc) at BJD_TDB=2457213.5328
              p_1 0.02 -1 # start the fit with Rp/Rstar for planet 1 at 0.020
              period_1 39.5419 -1 # start the fit with period for planet 0 at 39.5419 days
              tc_2 2457191.8894 -1 # start the fit with a TC for planet 2 (EPXXXXXXXXd) at BJD_TDB=2457191.8894
              p_2 0.020 -1 # start the fit with Rp/Rstar for planet 2 at 0.020
              period_2 125 -1 # start the fit with period for planet 2 at 125 days
              tc_3 2457170.4990 -1 # start the fit with a TC for planet 3 (EPXXXXXXXXe) at BJD_TDB=2457170.4990
              p_3 0.029 -1 # start the fit with Rp/Rstar for planet 3 at 0.020
              period_3 160 -1 # start the fit with period for planet 3 at 160 days
  RVPATH   - The path of the RV files. Each RV files is fit with a
             separate zero point.
  TRANPATH - The path of the transit data. Each file is fit with a
             separate normalization. If TTVS is set, each file is fit
with a diff

 KEYWORDS:
  FITSLOPE - Fit a linear trend to the RV data
  FITQUAD  - Fit a quadratic trend to the RV data
  TTVS     - Fit an independent (non-periodic) transit time for each transit
  TDVS     - Fit an indepdedent depth to each transit
  EPRIOR4  - Parameterize the eccentricity and argument of
             periastron as e^(1/4)*sin(omega) and
             e^(1/4)*cos(omega) to more closely match the observed
             eccentricity distribution 
  DEBUG    - Output various debugging information and plots at each
             step.

 PARAMETER STRUCTURE
 parameter.value -- the parameter's numerical value in
                    parameter.unit units. For the MCMC, this is an
                    array for all links.
 parameter.prior -- the parameter's prior
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mkss.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFASTV2">
<H2>EXOFASTV2</H2></A>
<A HREF="#EXOFAST">[Previous Routine]</A>
<A HREF="#EXOFAST_AMOEBA">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFASTv2

 PURPOSE: 
   Simultaneously fits RV and/or transit data for multiple
   planets, transits, RV sources. Please cite Eastman et al., 2019
   (https://arxiv.org/abs/1907.09480) if you make
   use of this routine in your research. Please report errors or bugs
   to jason.eastman@cfa.harvard.edu

 CALLING SEQUENCE:
   exofastv2, [RVPATH=, TRANPATH=, PRIORFILE=, FLUXFILE=, PREFIX=, /CIRCULAR,
             /NOSLOPE, /SECONDARY, /UPDATE, PNAME=, SIGCLIP=, NTHIN=,
             MAXSTEPS=, MINPERIOD=, MAXPERIOD=, NMIN=, /DISPLAY,
             /DEBUG, RANDOMFUNC=, SEED=, /SPECPRIORS, /BESTONLY,
             NINTERP=, EXPTIME=, /LONGCADENCE]

 INPUTS:

   PRIORFILE  - An ASCII file with each line containing three white
                space delimited columns. See
                $EXOFAST_PATH/parnames.README for a detailed
                explanation of this file and $EXOFAST_PATH/examples/
                for templates to use.

 OPTIONAL INPUTS:
   NPLANETS    - The number of planets you wish to fit to the
                 data. Default is 1. If 0 is set, it will just fit
                 the star.
   RVPATH      - A string specifying the path to the RV data
                 file(s). Wildcards are allowed for multiple files
                 (e.g., '*.rv'). Each file must have at least 3
                 columns:
                   1) Time (BJD_TDB -- See Eastman et al., 2010)
                   2) RV (m/s)
                   3) err (m/s)

                 The names of the files describing the RVs
                 *should* adhere to a certain format:
                 planet_name.telescope.whateveryouwant. 

                 The telescope is used for labeling the figures and
                 tables.

                 NOTE 1: The units must be as specified, or the fit
                 will be wrong or fail. 
                 NOTE 2: Other input time stamps will likely not
                 break the code, but can introduce errors in the
                 reported times of more than a minute. The output
                 table will display BJD_TDB but makes no attempt to
                 convert input times.  See
                 http://adsabs.harvard.edu/abs/2010PASP..122..935E
                 for an explanation of times
                 NOTE 3: If RVPATH is omitted, no RV model will be
                 generated.

   TRANPATH    - A string specifying the path to the transit data
                 file(s). Wildcards are allowed for multiple files
                 (e.g., '*.dat'). Each file must have at least 3
                 columns:

                   1) Time (BJD_TDB -- See Eastman et al., 2010)
                   2) Normalized flux
                   3) err
                   4) Detrend parameter 1
                   ....
                   N+3) Detrend parameter N
       
                 An optional header specifies which parameters
                 should be multiplicatively detrended and which
                 should be additively detrended. Without a header,
                 all detrending parameters are additively detrended.
 
                 The first character in the header line must be
                 "#". It must have whitespace delimited columns
                 corresponding to the data. Each multiplicative
                 detrending variable is preceeded with "M" (case
                 sensitive). For example, the header line

                 #BJD_TDB FLUX ERR MAIRMASS SKY myval

                 Will fit a multiplicative detrending to the 4th
                 column (MAIRMASS) and an additive detrending to the
                 5th and 6th columns (SKY and myval).

                 The corresponding model will be:

                 model = (transit + C0*SKY + C1*myval)*(F0 + M0*MAIRMASS)

                 Where C0, C1, and M0 are fitted detrending
                 parameters, F0 is the normalization, and SKY,
                 motion, and MAIRMASS are vectors for each data point
                 to detrend against.

                 The names of the files describing the transits
                 *must* adhere to a certain format:
                 nYYYYMMDD.filtername.telescope.whateveryouwant. 

                 nYYYYMMDD -- The UTC date of mid transit, where YYYY is
                 the year, MM is the month, and DD is the day. This
                 is only necessary if the data has a single
                 transit. This is used to label the transits in the
                 output plot.
 
                 filtername -- The name of the observed
                 filter. Only certain values are allowed (use the
                 closest approximation if yours is not in this list;
                 see quadld.pro): 

                 Johnson/Cousins: 'U','B','V','R','I','J','H','K'
                 Sloan: 'Sloanu','Sloang','Sloanr','Sloani','Sloanz'
                 Kepler: 'Kepler'
                 CoRoT: 'CoRoT'
                 TESS: 'TESS'
                 Spitzer: 'Spit36','Spit45','Spit58','Spit80'
                 Stromgren: 'u','b','v','y'

                 This is used to define the limb darkening for the
                 transit, dilution, and secondary depth parameters.

                 telescope -- a description of the telescope used for
                 the observations. Anything is allowed, but all
                 observations observed with the same telescope should
                 have the same name. This is used in the output plot
                 and color codes the TTV plot.

                 whateveryouwant -- any string you want to
                 include for it to make sense to you. This is not
                 used by the code.

                 So a transit taken on UTC 2017-01-27 with MINERVA in
                 the V band would be "n20170127.V.MINERVA.dat"

                 NOTE 2: The units must be as specified, or the fit
                 will be wrong or fail.
                 NOTE 3: Other input time stamps will likely not
                 break the code, but can introduce errors in the
                 reported times of more than a minute. The output
                 table will display BJD_TDB but makes no attempt to
                 convert input times.  See
                 http://adsabs.harvard.edu/abs/2010PASP..122..935E
                 for an explanation of times
                 NOTE 4: If omitted, just the RV data will bit fit

   *** Astrometry is not currently suppported or thoroughly tested. Future updates are likely to change the expected formats ***
   ASTROMPATH  - A string specifying the path to the astrometry data
                 file(s). Wildcards are allowed for multiple files
                 (e.g., '*.dat'). Each file must have 5 or 8
                 columns:

                   1) Time (BJD_TDB -- See Eastman et al., 2010)
                   2) RA (ICRS deg)
                   3) DEC (ICRS deg)
                   4) ra uncertainty (mas)
                   5) dec uncertainty (mas)
                   6) X position of observatory (AU from Solar System Barycenter)
                   7) Y position of observatory (AU from Solar System Barycenter)
                   8) Z position of observatory (AU from Solar System Barycenter)

                 The filename must adhere to a certain format:
                 epoch.location.whateveryouwant                
 
                 epoch -- the reference epoch of the
                 observations in BJD_TDB (e.g., J2000 is
                 2451545).
                 location -- the location of the observatory. Only
                 "Earth" (geocenter), "Gaia" and "Hipparcos" are
                 understood, in which case the observatory position
                 (columns 6-8) will be calculated if not supplied.
                 whateveryouwant -- any string you want to include
                 for it to make sense to you. This is not used by the
                 code.

                 If supplied, EXOFASTv2 will fit the following
                 additional parameters: RA, Dec, PMRA, PMDEC, and
                 parallax, plus Omega for each planet. The
                 inclination will span the range from 0 to 180 (-1 <
                 cosi < 1).

   DTPATH      - The (optional) path to the Doppler Tomography fits
                 file(s). If supplied, the code will fit a vsini and
                 macro turbulence of the star, as well as a
                 spin-orbit alignment for each planet. This must be
                 used in conjunction with the FITDT, an NPLANETS
                 array specifying which planets should have their DT
                 signal modeled.

                 Each fits file is a 2D array describing all DT
                 observations during a single transit with extensions
                 describing the axes of the array. The pixel values
                 of the 2D array contain the fractional flux
                 decrement at a given BJD_TDB (spectrum) and velocity
                 (pixel value of the CCF). The first extension should
                 specify the BJD_TDB corresponding to each Y pixel
                 and the second extension should specify the velocity
                 corresponding to each X pixel.

                 Such a file can be generated given the 2D array of
                 fractional flux decrements (DT), a time array
                 (BJD_TDB) and a velocity array (VEL) like this:
 
                 writefits,'nYYYYMMDD.pname.instrument.resolution.fits',DT
                 writefits,'nYYYYMMDD.pname.instrument.resolution.fits',BJD_TDB, /append
                 writefits,'nYYYYMMDD.pname.instrument.resolution.fits',VEL, /append

                 The names of these files *must* adhere to a certain format:
                 nYYYYMMDD.pname.instrument.resolution.whateveryouwant.fits 

                 nYYYYMMDD -- The UTC date of mid transit. This is
                 used to label the transits in the output plot.
 
                 pname -- The name of the planet, including the
                          letter for the planet order (e.g., KELT-24b)

                 instrument -- the name of the instrument used for
                 the observations. Anything is allowed, but all
                 observations observed with the same telescope should
                 have the same name. This is used in the labels.

                 resolution -- The R value of the instrument. This is
                 required to accurately model the DT signal and must
                 be correct.

                 whateveryouwant - any string you want to include (or
                 nothing) for it to make sense to you (e.g, target
                 name). This is not used by the code.

                 So a transit taken on UTC 2017-01-27 with the TRES
                 spectrograph (R=44000) would be called
                 "n20170127.TRES.44000.fits"
 
                 NOTE 0: When supplied this way, the DT data does not
                 constrain vsini. A gaussian prior must be given in
                 the prior file.

                 NOTE 1: NAXIS1 must equal the number of velocities and
                 NAXIS2 must equal the number of times.

                 NOTE 2: Not using BJD_TDB time stamps will likely
                 not break the code, but can introduce errors in the
                 reported times of more than a minute or cause
                 internal inconsistencies if different data sets use
                 different timestamps. The output table will display
                 BJD_TDB but makes no attempt to convert or reconcile
                 input times between data sets.

                 See
                 http://adsabs.harvard.edu/abs/2010PASP..122..935E 
                 for an explanation of times

                 NOTE 3: If DTPATH is omitted, Doppler Tomography is
                 not included in the global fit

   FLUXFILE   - An ASCII file with each line containing three white
                space delimited columns: FILTER, MAG,
                UNCERTAINTY. This file describes the apparent
                broad-band magnitudes of the host star to fit the SED
                and derive a distance, luminosity, and
                extinction. Only certain FILTERS are allowed.  See
                mag2fluxconv.pro for more info and citations. If not
                specified, the distance and extinction are not fit
                and the resultant constraint on the stellar
                luminosity is not applied. 
                NOTE: FLUXFILE must be specified for a parallax to
                constrain the stellar luminosity/radius.

                Galex: 'galNUV', 'galFUV' 
                NOTE: the SED models are not great at UV, you may find it
                better not to use Galex
                WISE: 'WISE1','WISE2','WISE3','WISE4'
                Sloan: 'uSDSS','gSDSS','rSDSS','iSDSS','zSDSS'
                Panstarrs: 'zPS'
                Johnson: 'U','B','V','R',
                Cousins: 'RC', 'IC','J2M','H2M','K2M'
                Tycho: 'BT','VT'
                Kepler INT: 'U_KIS','gKIS','rKIS','iKIS'

                The program mksed.pro will automatically generate
                this file using queryVizier based on the object's
                name or coordinates. Exercise caution that the
                correct object was selected for each catalog.
 
                Thank you to Keivan Stassun at Vanderbilt for the
                majority of the SED-related code.

   PREFIX      - Each of the output files will have this string as a
                 prefix. Default is 'planet.'

   MAXSTEPS    - The maximum number of steps to take in the MCMC
                 chain. Note that a 32-bit installation of IDL cannot
                 allocate more than 260 million double-precision
                 numbers, and redundant copies of each parameter are
                 required. Even a 64-bit installation may require
                 very slow disk swapping. A very large number for
                 MAXSTEPS will cause memory management
                 problems. Default is 100,000, and larger values are
                 strongly discouraged. Increase NTHIN if the chains
                 are not well-mixed. For complex fits with many
                 parameters, users may wish to revise this downward.

                 NOTE: If the MCMC chains run to MAXSTEPS,
                 doubling this value will double the runtime. Short
                 test runs (MAXSTEPS=100) are strongly encouraged
                 before running week-long fits.
   MAXTIME     - The maximum runtime for the DEMC portion of the
                 code, in seconds. If set, the fit will wrap up after
                 MAXTIME seconds. This is intended for
                 non-interactive use with a time constraint (e.g.,
                 running on a super computer). Note this only applies
                 to the MCMC portion of the code, and it finishes the
                 loops over NTEMPS and NTHIN before it will check the
                 time. The time AMOEBA takes or the time to
                 synthesize the results is not counted, therefore, it
                 would be wise to set this to 1800 seconds (30
                 minutes) less than any hard limit.

                 NOTE: For interactive terminals, dynamic stopping, use
                 !STOPNOW. During a run that you want to stop, type:
                     control + c
                     !stopnow=1
                     .con  
   NTHIN       - If set, only every NTHINth element will be
                 kept. Values as high as 1/acceptance rate typically
                 don't degrade the resultant fit because there is a
                 high correlation between adjacent steps and has the
                 advantage of improved memory management and faster
                 generation of the final plots. Default is 1.
                 NOTE: Only kept links in the chain count toward
                 MAXSTEPS, so if the MCMC chains run to MAXSTEPS,
                 doubling this value will double the runtime.
   NTEMPS      - The number of chains to run at different
                 temperatures, uniformly distributed between 1 and
                 TF. The more temperatures, the easier it is to make
                 swaps between temperatures, but the longer it can
                 take. The default is 1 (no parallel tempering). 8 is
                 a good value. Note that only the T=1 chain is kept
                 by default. Parallel tempering is better at finding
                 the global minimum in a rough likelihood surface and
                 sampling widely spaced, multi-modal distributions
                 (often the case for MIST models). Nominally, NTEMPS
                 more steps are taken, requiring NTEMPS times longer
                 to run. However, it may lead to better mixing and
                 therefore faster convergence, so the effect on
                 runtime is system dependent and not obvious.
   TF          - The temperature of the hottest chain, when NTEMPS >
                 1. The higher the temperature, the more parameter
                 space it will probe, but the chains will be less
                 likely to swap. Default is 200, which can robustly
                 find minima separated by 50 sigma. A value of 1 will
                 result in no temperature difference between chains.
   RANDOMFUNC  - A string specifying the name of the random number
                 generator to use. This generator must be able to
                 return 1,2 or 3 dimensional uniform or normal random
                 deviates. Default is 'EXOFAST_RANDOM' (which is slow
                 but robust).
   SEED        - The seed to the random number generator used for the
                 MCMC fits. Be sure not to mix seeds from different
                 generators. The default is -systime(/seconds).
   NINTERP     - If set, the each model data point will be an average
                 of NINTERP samples over a duration of EXPTIME
                 centered on the input time.
   EXPTIME     - If set, the each model data point will be an average
                 of NINTERP samples over a duration of EXPTIME
                 centered on the input time.
                 For a dicussion on binning, see:
                 http://adsabs.harvard.edu/abs/2010MNRAS.408.1758K
   MAXGR       - The maximum Gelman Rubin statistic that is
                 considered well-mixed (default=1.01)
   MINTZ       - The minimum number of independent draws that is
                 considered well-mixed (default=1000)
   FITRV       - An NPLANETS boolean array that specifies which
                 planets should be fit with an RV model. 
                 If RVPATH is specified, default is bytarr(nplanets) + 1B.
                 If RVPATH is not specified, default is bytarr(nplanets).
                 At least one of FITRV and FITTRAN should be true for each planet
   FITTRAN     - An NPLANETS boolean array that specifies which
                 planets should be fit with a transit model. 
                 If TRANPATH is specified, default is bytarr(nplanets) + 1B.
                 If TRANPATH is not specified, default is bytarr(nplanets). 
                 At least one of FITRV and FITTRAN should be true for each planet
   CIRCULAR    - An NPLANETS boolean array that specifies which planets
                 should be fixed to be circular (1) or left with
                 eccentricity free (0). 
                 Default is bytarr(nplanets) + 1B.
   ROSSITER    - An NPLANETS boolean array that specifies which planets
                 should fit the Rossiter-McLaughlin effect to the RV
                 data using the Ohta approximation. If a run was
                 dedicated to RM, it should be separated into its own
                 file to fit a different zero point and jitter
                 parameter to it.
                 Default is bytarr(nplanets)
   FITDT       - An NPLANETS boolean array that specifies which planets
                 should fit using a Doppler Tomography model.
                 Default is bytarr(nplanets)
  FITTHERMAL- A string array specifying which bands to fit thermal
             emission for. This is what you want to set to fit an
             isolated secondary eclipse. All observations in this
             band will be modeled with a baseline of 1 between t2 and
             t3 of the secondary eclipse and 1 + thermal emission (in
             PPM) out of eclipse.
  FITREFLECT- A string array specifying which bands to fit reflected
             light for. Set this along with thermal if you're
             fitting a full phase curve. It will be modeled as a
             sinusoid with the orbital period, a minimum at the
             primary transit, and a fitted amplitude (in PPM).
  FITDILUTE- A string array specifying which bands to fit a dilution
             term for. It will fit the fractional contribution from
             the companion. This should be set if the star is blended
             with a neighbor and you expect color-dependent depth
             variations in the transit or photocenter variations in
             the astrometry.

             If you just have the flux ratio, X, solve this system of
             equations for Flux_companion:
         
             Flux_companion/Flux_primary = X
             Flux_companion + Flux_primary = 1
             Flux_companion = X/(X+1)

             Note 1: For transits, this is likely to be degenerate
             with F0 (transit normalization). You probably need to
             apply a prior (DILUTE_#, where # corresponds to the band
             index) from some external information to constrain it
             (e.g., an SED fit). 
 
             Note 2: For astrometry, this is degenerate with the
             semi-major axis/mass. You must supply a prior on the
             dilution (e.g., from AO) in at least one band if one of
             those is not independently determined.

             Note 3: This dilution does not impact the SED fit. The
             SED broadband photometry is assumed to be for the
             single, primary component.

             TODO: automatically model dilution based on multiple
             SEDs
 FITBEAM   - An NPLANET boolean array that specifies which planets to
             model a doppler beaming signal. If this beaming
             amplitude is fit directly, it will *not* constrain the
             planetary mass (set DERIVEBEAM instead).
 DERIVEBEAM- An NPLANET boolean array that specifies which planets to
             model a doppler beaming signal. If this beaming
             amplitude is derived (from K), it will constrain the
             planetary mass through Faigler & Mazeh, 2011, eq 1 (set
             FITBEAM instead to model the beaming but break this
             connection).
 FITELLIP  - A string array specifying which bands to fit an
             ellipsoidal variation amplitude for. Note: this does
             *not* feedback into the global model through F&M 2011,
             eq 2

   CHEN        - An NPLANET boolean array that specifies which
                 planets should have the Chen & Kipping, 2017
                 mass-radius relation applied. By default CHEN =
                 FITRV xor FITTRAN. That is, only apply the
                 mass-radius prior when RV is not fit (to derive the
                 planet mass) or when a transit is not fit (to derive
                 the radius). If the defaults have been overridden
                 and FITRV and CHEN are both false for a given
                 planet, the RV semi-amplitude (planet mass) and all
                 derived parameters will not be quoted. Multi-planet
                 systems will be constrained not to cross orbits, but
                 the Hill Sphere will be set to zero.  If FITTRAN and
                 CHEN are both false for a given planet, the
                 planetary radius and all derived parameters will not
                 be quoted.

 OPTIONAL KEYWORDS:
   FITSLOPE  - If set, it will fit a linear trend to the RV data.
   FITQUAD   - If set, it will fit a quadratic trend to the RV data.
   RVEPOCH   - If set, this is the reference epoch (A BJD_TDB) for RV
               linear and quadratic trends. Default is the midpoint
               of all RV observations.
   NOMIST    - If set, do not use the MIST evolutionary tracks 
               see http://waps.cfa.harvard.edu/MIST/
               And please cite
               http://adsabs.harvard.edu/abs/2016ApJS..222....8D
               http://adsabs.harvard.edu/abs/2016ApJ...823..102C
   PARSEC    - If set, use the PARSEC evolutionary models. 
   YY        - If set, use the YY evolutionary tracks see
               http://adsabs.harvard.edu/abs/2001ApJS..136..417Y
               to constrain the mass/radius of the star. YY should
               not be used for low-mass stars (~< 0.5 msun). This
               should be accompanied by the NOMIST keyword (but is
               not enforced).
   TORRES    - If set, use the Torres relations to constrain the mass
               and radius of the star. This may be useful to
               investigate potential systematics and should be
               accompanied by the NOMIST keyword (but is not
               enforced). The Torres relations are not applicable for
               low mass (< 0.6 msun) stars.
   NOCLARET  - If set, ignore the Claret & Bloeman limb darkening
               tables and just fit the limb darkening. This should be
               specified for low-mass stars where these tables are
               unreliable.
   LONGCADENCE - If set, EXPTIME=29.425 and NINTERP=10 are set to handle
               long cadence data from Kepler. This overwrites
               NINTERP and EXPTIME inputs.

   REJECTFLATMODEL - An NTRANSITFILES byte array specifying which
                     transits must have a signal. If model without a
                     signal is generated and REJECTFLATMODEL=1B, the
                     model will be rejected a priori. If a flat model
                     is accepted when a transit is expected, there is
                     an infinite volume of parameter space with equal
                     likelihood, which breaks the Markov condition,
                     and it will never converge. Note the default
                     allows flat models because 1) the user may wish
                     to model out of transit constraints on the
                     ephemeris and 2) rejecting flat models a priori
                     may give the user an undue confidence in the
                     signficance of the signal. This is likely
                     required for low SNR transits or when using
                     parallel tempering (see NTEMP and TF).
   FITSPLINE - An NTRANSITFILES byte array specifying which transits
               should be flatted with a spline. This should only be
               used for long baseline data like Kepler, K2, or TESS.
   SPLINESPACE - An NTRANSITFILES array specifying the knot spacing
                 between adjacent points in the spline, in days. To
                 be used in conjunction with FITSPLINE. Default is
                 0.75 days. This spacing should be large compared to
                 the transit duration (>~ 3x), or there is
                 significant risk of introducing a strong covariance
                 between the spline and the transit parameters,
                 biasing the inferred values, inflating the
                 uncertainties, and increasing convergence times.
   TIDES     - If set, when (1-Rstar/a-rp/a) < e < (1-3*Rstar/a), we
               set the eccentricity to zero, presuming that the tidal
               circularization timescale is much much smaller than
               the age of the system.
   EPRIOR4   - Parameterize the eccentricity and argument of
               periastron as e^(1/4)*sin(omega) and
               e^(1/4)*cos(omega) to more closely match the observed
               eccentricity distribution
   TTVS      - An NTRANSITSxNPLANETS boolean array, specifying which
               transit files should have a timing offset applied
               corresponding to which planets. 
               NOTE: if the same transit applies to more than one
               planet, the same offset will be applied to both. Such
               transits should probably be removed from the analysis. 
   TDELTAVS  - An NTRANSITSxNPLANETS boolean array, specifying which
               transit files should have a depth offset applied
               corresponding to which planets. 
               NOTE: if the same transit applies to more than one
               planet, the same offset will be applied to both. Such
               transits should probably be removed from the analysis. 
   TIVS      - An NTRANSITSxNPLANETS boolean array, specifying which
               transit files should have an inclination offset applied
               corresponding to which planets. 
               NOTE: if the same transit applies to more than one
               planet, the same offset will be applied to both. Such
               transits should probably be removed from the analysis. 
   BESTONLY  - If set, only the best fit (using AMOEBA) will be
               performed.
               ***NOT YET IMPLEMENTED***
   PLOTONLY  - If set, only a plot of the initial guesses over the
               data is made. This is useful when refining initial
               guesses.
               ***NOT YET IMPLEMENTED***
   REFINESTAR- If set, refining the stellar parameters first, before
               the global fit.
   EARTH     - If set, the output units of Mp and Rp are in Earth
               units, not Jupiter units.
   DEBUG     - If set, various debugging outputs will be printed and
               plotted. If the fit is failing, this is your first
               step to figuring out what's going
               wrong. Usually a parameter starts too far from its
               correct value to find or some parameter is not
               constrained.
   STARDEBUG - Same as DEBUG, but applied to the stellar parameter
               refinement at the beginning of the fit.

   KEEPHOT   - By default, the hot chains (and their corresponding
               chi^2) from parallel tempering (see NTEMPS and TF) are
               dynamically discarded to save memory. If this keyword
               is set and NTEMPS > 1, the steps from the hot chains
               (HOTPARS) and the corresponding chi2 (HOTCHI2) will be
               stored in memory during the fit and saved in the
               output IDL file. This is not useful to determine the
               posterior, and should only be used for debugging
               (e.g., determining the extent of parameter space
               explored), as it significantly increases the memory
               footprint.

 OUTPUTS:

   Each of the output files will be preceeded by PREFIX (defined
   above).

   mcmc.idl   - An IDL save file that contains the stellar structure
                with the full chains for each parameter, including
                derived parameters, the chi2 at each link, and the
                index of the burn-in period, called MCMCSS (MCMC
                stellar structure).
   chain.ps   - A postscript plot of each parameter as a function of
                chain link, 8 to a page. Each color is a separate
                chain.
   pdf.ps     - A postscript plot of each posterior distribution
                function, 8 to a page. Each color is a separate
                chain. The thick black line is the average of all
                chains.
   covar.ps   - A postscript plot of the covariances between each
                fitted parameter in a corner plot.
   median.tex - The LaTeX source code for a deluxe table of the
                median values and 68% confidence interval, rounded to
                two sig figs in the uncertainty.
   median.csv - A machine readable table of the median values and 68%
                confidence interval, rounded to two sig figs in the
                uncertainty.
   log        - A file containing everything printed to screen during
                the fit for later review.
   
   Each of the following outputs are created at 3 distinct phases in
   the fit. 

   1) Files preceeded with "start." are the starting values of the
   fit. Often times it is necessary to tweak these by hand until the
   starting values are a pretty good match to the data.

   2) Files preceeded with "amoeba." are the models after the amoeba
   minimization is complete. If this model is not a good fit to the
   data, the fit is likely to fail and you should refine your
   starting values, priors, and constraints. At a minimum, the MCMC
   is likely to take significantly longer to converge if this is not
   a good fit.

   3) Files preceeded with "mcmc." are the final plots meant for
   publication. They represent the best fit among all links of all
   chains.

   transit.ps - A multi-page postscript plot of the transit
                model. The first page has each transit (file) stacked
                on the same plot, offset by a constant. Subsequent
                pages are the detrended, phase-folded transits for
                each planet. Note that the model on the phase folded
                model may have some fuzz due to different limb
                darkening for each model.  
                *** Fairly cursory at the moment, and poorly behaved
                for complex fits ***
   rv.ps      - A multi-page postscript plot of the RV model. The
                first page is the unphased model with gamma and any
                fitted linear or quadratic terms subtracted from both
                the data and model. If more than one instrument is
                used, a legend is produced in the corner. Subsequent
                pages are each planet, phased to its period, with all
                other planets, gamma, and any fitted linear and
                quadratic terms subtracted.
   mist.eps   - A plot of the star with its MIST isochrone
                overplotted. The black point is the best-fit value,
                the red point is the corresponding model value. Only
                generated if the /NOMIST keyword is not set.
   yy.eps     - A plot of the star with its YY isochrone
                overplotted. The black point is the best-fit value,
                the red point is the corresponding model value. Only
                generated if the /YY keyword is not set.
   sed.eps    - A plot of the broadband photometry and best fit
                SED. Only generated if FLUXFILE is given.
 
  We recognize that in many cases, the outputs plots are not
  publication quality. The following text outputs are intended to
  allow the user to generate their own, more complicated or
  customized plots without having to recreate the model or
  detrending.

  residuals.telescope_[i].txt --
      A text file containing the residuals to the best-fit model RV
      for the ith telescope.
   model.telescope_[i].txt --
      A text file containing the best-fit model (with gamma, slope,
      and quad subtracted) RVs for each time given for telescope.
      One for each telescope is generated.
   model.transit_[i].txt - 
      The model of the ith transit at each input data point,
      including detrending.
   residuals.transit_[i].txt -- 
      The residuals of the ith transit file at each data point.
   detrendedmodel.transit_[i].planet_[j].txt -- 
      The detrended model of the ith transit of the jth planet minus
      1 at each input data point. Sum all transit[i].planet_*.txt and add
      one for the combined model. Useful for separating overlapping
      transits.
   prettymodel.transit_[i].planet_[j].txt -- 
      Same as detrendedmodel.transit_[i].planet_[j].txt, but sampled
      every minute from the first to the last data point. This is
      intended to make a pretty model plot if there are gaps in the
      data.

   NOTE 1: The detrended data can by derived by adding the residuals
      to the detrended model

   NOTE 2: To extract a single page out of a multi-page PS file, use:

         psselect -p# input.ps output.ps 

      where # is the page number to extract.

 COMMON BLOCKS:
   CHI2_BLOCK:
     SS      - A structure that describes the entire stellar system

 EXAMPLES:
   See the $EXOFAST_PATH/examples directory for several full examples.

 MODIFICATION HISTORY
 
  2017/01 -- Complete rewrite of exofast.pro. More general (fits
             multiple planets, mulitple bands, multiple instrumental
             offsets). Now easily extensible.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofastv2.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_AMOEBA">
<H2>EXOFAST_AMOEBA</H2></A>
<A HREF="#EXOFASTV2">[Previous Routine]</A>
<A HREF="#EXOFAST_ASTROM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
	EXOFAST_AMOEBA

 PURPOSE:
	Multidimensional minimization of a function FUNC(X), where
	X is an N-dimensional vector, using the downhill simplex
	method of Nelder and Mead, 1965, Computer Journal, Vol 7, pp 308-313.

	This routine is based on the AMOEBA routine, Numerical
	Recipes in C: The Art of Scientific Computing (Second Edition), Page
	411, and is used by permission.

       This is a debugged version of IDL's built-in AMOEBA, changing:
       fac1 = (1.0 - fac) / n_elements(psum)
       to 
       fac1 = (1.d0 - fac) / n_elements(psum)

 CATEGORY:
	Function minimization/maximization. Simplex method.

 CALLING SEQUENCE:
	Result = EXOFAST_AMOEBA(Ftol, ....)
 INPUTS:
    FTOL:  the fractional tolerance to be achieved in the function
	value.  e.g. the fractional decrease in the function value in the
	terminating step.  This should never be less than the
	machine's single or double precision.
 KEYWORD PARAMETERS:
    FUNCTION_NAME: a string containing the name of the function to
	be minimized.  If omitted, the function FUNC is minimized.
	This function must accept an Ndim vector as its only parameter and
	return a scalar single or double precision floating point value as its
	result. 
    FUNCTION_VALUE: (output) on exit, an Ndim+1 element vector
	containing the function values at the simplex points.  The first
	element contains the function minimum. 
    NCALLS: (output) the of times the function was evaluated. 
    NMAX: the maximum number of function evaluations allowed
	before terminating.  Default = 5000.
    P0: Initial starting point, an Ndim element vector.  The starting
	point must be specified using either the keyword SIMPLEX, or P0 and
	SCALE.  P0 may be either single or double precision floating.
	For example, in a 3-dimensional problem, if the initial guess
	is the point [0,0,0], and it is known that the function's
	minimum value occurs in the interval: -10 <
	X(0) < 10, -100 < X(1) < 100, -200 < X(2) < 200, specify: P0=[0,0,0],
	SCALE=[10, 100, 200]. 
    SCALE: a scalar or Ndim element vector contaiing the problem's
	characteristic length scale for each dimension.
	SCALE is used with P0 to form an initial (Ndim+1) point simplex.
	If all dimensions have the same	scale, specify a scalar.
    SIMPLEX: (output and/or optional input) On input, if P0 and SCALE
	are not set, SIMPLEX contains the Ndim+1 vertices, each of
	Ndim elements, of starting simplex, in either single or double
	precision floating point, in an (Ndim, Ndim+1) array. On output,
	SIMPLEX contains the simplex, of dimensions (Ndim, Ndim+1), enclosing
	the function minimum.  The first point, Simplex(*,0), corresponds to
	the function's minimum.

 OUTPUTS:
   Result: If the minimum is found, an Ndim vector, corresponding to
	the Function's minimum value is returned.  If a function minimum
	within the given tolerance, is NOT found in the given number of
	evaluations, a scalar value of -1 is returned.

 COMMON BLOCKS:
	None.

 SIDE EFFECTS:
	None.

 PROCEDURE:
	This procedure implements the Simplex method, described in
	Numerical Recipes, Section 10.4.  See also the POWELL procedure.

	Advantages:  requires only function evaluations, not
	derivatives, may be more reliable than the POWELL method.
	Disadvantages: not as efficient as Powell's method, and usually
	requires more function evaluations.

	Results are performed in the mode (single or double precision)
	returned by the user-supplied function.  The mode of the inputs P0,
	SCALE, or SIMPLEX, should match that returned by the function. The
	mode of the input vector supplied to the user-written function, is
	determined by P0, SCALE, or SIMPLEX.

 EXAMPLE:
	Use Amoeba to find the slope and intercept of a straight line fitting
	a given set of points minimizing the maximum error:

	The function to be minimized returns the maximum error,
	given p(0) = intercept, and p(1) = slope:
 FUNCTION FUNC, p
 COMMON FUNC_XY, x, y
 RETURN, MAX(ABS(y - (p(0) + p(1) * x)))
 END

	Put the data points into a common block so they are accessible to the
	function: 
 COMMON FUNC_XY, x, y
	Define the data points:
   x = findgen(17)*5
   y = [ 12.0,  24.3,  39.6,  51.0,  66.5,  78.4,  92.7, 107.8, 120.0, $
        135.5, 147.5, 161.0, 175.4, 187.4, 202.5, 215.4, 229.9]

	Call the function.  Fractional tolerance = 1 part in 10^5, 
	Initial guess = [0,0], and the minimum should be found within
	a distance of 100 of that point: 
   r = EXOFAST_AMOEBA(1.0e-5, SCALE=1.0e2, P0 = [0, 0], FUNCTION_VALUE=fval)

	Check for convergence:
   if n_elements(r) eq 1 then message,'AMOEBA failed to converge'
	Print results.
   print, 'Intercept, Slope:', r, 'Function value (max error): ', fval(0)
Intercept, Slope:      11.4100      2.72800
Function value:       1.33000

 MODIFICATION HISTORY:
	DMS, May, 1996.	Written.
       May 2010 - Bug fix for double precision steps. Jason Eastman, OSU
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_amoeba.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_ASTROM">
<H2>EXOFAST_ASTROM</H2></A>
<A HREF="#EXOFAST_AMOEBA">[Previous Routine]</A>
<A HREF="#EXOFAST_BLACKBODY">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
  BJDTDB   - The BJD_TDB of the observations. 
  RA/DEC   - The ICRS coordinates of the target (scalar degrees), at EPOCH
             (default J2000). See Fig 10 for required precision.
  PMRA     - Proper motion in RA, in mas/year (scalar)
             Must be in units of arc (as is typical for most
             modern catalogs); i.e. PMRA = d(RA)/dt * cos(DEC)
  PMDEC    - Proper motion in dec, in mas/year (scalar)
             See Fig 13 for required precision.
  PX       - Parallax of target, in mas (scalar) (See Fig 11)
  RV       - Radial velocity of target (m/s)
             ** only ~100 km/s precision required for cm/s precision
             decade intervals for nearby disk star (see Fig 12)**
  EPOCH    - The epoch of the coordinates in JD_TDB, default is
             julday(1,1,2000,12) = 2451545d0 => J2000
  OBSPOS   - A 3xNTIMES vector of Solar System Barycenter coordinates
             of the observatory, in AU.
  STARPOS  - A 3xNTIMES vector of Target Barycentric coordinates of
             the star, in AU. Default is zero (no companions). This
             will generally be calculated by EXOFAST_GETB2.
  EARTH    - If set, will calculate the geocentric Earth position for
             the observatory position
  GAIA     - If set, will calculate the position of Gaia for the
             observatory position (not yet supported)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_astrom.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_BLACKBODY">
<H2>EXOFAST_BLACKBODY</H2></A>
<A HREF="#EXOFAST_ASTROM">[Previous Routine]</A>
<A HREF="#EXOFAST_CHI2">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_BLACKBODY
 PURPOSE:
  This function calculates the Planck function I_nu or
  I_lambda.
    I_nu     = 2h nu^3 c^-2 ( exp(h nu / kT) -1)^-1
    I_lambda = 2h c^2 lambda^-5 (exp ( hc / lambda kt) -1)^-1

 CATEGORY:
  Astrophysics

 CALLING SEQUENCE:
  result = BLACKBODY(temp, x, [/freq, /wave, /cgs, /mks])
 
 INPUTS:
  temp: The temperature, in K. Scalar or vector. If it is a scalar,
        the same temperature is assumed for each value of x.
     x: By default, the wagelength in mks units. If /cgs is set, then
     this number is in cgs units. If /freq is set, this number is the
     frequency. 

 KEYWORD PARAMETERS:
  wave: Set to receive the input as a wavelength, and output I_lambda
  freq: Set to receive the input as a frequency, and output I_nu
        (default) 
  cgs:  Set to receive the input and return the output in cgs units
  mks:  Set to receive the input and return the output in mks units
        (default) 

 OUTPUTS:
  I_nu or, if /wave is set, I_lambda

 MODIFICATION HISTORY:
  May 2009: Written by Chris Beaumont
  Aug 2018: JDE: Renamed to not conflict with IDLUTILS version.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_blackbody.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_CHI2">
<H2>EXOFAST_CHI2</H2></A>
<A HREF="#EXOFAST_BLACKBODY">[Previous Routine]</A>
<A HREF="#EXOFAST_DEMC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_CHI2

 PURPOSE: 
   Computes the chi2 for a transit and/or RV for a single planet

 CALLING SEQUENCE:
    chi2 = exofast_chi2v2(pars)

 INPUTS:

    PARS - An array of parameters that describes the model. There
           should be one for each parameter in the structure where
           fit==true. This array should be generated by str2pars.pro.

 OPTIONAL INPUTS:
 
    PSNAME      - If specified, this routine will generate
                  postscript figure for each model generated with a
                  base of PSNAME. 

 OPTIONAL OUTPUTS:
    
    DETERMINANT - The determinant of the Jacobian to weight the
                  acceptance likelihood in order to impose
                  non-uniform priors in the stepping parameters. This
                  is equal to 1 (no transformation) unless MIST
                  models are used. If MIST models are used,
                  DETERMINANT is equal to d(EEP)/d(Age) to transform
                  the uniform EEP prior into a uniform Age prior.
    MODELRV     - The RV model given the parameters
    MODELFLUX   - The Transit model given the parameters
    DERIVED     - An array of derived parameters. Nothing is ever
                  returned in DERIVED, but this keyword is required
                  by EXOFAST_DEMC.

 RESULT:
    The chi^2 of the model given the data and parameters.

 COMMON BLOCKS:
   CHI2_BLOCK - See exofastv2.pro for definition

 MODIFICATION HISTORY
 
  2018/03 -- Create documentation -- Jason Eastman (CfA)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_chi2v2.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_DEMC">
<H2>EXOFAST_DEMC</H2></A>
<A HREF="#EXOFAST_CHI2">[Previous Routine]</A>
<A HREF="#EXOFAST_ERRELL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_demc
 PURPOSE:
   Make NCHAINS independent Markov Chain Monte Carlo chains to fit data
   and return the parameter distributions.

 DESCRIPTION:
   Begins by determining the correct stepping scale by finding
   differences in each parameters that yield a delta chi^2 = 1, then
   uses 5*scale*randomn offsets in each parameter for the starting
   points of each chain.

   It then begins a Differential Evolution Markov Chain Monte Carlo
   fit (ter Braak, 2006)
   http://www.stat.columbia.edu/~gelman/stuff_for_blog/cajo.pdf.  The
   only slight modification to this basic alogorithm is that we
   determine the magnitude of the uniform random deviate for each
   parameter. We have found the dynamic range of our parameters can
   be large, and thus not well suited to the one-size fits all
   approach recommended there.

   After taking 5% of MAXSTEPS, the program will estimate how many steps
   will be necessary to be well-mixed. If it is not expected to be
   well-mixed before taking the maximum number of steps, it will
   output a warning and a recommended setting for NTHIN. This should
   be accurate at the factor of 2-3 level.

   The program stops when the chains are well-mixed, as defined by
   Ford 2006 (http://adsabs.harvard.edu/abs/2006ApJ...642..505F)
   using the Gelman-Rubin Statistic and number of independent draws,
   or when each chain has taken MAXSTEPS, whichever is first.

   Every step in the chain before all chains have crossed below the
   median chi^2 will be considered the (the "burn-in"), and not used
   for convergence tests. BURNNDX will specify the index of the first
   useable step so as not to be biased by the starting criteria.

 CALLING SEQUENCE:
   exofast_demc, bestpars, 'mychi2', pars [,CHI2=, TOFIT=,$
                 SCALE=, SEED=,RANDOMFUNC=,NTHIN=, MAXSTEPS=,/DONTSTOP,$
                 NCHAINS=, ANGULAR=,BURNNDX=,/REMOVEBURN]

 INPUTS:
   BESTPARS   - Array of the best-fit parameters. An accurate initial
                fit is required to find the correct step size. MCMC
                is not ideal for fitting data, just characterizing
                the errors.
   CHI2FUNC   - A string that specifies the name of the user-defined
                function that calculates the chi^2 of a given
                parameter set. Required data should be put in a
                COMMON block. Its calling sequence must be:
                chi2 = chi2func(pars, determinant=determinant)

 OPTIONAL INPUTS:
   TOFIT      - An array that indexes the parameters to fit. If not
                specified, all parameters are fit.
   ANGULAR    - An array that indexes the parameters that are
                angular (must be in radians). This will enable
                special ways to calculate the median and convergence
                statistics, which may otherwise fail. Default is none.
   SCALE      - An NPARS array containing the stepping scales for
                each parameter. This is not recommended for normal
                use. If not specified, it will be automatically
                determined using EXOFAST_GETMCMCSCALE.
   NTHIN      - Saves only every NTHINth link in each chain. This
                is only recommended when the autocorrelation between
                steps is large and memory management issues may
                arise. Results will be more accurate the smaller this
                is -- as long as the chain is well-mixed (pay
                attention to the warnings).
   MAXSTEPS   - The maximum number of steps (after thinning) for each
                chain to take.  The default is 100,000. Take care when
                increasing this number, as memory allocation issues
                may arise (especially with 32 bit machines). If the
                chain is not well-mixed, it is usually better to
                increase NTHIN instead.
   NCHAINS    - The number of independent chains to run. The
                execution time scales ~linearly with this number, and
                must be at least 3 to calculated convergence
                statistics. The default is 10. 
   SEED       - A seed for the random number generator. Do not mix
                seeds from different random number
                generators, and do not use several different seeds
                for the same generator. If you use a random number
                generator elsewhere, you should call EXOFAST_DEMC with
                SEED. Default is -systime(/seconds). 
   RANDOMFUNC - A string for the name of the random number generator
                function. You can use your own as long as it returns
                a uniform double precision deviate between 0 and 1,
                accepts the /NORMAL keyword to generate random
                gaussian deviates, and can return at least a two
                dimensional array of deviates. You may also choose
                between "EXOFAST_RANDOM" (default) or "RANDOMU".
              - EXOFAST_RANDOM is an IDL wrapper for pg_ran. This is
                a state of the art, bullet-proof generator with no
                known statistical flaws, based on the third edition
                of numerical recipes, pg 342. It is ~120x slower than
                RANDOMU, though for typical DEMC fits, this accounts
                for ~1% of the total runtime.
              - RANDOMU is IDL's built-in, ran1-based generator with a
                periodicity of ~10^9. ran1 is formally admonished by
                its author, Numerical Recipes, but shown to give
                identical results as the state of the art generator
                See Eastman et. al., 2013 for more details.
                http://adsabs.harvard.edu/abs/2013PASP..125...83E
   MAXGR      - The maximum Gelman Rubin statistic that is
                considered well-mixed (default=1.01)
   MINTZ      - The minimum number of independent draws that is
                considered well-mixed (default=1000)

 OPTIONAL KEYWORDS:
   DONTSTOP   - If set, the program will not stop when it is
                converged, but will instead take MAXSTEPS steps in
                each chain.
   REMOVEBURN - If set, the burn-in will be removed in the returned
                parameter array.
 OUTPUTS:
   PARS       - NFIT x NSTEPS x NCHAINS array of parameters.
                NOTE: NSTEPS will be the lesser of when it is
                converged or MAXSTEPS. 
   CHI2       - NSTEPS x NCHAINS array with the chi^2 for each set of
                parameters
   DERIVED    - An NDERIVED x NSTEPS x NCHAINS array of parameters
                that are derived during the chi^2 function. To
                conserve memory, these should be reserved for
                parameters that cannot be trivially rederived.

 SYSTEM VARIABLES:
   !STOPNOW   - If set, will break the MCMC loop at the next complete
                step. It must finish the current step, including all
                NTHIN and NCHAIN evaluations. To set it, type
                <CONTROL> + C
                !STOPNOW = 1 
                .con

 REVISION HISTORY:
   2012/06 - Public Release - Jason Eastman (LCOGT)
   2012/12 - When parameters aren't mixed, display the index
             to the (more) static PARS array, not the index to the
             dynamic TOFIT array.
           - Removed memory-hungry vestigial code
   2013/03 - Add GELMANRUBIN and TZ outputs, MAXGR, MINTZ inputs.
             Added DERIVED output, to return non-trivially derived
             parameters.
             Added check for errant chains (stuck in local minima)
             and discard them if the chains are not well-mixed at the
             end. This is sketchy, but better than nothing.
             This was a relatively common failure mode.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_demcpt_multi.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_ERRELL">
<H2>EXOFAST_ERRELL</H2></A>
<A HREF="#EXOFAST_DEMC">[Previous Routine]</A>
<A HREF="#EXOFAST_GELMANRUBIN">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_errell

 PURPOSE: 
   Gives the path of the error ellipses at constant probability given
   two parameter distributions.

 PROCEDURE
   1. Creates a 2D histogram of the data with NBINS bins per
   parameter.
   2. Calculates the fraction of data points above each value in the
   histogram.
   3. Compares each calculated fraction with the probabilities,
   and defines the closest as the levels to pass to CONTOUR.
   4. Creates a contour plot of the 2D histogram
   5. Scales the path to be in the same units as the input and
   recreates the path, adding NaNs between each level for easy
   plotting

 CALLING SEQUENCE:
   exofast_errell, xpar, ypar [,NXBIN=nxbin,NYBIN=nybin,PROBS=PROBS]$
                   [,XPATH=xpath][,YPATH=ypath][,/PLOT][,/OPLOT]

 INPUTS:
   XPAR       - A vector of parameters to be plotted on the x axis.
   YPAR       - A vector of parameters to be plotted on the y axis.

 OPTIONAL INPUTS:
   NXBIN      - The number of bins to take in each direction. Default
                is 100. If you have only a small number of values for
                xpar and ypar (10000), this should be smaller. 
   NYBIN      - The number of bins to take in each direction. Default
                is NXBIN.
   XMIN/YMIN  - The minimum x/y value to make the contours
   XMAX/YMAX  - The maximum x/y value to make the contours
   PROBS      - An array containing the probability contours to
                plot. The default is
                probs = erf([1.d0,2.d0]/sqrt(2.d0)), or
                probs = [0.6826894921370859d0,$
                         0.9544997361036416d0]
                Note: to have a meaningful contour enclosing 99.7% of
                the points, you must have ~1 million points or make
                NBINS smaller.
  
 OPTIONAL KEYWORDS:
   PLOT       - Plot the contours on a new plot
   OPLOT      - Overplot the contours on an existing plot

 OPTIONAL OUTPUTS:
   XPATH/YPATH - The x/y values of the contours. For more
                 customizable plotting, return these and plot inside
                 your own program. All contours can be plotted simply
                 with IDL> plot, xpath, ypath
                 NOTE: XPATH/YPATH contain NaNs between levels to make the
                 plotting easier.
   OUTSIDENDX  - The indices of the parameters outside of the
                 outer-most contour (requires David Fanning's Inside
                 procedure)

 EXAMPLE:
 plot the 68% and 95% contours, and every point outside them 

 x = randomn(seed,100000)
 y = randomn(seed,100000)
 exofast_errell, x,y,out=out,probs=[0.68,0.95],xpath=xpath,ypath=ypath
 plot, xpath, ypath, /iso
 if out[0] ne -1 then oplot, x[out],y[out],psym=3

 DEPENDENCIES:
 INSIDE (Coyote library):
 http://www.idlcoyote.com/programs/inside.pro

 NOTE: there is non-vectorized version of his code online, which will
 not work. Use the one at the link above.

 REVISION HISTORY:
   2010/03/01 - Written: Jason Eastman - The Ohio State University
   2010/11/05 - Added OUTSIDENDX output (inspired by Ben Shappee, OSU)
                Added, NXBIN, XMIN, XMAX, NYBIN, YMIN, YMAX inputs.
   2011/03/25 - Better memory management for INSIDE -- split up
                array to check (takes a little longer, but actually
                works with large arrays!)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_errell.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GELMANRUBIN">
<H2>EXOFAST_GELMANRUBIN</H2></A>
<A HREF="#EXOFAST_ERRELL">[Previous Routine]</A>
<A HREF="#EXOFAST_GETB">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_gelmanrubin

 PURPOSE: 
   Calculates the Gelman-Rubin Statistic for several parallel Markov
   chains, and determines whether or not the chains are well mixed
   according to the Ford 2006 prescription: 
   http://adsabs.harvard.edu/abs/2006ApJ...642..505F 

   This is meant to be a dependency of EXOFAST_DEMC. An example of
   its use can be seen there.

 PROCEDURE
   Calculates the Gelman-Rubin statistic and the number of
   independent draws for each parameter, as defined by Ford, 2006. The
   chain is considered well-mixed if all parameters have a
   Gelman-Rubin statistic of <= MAXGR (default = 1.01) and >= MINTZ
   (default = 1000) independent draws.

 CALLING SEQUENCE:
   ismixed = exofast_gelmanrubin(pars)

 INPUTS:
   PARS0       - A 3 dimensional array (NPARS,NSTEPS,NCHAINS) of
                 parameter values
 OPTIONAL INPUTS:
   MAXGR       - The maximum Gelman Rubin statistic that is
                 considered well-mixed (default=1.01)
   MINTZ       - The minimum number of independent draws that is
                 considered well-mixed (default=1000)

 OPTIONAL OUTPUTS:
   GELMANRUBIN - An NPARS element array containing the Gelman-Rubin
                 statistic for each parameter (equation 25).
   TZ          - An NPARS element array containing the number of
                 independent draws for each parameter (equation 26).

 OPTIONAL KEYWORDS:
   ANGULAR     - An array of indices (with up to NPARS elements)
                 indicating which elements are angular values. If
                 specified, these parameters will be re-centered
                 about the mode value before calculating the
                 statisitics (the original array will not be
                 modified). If left blank, no scaling will be performed. 
                 NOTE: angular values must be in radians.
  
 REVISION HISTORY:
   2010/03/01 - Written: Jason Eastman - The Ohio State University
   2013/03/18 - Added MAXGR, MINTZ optional inputs.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_gelmanrubin.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETB">
<H2>EXOFAST_GETB</H2></A>
<A HREF="#EXOFAST_GELMANRUBIN">[Previous Routine]</A>
<A HREF="#EXOFAST_GETB2">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_GETB

 PURPOSE: 
   This function returns the impact parameter as a function of BJD
   given orbital elements of the planet, assuming a keplerian orbit.
   Optionally, the 3 space coordinates can be returned.
 
 CALLING SEQUENCE:
   result = getb(jds, i=i,a=a,tperiastron=tperiastron,period=p,$
                 e=e,omega=omega, x=x, y=y, z=z)

 INPUTS:
   bjd         - Barycentric Julians dates for desired impact
                 parameters (ideally in the target's
                 barycentric frame; see BJD2TARGET)
   i           - inclination of orbit (radians)
   a           - semi-major axis, a = a1+a2 (in units of R_*). That
                 is, the semi-major axis should be calculated
                 from Kepler's equation: a/rstar = G(M+m)P^2/(4pi^2rstar).
                 Using G = 2942.71377d0 R_sun^3/(m_sun*day^2), masses
                 in solar masses, period in days, and rstar in solar
                 radii will give the appropriate input.
   tperiastron - periastron passage time (BJD)
   Period      - Period of orbit (days)

 OPTIONAL INPUTS:  
   e           - eccentricity of orbit (0 if not specified)
   omega       - argument of periastron of the star's orbit, in radians
                 -- omega_* is typically quoted from RV
                 -- required if e is specified
                 -- assumed to be pi/2 if e not specified
                 -- omega_* = omega_planet + !dpi
   lonascnode  - The Longitude of the ascending node
                 (radians). Assumed to be !dpi if not specified.

 OUTPUTS:
    result     - the impact parameter as a function of BJD, in units
                 of R_*.

 OPTIONAL OUTPUTS:
    x,y,z - Arrays of the cartesian coordinates of the planet at
            each BJD, in the units of R_*. 
              +X is right
              +Y is up
              +Z is out of the page (primary transit)

 MODIFICATION HISTORY 
  2009/05/01 -- Jason Eastman (Ohio State University)
  2017/04/12 -- Add optional mass ratio keyword
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_getb.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETB2">
<H2>EXOFAST_GETB2</H2></A>
<A HREF="#EXOFAST_GETB">[Previous Routine]</A>
<A HREF="#EXOFAST_GETMCMCSCALE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_GETB2

 PURPOSE: 
   This function returns the impact parameter as a function of BJD in
   the target barycentric frame, given orbital elements of many
   planets, assuming keplerian orbits.  Optionally, the 3-space
   barycentric coordinates of the star (x1,y1,z1) and planets
   (x2,y2,z2) or the stellar coordinates of the planets (x0,y0,z0)
   can be returned.
 
 CALLING SEQUENCE:
   result = getb(jds, i=i,a=a,tperiastron=tperiastron,period=p,$
                 e=e,omega=omega, x=x, y=y, z=z)

 INPUTS:
   bjd         - Barycentric Julians dates for desired impact
                 parameters (ideally in the target's
                 barycentric frame; see BJD2TARGET)
   i           - an NPLANETS array of planetary inclinations (radians)
   a           - an NPLANETS array of semi-major axis, a = a1+a2 (in
                 units of R_*). That is, the semi-major axis should be calculated
                 from Kepler's equation: a/rstar = G(M+m)P^2/(4pi^2rstar).
                 Using G = 2942.71377d0 R_sun^3/(m_sun*day^2), masses
                 in solar masses, period in days, and rstar in solar
                 radii will give the appropriate input.
   tperiastron - an NPLANETS array of periastron passage times (same
                 units as BJD)
   Period      - an NPLANETS array of Period of orbit (days)

 OPTIONAL INPUTS:  
   e           - an NPLANETS array of eccentricities (0 if not specified)
   omega       - an NPLANETS array of arguments of periastron of the star's orbit, in radians
                 -- omega_* is typically quoted from RV
                 -- assumed to be pi/2 if e not specified
                 -- omega_* = omega_planet + !dpi
   lonascnode  - an NPLANETS array of Longitudes of the ascending node
                 (radians). Assumed to be !dpi if not specified.
   Q           - an NPLANETS array of mass ratios of the primary to secondary
                 (M1/M2). If not specified, the mass ratio is assumed
                 to be infinite. The returned coordinates are the
                 motion of the companion with respect to the primary.

 OUTPUTS:
    result     - the impact parameter as a function of BJD, in units
                 of R_*.

 OPTIONAL OUTPUTS:
    x,y,z - Arrays of the cartesian coordinates of the planet at
            each BJD, in the units of R_*. 
              +X is right
              +Y is up
              +Z is out of the page (primary transit)

 MODIFICATION HISTORY 
  2009/05/01 -- Jason Eastman (Ohio State University)
  2017/04/12 -- Add optional mass ratio keyword
  2018/07/06 -- Now properly handles 2D time array (for long cadence)
  2018/11/13 -- Now properly handles a scalar time
  2019/02/05 -- Fix sign conventions
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_getb2.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETMCMCSCALE">
<H2>EXOFAST_GETMCMCSCALE</H2></A>
<A HREF="#EXOFAST_GETB2">[Previous Routine]</A>
<A HREF="#EXOFAST_GETPHASE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_getmcmcscale
 PURPOSE:
   Returns the optimal scale for MCMC chains by varying it until the
   delta chi^2 = 1.

 PROCEDURE:
   Calculates the chi^2 of the best fit model. Then, for each
   parameter, takes a small positive step (defined by seedscale) and
   re-calculates the chi^2. It brackets the value that yields delta
   chi^2 = 1 by doubling the seedscale until delta chi^2 > 1, then
   does a binary search to find the value that is as close as
   possible to delta chi^2 = 1. It repeats with a small negative
   step. The average of the positive and negative excursion is
   returned as the optimal scale.

   If the best fit is accurate and the errors are
   gaussian, uncorrelated, and accurately describe the data
   (chi^2/dof = 1), this will result in the optimal acceptance rate
   for MCMC fitting, 44% for 1 parameter, approaching 23% as the
   number of parameters is large.

 INPUTS:
   BESTPARS   - An NPARS element array of the best fit parameters
   CHI2FUNC   - A string of the named function that calculates the
                chi^2 of your model given the parameters specified by
                BESTPARS.

 OPTIONAL INPUTS:
   SEEDSCALE  - An NPARS arrray that contains the small step that is
                initially taken. If the chi^2 surface is a smooth,
                monotonically increasing surface, then it only
                affects execution time of the program. Since the
                chi^2 surface is rarely so forgiving, it's better to
                err on the side of too small. The default is 1d-3 for
                each parameter.
   BESTCHI2   - The chi^2 of the best fit parameters. If not given, it
                is calculated from BESTPARS using CHI2FUNC.
   ANGULAR    - An array of indices (with up to NPARS elements)
                indicating which elements are angular values. If
                specified, and the step sizes determined are larger
                than 2*pi, the step size will be set to pi.
                NOTE: angular values must be in radians.

 OPTIONAL KEYWORDS:
  DEBUG       - If set, it will print progress to the screen that
                will help identify problems.

 REVISION HISTORY:
   2009/11/23 - Written: Jason Eastman - The Ohio State University
   2013/02/26 - Change print statement to message statement
   2013/03/08 - If it hits a boundary, take the minimum step as the
                stepping scale. We just need a good ballpark, DEMC
                will do the rest.
   2017/07/19 - Use printandlog for print statements
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_getmcmcscale.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETPHASE">
<H2>EXOFAST_GETPHASE</H2></A>
<A HREF="#EXOFAST_GETMCMCSCALE">[Previous Routine]</A>
<A HREF="#EXOFAST_GETTC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_GETPHASE

 PURPOSE:
   Calculates the phase (mean anomaly/(2pi)) corresponding to a
   particular true anomaly.

 CALLING SEQUENCE:
   phase = exofast_getphase(eccen,omega,trueanom [,/PRIMARY]$
                    [,/SECONDARY][,/L4][,/L5][,/PERIASTRON])

 EXAMPLE:
   ;; find the phase of a primary transit described by e and omega 
   phase = exofast_getphase(e,omega,/primary)

 INPUTS: 
   ECCEN: The eccentricity of the orbit, must be between 0 and 1

   OMEGA: The argument of periastron of the star, in radians

   TRUEANOM: The true anomaly (in radians) for which the mean anomaly
   is desired.

 OPTIONAL KEYWORDS:
   PERIASTRON: Find the phase of Periastron (0 by definition)
   PRIMARY: Find the phase of the primary transit
   SECONDARY: Find the phase of the secondary eclipse
   L4: Find the phase of the L4 Langrangian point (leading)
   L5: Find the phase of the L5 Langrangian point (trailing)
   ASCENDINGNODE: Find the phase of Ascending node (maximum RV signal)
   DESCENDINGNODE: Find the phase of the Descending node (minimum RV signal)

 DEPENDENCIES:
   EXOFAST_KEPLEREQ.PRO

 Modification History:
  2010/06 - Rewritten by Jason Eastman (OSU)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_getphase.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETTC">
<H2>EXOFAST_GETTC</H2></A>
<A HREF="#EXOFAST_GETPHASE">[Previous Routine]</A>
<A HREF="#EXOFAST_GETTT[1]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>

 MCMCSS - The MCMC Stellar structure output by exofastv2.pro 

 EPOCHS - An NPLANETS pointer array (must match mcmcss.nplanets),
          pointing to an array specifying the epochs of the desired
          transit times. A null pointer signifies no output desired
          for that planet.

 NSAMPLES - This calculation is expensive and may take a decent
            fraction of the total MCMC runtime. We randomly sample
            NSAMPLES from the MCMCSS values to compute the
            uncertainty in each transit time. Default is 1000. Use -1
            or a value larger than mcmcss.nvalues to compute the Tcs
            at each epoch for all values.

 RESULT - An NPLANETS pointer array, pointing to an NEPOCHS x NSAMPLES
          array of Transit times, including stellar reflex motion and
          fitted TTVs.
 
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_gettc.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETTT[1]">
<H2>EXOFAST_GETTT[1]</H2></A>
<A HREF="#EXOFAST_GETTC">[Previous Routine]</A>
<A HREF="#EXOFAST_GETTT[2]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_GETTT
 PURPOSE:
   Calculates the time of minimum projected separation between the
   star and planet (i.e., the time of transit).

 INPUTS:
   MCMCSS - The MCMC stellar structure saved in the idl (*.mcmc.idl)
            file output by exofastv2.pro  

 RESULT - An NPLANETS pointer array, pointing to an NEPOCHS x NSTEPS
          array of Transit times, including stellar reflex motion and
          fitted TTVs.
 
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast.gettt.bak.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_GETTT[2]">
<H2>EXOFAST_GETTT[2]</H2></A>
<A HREF="#EXOFAST_GETTT[1]">[Previous Routine]</A>
<A HREF="#EXOFAST_KEPLEREQ">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_GETTT
 PURPOSE:
   Calculates the time of minimum projected separation between the
   star and planet (i.e., the time of transit).

 INPUTS:
   MCMCSS - The MCMC stellar structure saved in the idl (*.mcmc.idl)
            file output by exofastv2.pro  

 RESULT - An NPLANETS pointer array, pointing to an NEPOCHS x NSTEPS
          array of Transit times, including stellar reflex motion and
          fitted TTVs.
 
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_gettt.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_KEPLEREQ">
<H2>EXOFAST_KEPLEREQ</H2></A>
<A HREF="#EXOFAST_GETTT[2]">[Previous Routine]</A>
<A HREF="#EXOFAST_LATEXTAB[1]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
    exofast_keplereq
 PURPOSE: 
    Solve Kepler's Equation
 DESCRIPTION:
    Solve Kepler's Equation. Method by S. Mikkola (1987) Celestial
       Mechanics, 40 , 329-334. 
    result from Mikkola then used as starting value for
       Newton-Raphson iteration to extend the applicability of this
       function to higher eccentricities

 CATEGORY:
    Celestial Mechanics
 CALLING SEQUENCE:
    eccanom=exofast_keplereq(m,ecc)
 INPUTS:
    m    - Mean anomaly (radians; can be an array)
    ecc  - Eccentricity
 OPTIONAL INPUT PARAMETERS:

 KEYWORD INPUT PARAMETERS:
    thresh: stopping criterion for the Newton Raphson iteration; the
            iteration stops once abs(E-Eold)<thresh
 OUTPUTS:
    the function returns the eccentric anomaly
 KEYWORD OUTPUT PARAMETERS:
 COMMON BLOCKS:
 SIDE EFFECTS:
 RESTRICTIONS:
 PROCEDURE:
 MODIFICATION HISTORY:
  2002/05/29 - Marc W. Buie, Lowell Observatory.  Ported from fortran routines
    supplied by Larry Wasserman and Ted Bowell.
    http://www.lowell.edu/users/buie/

  2002-09-09 -- Joern Wilms, IAA Tuebingen, Astronomie.
    use analytical values obtained for the low eccentricity case as
    starting values for a Newton-Raphson method to allow high
    eccentricity values as well

  $Log: keplereq.pro,v $
  Revision 1.4  2009/11/04 Jason Eastman (OSU)
  Changed name from keplereq to exofast_keplereq.pro
  Fix infinite loop when diff is near 2pi +/- epsilon.
  Fix infinite loop when oldval and eccanom[i] differ by integer
  multiples of 2pi.
  Consistent implementation of THRESH
  Made 1/6 and 1/24 take full advantage of IDL double precision
  Vectorized for loop -- factors of several faster for (rare) cases
  with many elements to be refined

  Revision 1.3  2005/05/25 16:11:35  wilms
  speed up: Newton Raphson is only done if necessary
  (i.e., almost never)

  Revision 1.2  2004/08/05 10:02:05  wilms
  now also works for more than 32000 time values

  Revision 1.1  2002/09/09 14:54:11  wilms
  initial release into aitlib
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_keplereq.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_LATEXTAB[1]">
<H2>EXOFAST_LATEXTAB[1]</H2></A>
<A HREF="#EXOFAST_KEPLEREQ">[Previous Routine]</A>
<A HREF="#EXOFAST_LATEXTAB[2]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_LATEXTAB

 PURPOSE:
   Prints the latex source to create a delux table of parameter values and
   their errors. The errors are automatically rounded to two
   significant digits and the values are rounded to the last
   significant digit of the error.

   This is intended to reduce typos and alleviate the tedium of making
   tables.

 CALLING SEQUENCE:
   exofast_latextab, array, ['TEXFILE', PARNAMES=,
                     UNITS=,TITLE=,LABEL=, CAPTION=,SIDELABLES=,ORDER]

 INPUTS: 
   ARRAY    - A 2 or 3 column by NPARS rows array with the value,
              +error, -error (e.g., the output from EXOFAST_PLOTDIST). If
              only two columns are specified, all errors are assumed
              to be symmetric. 

 OPTIONAL INPUTS:
   TEXFILE    - If specified, the program will write to this named file
                instead of the screen
   PARNAMES   - If specified, the table will include the parameter
                names as specified by this keyword. Otherwise they will
                be left blank. Parameter names will be bracketed by
                "$" so they are written in math mode.
   UNITS      - If specified, the table will include this
                discriptor/units next to the parameters. Otherwise they will
                be left blank.
   TITLE      - The title of the table
   LABEL      - The label for the table
   CAPTION    - The caption of the table
   ORDER      - An array of indices that specify the order of
                outputs. Default is the input order. If SIDELABLES
                are used, -1 should be inserted in each place the
                next label should be printed.
   SIDELABELS - An array of side labels to print. The number of
                elements must match the number of -1s in the ORDER
                array (this is where each lable will be inserted).
 OUTPUTS:
   Prints the latex source code to generate a table of values.

 Modification History:
  2011/03/10 - Written by Jason Eastman (OSU)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_latextab.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_LATEXTAB[2]">
<H2>EXOFAST_LATEXTAB[2]</H2></A>
<A HREF="#EXOFAST_LATEXTAB[1]">[Previous Routine]</A>
<A HREF="#EXOFAST_LIKE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_LATEXTAB

 PURPOSE:
   Prints the latex source to create a deluxe table of parameter values and
   their errors. The errors are automatically rounded to two
   significant digits and the values are rounded to the last
   significant digit of the error.

   This is intended to reduce typos and alleviate the tedium of making
   tables.

 CALLING SEQUENCE:
   exofast_latextab, array, ['TEXFILE', PARNAMES=,
                     UNITS=,TITLE=,LABEL=, CAPTION=,SIDELABLES=,ORDER]

 INPUTS: 
   ARRAY    - A 2 or 3 column by NPARS rows array with the value,
              +error, -error (e.g., the output from EXOFAST_PLOTDIST). If
              only two columns are specified, all errors are assumed
              to be symmetric. 

 OPTIONAL INPUTS:
   TEXFILE    - If specified, the program will write to this named file
                instead of the screen
   PARNAMES   - If specified, the table will include the parameter
                names as specified by this keyword. Otherwise they will
                be left blank. Parameter names will be bracketed by
                "$" so they are written in math mode.
   UNITS      - If specified, the table will include this
                discriptor/units next to the parameters. Otherwise they will
                be left blank.
   TITLE      - The title of the table
   LABEL      - The label for the table
   CAPTION    - The caption of the table
   ORDER      - An array of indices that specify the order of
                outputs. Default is the input order. If SIDELABLES
                are used, -1 should be inserted in each place the
                next label should be printed.
   SIDELABELS - An array of side labels to print. The number of
                elements must match the number of -1s in the ORDER
                array (this is where each lable will be inserted).
 OUTPUTS:
   Prints the latex source code to generate a table of values.

 Modification History:
  2011/03/10 - Written by Jason Eastman (OSU)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_latextab2.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_LIKE">
<H2>EXOFAST_LIKE</H2></A>
<A HREF="#EXOFAST_LATEXTAB[2]">[Previous Routine]</A>
<A HREF="#EXOFAST_MULTIPLOT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       EXOFAST_LIKE
 PURPOSE:
       Calculates the log likelihood for the given residuals and
       errors. A simpler (and faster) alternative to the wavelet
       analysis of Carter & Winn 2009.

 CALLING SEQUENCE:
       result = exofast_like(residuals, sigma_r, sigma_w [,/chi2])

 INPUTS:
   RESIDUALS - The residuals of a fit (data-model)
   SIGMA_R   - Red noise amplitude parameter
   SIGMA_W   - White noise amplitude parameter

 OPTIONAL KEYWORDS:
   CHI2    - If set, will return the "equivalent chi2". The result
             (-2d0*loglike) is not actually the chi^2, but (a hack),
             designed to be the required output of CHI2FUNC called by
             EXOFAST_DEMC such that it uses the likelihood rather
             than the chi^2. It is equivalent because the difference
             between this and the true chi^2 is a constant that
             cancels when comparing two models (and is ultimately a
             deficiency in using the chi^2 rather than the
             likelihood). This allows us to fit a red noise term
             (sigma_r) while maintaining backward compatibility with
             EXOFAST_DEMC.
  TRUECHI2 - If set, will return the actual chi2.

 OUTPUTS:
    RESULT - alog(likelihood), as defined in Eastman et al., 2013, eqn
             1.

 EXAMPLES:

    ;; return the effective chi2 (for use with EXOFAST_DEMC) with an 
    ;; error scaling term but no red noise
    chi2 = exofast_like(residuals, 0d0, err*scale,/chi2)

 REVISION HISTORY:
       2013/11 - Written, Jason Eastman, LCOGT
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_like.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_MULTIPLOT">
<H2>EXOFAST_MULTIPLOT</H2></A>
<A HREF="#EXOFAST_LIKE">[Previous Routine]</A>
<A HREF="#EXOFAST_OCCULTQUAD">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 Name:
   EXOFAST_MULTIPLOT

 Purpose:
	Create multiple plots with simple control over the gaps between plots.
   By default, the gap is zero but this can be set with the
   gap= keyword, or xgap=, ygap= for individual control over different axes.
   You can also place a single title along the x, y and top axes of the
   matrix of plots using the mtitle, mxtitle and mytitle keywords.

	It is good for data with one or two shared axes and retains all the
	versatility of the plot commands (e.g. all keywords and log scaling).
	The plots are connected with the shared axes, which saves space by
	omitting redundant ticklabels and titles.  Multiplot does this by
	setting !p.position, !x.tickname and !y.tickname automatically.
	A call (multiplot,/reset) restores original values.

   Coyote graphics users can find similar functionality in CGLAYOUT
        http://www.idlcoyote.com/idldoc/cg/cglayout.html
   Users of the post-8.0 IDL function graphics can find similar functionality
   in Paulo Penteado's routine PP_MULTIPLOT
        http://ppenteado.net/idl/pp_lib/doc/pp_multiplot__define.html
 CALLING SEQUENCE:
	multiplot, pmulti, 
       gap=, xgap=, ygap=, 
       /square, 
       /doxaxis, /doyaxis, 
       mTitle=, mTitSize=, mTitOffset=, 
       mxTitle=, mxTitSize=, mxTitOffset=, 
       myTitle=, myTitSize=, myTitOffset=, 
       xtickformat=, ytickformat=
       /default, /reset, /rowmajor, /initialize

 INPUTS:
   pmulti: Optional input. [Nx,Ny] array describing the shape of the
       matrix of plots.  This is equivalent to the 2nd and 3rd elements
       of !p.multi.  Or you can send all 5 elements of the !p.multi.

 KEYWORD INPUTS:
   gap=: Set the gap between plots in normalized units.  Default is 0.
       This input overrides the xgap and ygap inputs.
   xgap=: Gap between plots in the x direction. Default 0. To set both
       x and y gap to the same value just use the gap keyword.
   ygap=: Gap between plots in the y direction. Default 0. To set both
       x and y gap to the same value just use the gap keyword.

   mTitle: A single title to go across the top of the matrix of plots,
       as opposed to the plot over single plots you generate with the
       plot command for example. 
   mTitSize: The font size of the top title. Default is 1.25*!p.charsize
   mTitOffset: Offset of the title in the y-direction.
   mxTitle, mxTitSize, mxTitOffset: same as above but for the x-axis title
   myTitle, myTitSize, myTitOffset: same as above but for the y-axis title

   xtickformat, ytickformat: Set the default tick formats when the ticks
       are plotted. This allows the user to avoid sending this to each
       plotting command which can have unexpected results if that axis
       was not to get tick labels in a given point in the matrix.

 KEYWORDS SWITCHES:
   /square: Force the axis ratio of each plot to be square. Note if
       xgap and ygap are set to different values, this axis ratio will
       not be preserved.  It will be preserved if gap= is used.

   /doxaxis: Put axis labels, etc on the axis. Default is to place labels
       only on the left side and bottom sides of the plot matrix, but may
       be useful when some cells are empty; for example the x-axis of
       a 2x2 grid when only 3 total plots will be created.
   /doyaxis: Put axis labels, etc on the yxis.  Default is to place labels
       only on the left side and bottom sides of the plot matrix, but may
       be useful when some cells are empty; for example the x-axis of
       a 2x2 grid when only 3 total plots will be created.

   /rowmajor: Like setting 5th element of !p.multi to 1. 
   /reset: Set plotting parameters to their saved values from before
       multiplot was initially called.
   /default: Set plotting parameters to IDL defaults.  This is useful
       when the saved parameters get in a whacky state.
   /initialize: Just do the initialization. This is what happends when
       you first call multiplot anyway.

 EXAMPLES:
   ; Make an array of plots [4,3] with a gap of 0.1 (in norm. coords.)
   ; and overall titles along the x and y axes as given.  Force the
   ; plots to be square.

       cgerase & multiplot, [4,3], /square, gap=0.1, mXtitle='R', mYtitle='F(R)'
       for i=0,4*3-1 do begin
           cgplot, struct[i].x, struct[i].y, psym=4
           multiplot
       endfor
       multiplot,/reset

 Side Effects:
   Multiplot sets a number of system variables: !p.position, !p.multi,
	!x.tickname, !y.tickname, !P.noerase---but all can be reset with
	the call: multiplot,/reset  

   Things can get out of wack if your program crashes in the middle of 
   making a matrix of plots, and often /reset will not fix it.  In those 
   cases, calling multiplot,/default will often fix the problem.

 Restrictions:
	1. If you use !p.multi as the method of telling how many plots
	are present, you have to set !p.multi at the beginning each time you
	use multiplot or call multiplot with the /reset keyword.
	2. There is no way to make plots of different sizes; each plot
	covers the same area on the screen or paper.

 Modification history:
	write, 21-23 Mar 94, Fred Knight (knight@ll.mit.edu)
	alter plot command that sets !x.window, etc. per suggestion of
	  Mark Hadfield (hadfield@storm.greta.cri.nz), 7 Apr 94, FKK
	add a /default keyword restore IDL's default values of system vars,
	  7 Apr 94, FKK
	modify two more sys vars !x(y).tickformat to suppress user-formatted
	  ticknames, per suggestion of Mark Hadfield (qv), 8 Apr 94, FKK
       
   2001-03-20    Added /square keyword
       Work in device coordinates so we can force aspect ratio to be square 
       if requested. Erin Scott Sheldon UMichigan
       
   2007-06-18
       Can now place titles on the overall x and y axes, as well as a 
       top title using these new keywords. 
           mTitle=, mTitSize=, mTitOffset=, 
           mxTitle=, mxTitSize=, mxTitOffset=, 
           myTitle=, myTitSize=, myTitOffset=, 
       Can also control overall tick formats. Useful because can just call
       multiplot initially and set this, while calling on each call to
       the plotting program will have unexpected results if the ticks
       are not to be labelled for that place in the matrix.
           xtickformat, ytickformat
       Erin Sheldon, NYU
   2007-08-28:
       Can now add gaps between the plots with these keywords:
           gap=, xgap=, ygap=
       where the values are in normalized coordinates. Erin Sheldon, NYU
   2009-11-23
       Initialize common block if M[X/Y]TITLE set W. Landsman 
   2011-02-07
        Use Coyote Graphics  W. Landsman    
   2012-03-21
        Use cgplot on initial call to get right background  W.L.
   2014-02-04
        Handle  [X/Y].OMargin   A. Negri, Bologna

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_multiplot.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_OCCULTQUAD">
<H2>EXOFAST_OCCULTQUAD</H2></A>
<A HREF="#EXOFAST_MULTIPLOT">[Previous Routine]</A>
<A HREF="#EXOFAST_OCCULTQUAD_CEL">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_OCCULTQUAD

 PURPOSE: 
   This routine computes the lightcurve for occultation of a
   quadratically limb-darkened source without microlensing.  Please
   cite Mandel & Agol (2002) and Eastman et al., (2013) if you make use
   of this routine in your research.  Please report errors or bugs to
   agol@astro.washington.edu and jason.eastman@cfa.harvard.edu

 Limb darkening has the form:
  I(r)=[1-u1*(1-sqrt(1-(r/rs)^2))-u2*(1-sqrt(1-(r/rs)^2))^2]/(1-u1/3-u2/6)/pi
 
 CALLING SEQUENCE:
    occultquad, z0, u1, u2, p0, muo1, mu0, d=d

 INPUTS:

    z0 - impact parameter in units of rs
    u1 - linear    limb-darkening coefficient (gamma_1 in paper)
    u2 - quadratic limb-darkening coefficient (gamma_2 in paper)
    p0 - occulting star size in units of rs

 OUTPUTS:

    muo1 - fraction of flux at each z0 for a limb-darkened source

 OPTIONAL OUTPUTS:

    mu0  - fraction of flux at each z0 for a uniform source
    d    - The coefficients required to analytically calculate the
           limb darkening parameters (see Eastman et al, 2013). For
           backward compatibility, u1 and u2 are required, but not
           necessary if d is used.

 EXAMPLES:  

; Calculate the same geometric transit with two different sets of
; limb darkening coefficients
 p = 0.1d0
 b = 0.5d0
 x = (dindgen(300)/299d0 - 0.5d0)*2d0
 z = sqrt(x^2 + b^2)
 u1 = 0.25d0
 u1 = 0.75d0
 exofast_occultquad, z, u1, u2, p, muo1, muo, d=d

 MODIFICATION HISTORY
 
  2002 -- Eric Agol 2002

  2009/04/06 -- Eric Agol (University of Washington) and 
                Jason Eastman (Ohio State University)
    fixed bugs for p > 1 (e.g., secondary eclipses)
    used double precision constants throughout
    replaced rj,rc,rf with ellpic_bulirsch
      faster, more robust integration for specialized case of
      elliptic integral of the third kind
    vectorized
    more efficient case handling
    combined ellk and ellec into ellke for speed
    200x speed improvement over previous IDL code in typical case
    allow negative values of p (anti-transit) to avoid Lucy-Sweeney
    like bias
 2018/12/12 -- Catch rare bug that hangs the code when planet and
               stellar limb are within 10^-13 of one another.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_occultquad.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_OCCULTQUAD_CEL">
<H2>EXOFAST_OCCULTQUAD_CEL</H2></A>
<A HREF="#EXOFAST_OCCULTQUAD">[Previous Routine]</A>
<A HREF="#EXOFAST_PLOTDIST_CORNER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_OCCULTQUAD_CEL

 PURPOSE: 
   This routine computes the lightcurve for occultation of a
   quadratically limb-darkened source without microlensing.  Please
   cite Mandel & Agol (2002) and Eastman et al., (2013) if you make use
   of this routine in your research.  Please report errors or bugs to
   agol@astro.washington.edu and jason.eastman@cfa.harvard.edu

 Limb darkening has the form:
  I(r)=[1-u1*(1-sqrt(1-(r/rs)^2))-u2*(1-sqrt(1-(r/rs)^2))^2]/(1-u1/3-u2/6)/pi
 
 CALLING SEQUENCE:
    exofast_occultquad_cel, z0, u1, u2, p0, muo1, mu0, d=d

 INPUTS:

    z0 - impact parameter in units of rs
    u1 - linear    limb-darkening coefficient (gamma_1 in paper)
    u2 - quadratic limb-darkening coefficient (gamma_2 in paper)
    p0 - occulting star size in units of rs

 OUTPUTS:

    muo1 - fraction of flux at each z0 for a limb-darkened source

 OPTIONAL OUTPUTS:

    mu0  - fraction of flux at each z0 for a uniform source
    d    - The coefficients required to analytically calculate the
           limb darkening parameters (see Eastman et al, 2013). For
           backward compatibility, u1 and u2 are required, but not
           necessary if d is used.

 EXAMPLES:  

; Calculate the same geometric transit with two different sets of
; limb darkening coefficients
 p = 0.1d0
 b = 0.5d0
 x = (dindgen(300)/299d0 - 0.5d0)*2d0
 z = sqrt(x^2 + b^2)
 u1 = 0.25d0
 u1 = 0.75d0
 exofast_occultquad, z, u1, u2, p, muo1, muo, d=d

 MODIFICATION HISTORY
 
  2002 -- Eric Agol 2002

  2009/04/06 -- Eric Agol (University of Washington) and 
                Jason Eastman (Ohio State University)
    fixed bugs for p > 1 (e.g., secondary eclipses)
    used double precision constants throughout
    replaced rj,rc,rf with ellpic_bulirsch
      faster, more robust integration for specialized case of
      elliptic integral of the third kind
    vectorized
    more efficient case handling
    combined ellk and ellec into ellke for speed
    200x speed improvement over previous IDL code in typical case
    allow negative values of p (anti-transit) to avoid Lucy-Sweeney like bias
  2018/12/12 -- Now uses more stable integrations, 25% faster
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_occultquad_cel.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_PLOTDIST_CORNER">
<H2>EXOFAST_PLOTDIST_CORNER</H2></A>
<A HREF="#EXOFAST_OCCULTQUAD_CEL">[Previous Routine]</A>
<A HREF="#EXOFAST_QUERYVIZIER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_plotdist_corner
 PURPOSE:
   Plots the distributions from MCMC chains (Probability Distribution
   Functions (PDFs) and covariances; returns median values and 68%
   confidence intervals.

 DESCRIPTION:

 CALLING SEQUENCE:
   exofast_plotdist_corner, pars [,MEDIANPARS, PARNAMES=, UNITS=,
                     /NOCOVAR, PDFNAME=, COVARNAME=, BESTPARS=, PROBS=, /DEGREES]

 INPUTS:
   SS         - The stellar structure created by EXOFASTv2, populated
                with an array of values for each parameter

 OPTIONAL INPUTS:
   PDFNAME    - The filename of the output postscript plot of
                PDFs. Default is pdf.ps
   COVARNAME  - The filename of the output postscript plot of
                covariances of fitted parameters. Default is covar.ps. 
   PROBS      - Array of probability contours to draw on the covariance
                plots. Default is erf([1d,2d]/sqrt(2d0)) ~ [0.68,0.95].
   LOGNAME    - The name of the logfile to print messages to.

 OPTIONAL KEYWORDS:
   NOCOVAR    - If set, no covariances plots will be made. Since
                there will be NFIT*(NFIT-1)/2 plots, this can be
                time consuming.
 OUTPUTS:
   MEDIANPARS - A 3 x NPARS array of median values, +err, -err (68%
                confidence interval)
   PDFNAME    - A postscript plot of Probablity Distribution
                Functions (PDFs)
   COVARNAME  - A postscript plot of covariances.

 REVISION HISTORY:
   2009/11/24 - Written: Jason Eastman - The Ohio State University
   2013/03/12 - Fixed min/max, made slightly more efficient
   2018/02/13 - Covariance plot now a corner plot inspired by
                corner.py (much prettier)
   2018/03/15 - Identify and discard bad chains before inference
   2018/10/18 - Remove misleading (and unused) ANGULAR parameter;
                functionality applied with unit property in
                summarizepar.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_plotdist_corner.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_QUERYVIZIER">
<H2>EXOFAST_QUERYVIZIER</H2></A>
<A HREF="#EXOFAST_PLOTDIST_CORNER">[Previous Routine]</A>
<A HREF="#EXOFAST_RANDOM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME: 
   EXOFAST_QUERYVIZIER

 PURPOSE: 
   Query any catalog in the Vizier database by position
 
 EXPLANATION:
   Uses the IDL SOCKET command to provide a positional query of any catalog 
   in the the Vizier (http://vizier.u-strasbg.fr/) database over the Web and
   return results in an IDL structure.    
 
    
 CALLING SEQUENCE: 
     info = exofast_QueryVizier(catalog, targetname_or_coords, [ dis
                        /ALLCOLUMNS, /CFA, CONSTRAINT= ,/VERBOSE ])

 INPUTS: 
      CATALOG - Scalar string giving the name of the VIZIER catalog to be
            searched.    The complete list of catalog names is available at
            http://vizier.u-strasbg.fr/vizier/cats/U.htx . 

            Popular VIZIER catalogs include 
            'II/328'- AllWISE Data Release (Cutri+ 2013)
            'V/139' - Sloan SDSS photometric catalog Release 9 (2012)
            '2MASS-PSC' - 2MASS point source catalog (2003)
            'GSC2.3' - Version 2.3.2 of the HST Guide Star Catalog (2006)
            'USNO-B1' - Verson B1 of the US Naval Observatory catalog (2003)
            'UCAC4'  - 4th U.S. Naval Observatory CCD Astrograph Catalog (2012)
            'B/DENIS/DENIS' - 2nd Deep Near Infrared Survey of southern Sky (2005)
            'I/337/gaia' - Gaia DR1 Data Release 1 (2016)
            'I/311/HIP2' - Hipparcos main catalog, new reduction (2007)

          Note that some names will prompt a search of multiple catalogs
          and QUERYVIZIER will only return the result of the first search.
          Thus, setting catalog to "HIP2" will search all catalogs 
          associated with the Hipparcos mission, and return results for the
          first catalog found.    To specifically search the Hipparcos or
          Tycho main catalogs use the VIZIER catalog names listed above
                             
      TARGETNAME_OR_COORDS - Either a scalar string giving a target name, 
          (with J2000 coordinates determined by SIMBAD), or a 2-element
          numeric vector giving the J2000 right ascension in *degrees* and 
          the target declination in degrees.
          If the targetname is set to 'NONE' then QUERYVIZIER will perform
          an all-sky search using the constraints given in the CONSTRAINT
          keyword.   
 OPTIONAL INPUT:
    dis - scalar or 2-element vector.   If one value is supplied then this
          is the search radius in arcminutes.     If two values are supplied
          then this is the width (i.e., in longitude direction) and height
          of the search box.   Default is a radius search with radius of
          5 arcminutes

 OUTPUTS: 
   info - Anonymous IDL structure containing information on the catalog  
          sources within the specified distance of the specified center.  The 
          structure tag names are identical with the VIZIER  catalog column 
          names, with the exception of an occasional underscore
          addition, if necessary to convert the column name to a valid 
          structure tag.    The VIZIER Web  page should consulted for the 
          column names and their meaning for each particular catalog..
           
          If the tagname is numeric and the catalog field is blank then either
          NaN  (if floating) or -1 (if integer) is placed in the tag.

          If no sources are found within the specified radius, or an
          error occurs in the query then -1 is returned. 
 OPTIONAL KEYWORDS:
          /ALLCOLUMNS - if set, then all columns for the catalog are returned
                 The default is to return a smaller VIZIER default set. 

          /CFA - By default, the query is sent to the main VIZIER site in
            Strasbourg, France.   If /CFA is set then the VIZIER site
            at the Harvard Center for Astrophysics (CFA) is used instead.
            Note that not all Vizier sites have the option to return
            tab-separated values (TSV) which is required by this program.
   
          CONSTRAINT - string giving additional nonpositional numeric 
            constraints on the entries to be selected.     For example, when 
            in the GSC2.3  catalog, to only select sources with Rmag < 16 set 
            Constraint = 'Rmag<16'.    Multiple constraints can be 
            separated by commas.    Use '!=' for "not equal", '<=' for smaller
            or equal, ">=" for greater than or equal.  See the complete list
            of operators at  
                 http://vizier.u-strasbg.fr/doc/asu.html#AnnexQual
            For this keyword only, **THE COLUMN NAME IS CASE SENSITIVE** and 
            must be written exactly as displayed on the VIZIER Web page.  
            Thus for the GSC2.3 catalog one must use 'Rmag' and not 'rmag' or
            'RMAG'.    In addition, *DO NOT INCLUDE ANY BLANK SPACE* unless it 
            is a necessary part of the query.
         
           /SILENT - If set, then no message will be displayed if no sources
                are found.    Error messages are still displayed.
           /VERBOSE - If set then the query sent to the VIZIER site is
               displayed, along with the returned title(s) of found catalog(s)
 EXAMPLES: 
          (1) Plot a histogram of the J magnitudes of all 2MASS point sources 
          stars within 10 arcminutes of the center of the globular cluster M13 

          IDL>  info = queryvizier('2MASS-PSC','m13',10)
          IDL> plothist,info.jmag,xran=[10,20]

          (2)  Find the brightest J mag GSC2.3 source within 3' of the 
               J2000 position ra = 10:12:34, dec = -23:34:35
          
          IDL> str = queryvizier('GSC2.3',[ten(10,12,34)*15,ten(-23,34,35)],3)
          IDL> print,min(str.jmag,/NAN)

          (3) Find sources with V < 19 in the Magellanic Clouds Photometric 
              Survey (Zaritsky+, 2002) within 5 arc minutes of  the position 
              00:47:34 -73:06:27

              Checking the VIZIER Web page we find that this catalog is
          IDL>  catname =  'J/AJ/123/855/table1'
          IDL>  ra = ten(0,47,34)*15 & dec = ten(-73,6,27)
          IDL> str = queryvizier(catname, [ra,dec], 5, constra='Vmag<19')

          (4) Perform an all-sky search of the Tycho-2 catalog for stars with
              BTmag = 13+/-0.1

         IDL> str = queryvizier('I/259/TYC2','NONE',constrain='BTmag=13+/-0.1')

 PROCEDURES USED:
          GETTOK(), REMCHAR, REPSTR(), STRCOMPRESS2(), ZPARCHECK
 TO DO:
       (1) Allow specification of output sorting
 MODIFICATION HISTORY: 
         Written by W. Landsman  SSAI  October 2003
         Added /SILENT keyword  W.L.  Jan 2009
         Avoid error if output columns but not data returned W.L. Mar 2010
         Ignore vector tags (e.g. SED spectra) W.L.   April 2011
         Better checking when more than one catalog returned W.L. June 2012
         Assume since IDL V6.4 W.L. Aug 2013
         Update HTTP syntax for /CANADA    W. L.  Feb 2014
         Add CFA keyword, remove /CANADA keyword  W.L. Oct 2014
         Use IDLnetURL instead of Socket   W.L.    October 2014
         Add Catch, fix problem with /AllColumns W.L. September 2016
         Rename to EXOFAST_queryvizier for distribution with
         EXOFASTv2 (older versions are incompatible); JDE Aug 2018
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_queryvizier.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_RANDOM">
<H2>EXOFAST_RANDOM</H2></A>
<A HREF="#EXOFAST_QUERYVIZIER">[Previous Routine]</A>
<A HREF="#EXOFAST_RECENTER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
        EXOFAST_RANDOM

 PURPOSE: 

        EXOFAST_RANDOM is a wrapper for pg_ran, the IDL translation
        of ran from "Numerical Recipes Third Edition", page 342 by
        Paolo C. Grigis, to make it a drop in replacement of RANDOMU
        for normal or uniform deviates.
        http://hea-www.cfa.harvard.edu/~pgrigis/idl_stuff/pg_ran.pro

        While statistically, it is a far superior routine to IDL's
        built-in, ran1 based, RANDOMU, it is also substantially (120x)
        slower, as random number generators require serial
        operations, which IDL does poorly.

        If sequences larger than ~10^7 are required, IDL's built-in
        routine is insufficient.

        Call with a NEGATIVE or UNDEFINED SEED TO INITIALIZE
        thereafter, do not alter seed between successive deviates in
        a sequence.

 CALLING SEQUENCE:

        Result = EXOFAST_RANDOM(Seed [, D1, ..., Dn,/normal])

 INPUTS:
         Seed   - A named variable containing the seed value for
                  random number generation. Seed is updated
                  once for each random number generated. The initial
                  value of Seed should be set to different NEGATIVE
                  values in order to obtain different random
                  sequences. An undefined variable name can be
                  specified and it will begin the seed with
                  -systime(/seconds). It is an error not to specify a
                  seed.
 OPTIONAL INPUTS:
        Di      - The dimensions of the result. The dimension
                  parameters can be any scalar expression. Up to eight
                  dimensions can be specified. If no dimensions are
                  specified, RAN2 returns a scalar result
 OPTIONAL KEYWORDS:
        NORMAL  - Set this keyword to generate random normal deviates
                  which uses an IDL translation of the Numerical
                  Recipes routine gasdev with the uniform deviates
                  generated from pg_ran.

 OUTPUTS:
        This function returns uniform random deviates between 0.0 and
        1.0 (exclusive of the endpoint values) or normal deviates if
        /NORMAL is set, with array dimensions given by the input
        parameters, D1, ..., Dn.

 MODIFICATION HISTORY:
        Written by: Jason Eastman, OSU 3/2/2009 
          Based on Numerical Recipes Third Edition page 342
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_random.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_RECENTER">
<H2>EXOFAST_RECENTER</H2></A>
<A HREF="#EXOFAST_RANDOM">[Previous Routine]</A>
<A HREF="#EXOFAST_ROSSITER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_RECENTER

 PURPOSE: 
   Recenters a distribution of periodic parameters to the domain
      (mode-period/2,mode+period/2]

 CALLING SEQUENCE:
   par = recenter(par,period)

 INPUTS:
   PAR    = An array of parameters
   PERIOD = The period of the parameter distribution

 EXAMPLE:

 MODIFICATION HISTORY
  2012/06 -- Jason Eastman (LCOGT)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_recenter.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_ROSSITER">
<H2>EXOFAST_ROSSITER</H2></A>
<A HREF="#EXOFAST_RECENTER">[Previous Routine]</A>
<A HREF="#EXOFAST_RV">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_ROSSITER

 PURPOSE: 
   This routine implements the Ohta et al 2005 approximation for the
   Rossiter-Mclaughlin effect, which assumes linear limb darkening
   and is accurate to ~1 m/s for slowly rotating stars (see Hirano 2011).

 CALLING SEQUENCE:
   exofast_rossiter, x, y, u1, p, vsini, lambda, deltarv, z=z

 INPUTS:
    x      - array of star-planet distances in the x direction
             (stellar radii).
    y      - array or scalar of star-planet distance(s) in the y
             direction. ie, the impact parameter (stellar radii)
    u1     - linear limb-darkening coefficient -- epsilon in paper
    p      - occulting star size (stellar radii) -- gamma in paper
    vsini  - projected stellar surface velocity (same as output units)
    lambda - projected spin-orbit angle (radians)
    
 OPTIONAL INPUTS:
    z      - array of star-planet distances in the z direction. 
               -- Positive => in front of star (RM effect)
               -- Negative => behind star (no effect)
               -- assumed positive if not specified
 OUTPUTS:
    deltarv - Approximate Change in RV at each z due to the Rossiter
              Mclaughlin effect (units same as vsini) 
                     *** accurate to ~1 m/s ***

 MODIFICATION HISTORY
  2009/04/30 -- Jason Eastman (Ohio State University)
     Loose translation from Scott Gaudi's (OSU) fortran code
  2012/08 -- Jason Easmtan (LCOGT)
     Make sign convention ahere to standard (now consistent with EXOFAST_GETB).
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_rossiter.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_RV">
<H2>EXOFAST_RV</H2></A>
<A HREF="#EXOFAST_ROSSITER">[Previous Routine]</A>
<A HREF="#EXOFAST_TEXTOIDL[1]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_rv

 PURPOSE: 
   This function returns the radial velocity at each BJD. Optionally
   includes the Rossiter McLaughlin effect, using the Ohta et al 2005
   approximation good to ~1 m/s.
 
 CALLING SEQUENCE:
   result = exofast_rv(bjd, TPeriastron, period, V0, K, e, omega, $
                       i=i, a=a, u1=u1, p=p, vsini=vsini, lambda=lambda, $
                       r_star=r_star, slope=slope)

 INPUTS:
   bjd         - Barycentric Julians dates for desired impact parameters
   tperiastron - periastron passage time (BJD)
   Period      - Period of orbit (days)
   V0          - systemic velocity (m/s)
   K           - radial velocity semi-amplitude (m/s)

 OPTIONAL INPUTS:  
   e           - eccentricity of orbit (0 if not specified)
   omega       - orbit's argument of periastron (radians) 
                 - required if e is specified
                 - assumed to be pi/2 if e not specified
                 - omega of the orbit being measured (for exoplanets, omega_*)
       
   slope       - the slope of the RV signal
   t0          - the time at which V0 is referenced, if a slope is
                 given. If not given, (maxtime + mintime)/2 is
                 assumed.
                 NOTE: if comparing two data sets with a slope and
                 different times, this must be specified.

 OPTIONAL KEYWORDS:
   rossiter    - If set, calculates the RM effect. All values below
                 must also be specified.

 Optional parameters (required for Rossiter-McLaughlin effect)
   i           - inclination of orbit (radians)
   a           - semi-major axis (R_star)
   u1          - linear limb-darkening coefficient
   p           - occulting star size (stellar radii)
   vsini       - projected stellar surface velocity (m/s)
   lambda      - projected spin-orbit angle (radians)   

 OUTPUTS:
    result     - the radial velocity of the star at each point

 MODIFICATION HISTORY 
  2009/05/01 -- Jason Eastman (Ohio State University)
  2013/10/15 -- Clarified documentation
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_rv.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_TEXTOIDL[1]">
<H2>EXOFAST_TEXTOIDL[1]</H2></A>
<A HREF="#EXOFAST_RV">[Previous Routine]</A>
<A HREF="#EXOFAST_TEXTOIDL[2]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 SPECIAL NOTE: 
       The file textoidl_trans_sub_super.pro contains two functions,
       textoidl_trans_sub_super, and textoidl_sub_sup.  The former is the
       generic routine for processing TeX sub/superscripts, the
       latter is used only by textoidl_trans_sub_super and has no general
       utility.  Hence it lives here.  You will see documentation for
       textoidl_trans_sub_super second if you use DOC_LIBRARY.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_TEXTOIDL[2]">
<H2>EXOFAST_TEXTOIDL[2]</H2></A>
<A HREF="#EXOFAST_TEXTOIDL[1]">[Previous Routine]</A>
<A HREF="#EXOFAST_TRAN">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       EXOFAST_TEXTOIDL
 PURPOSE:
       Convert a valid TeX string to a valid IDL string for plot labels.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       new = textoidl(old)
 INPUTS:
       old            -- TeX string to be converted.  Will not be     in
                         modified.  old may be a string array.
 KEYWORD PARAMETERS:
       FONT           -- Set to 0 to use hardware font, -1 to use 
                         vector.  Note that the only hardware font 
                         supported is PostScript.
       /TEX_SEQUENCES -- return the available TeX sequences
       /HELP          -- print out info on use of the function
                         and exit.
 OUTPUTS:
       new            -- IDL string corresponding to old.             out
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
       - Use the procedure SHOWTEX to get a list of the available TeX
         control sequences.  
       - The only hardware font for which translation is available is
         PostScript. 
       - The only device for which hardware font'
         translation is available is PostScript.'
       - The FONT keyword overrides the font selected'
         by !p.font'
 EXAMPLE:
       out = TeXtoIDL('\Gamma^2 + 5N_{ed}')
       The string out may be used in XYOUTS or other IDL text
       display routines.  It will be an uppercase Gamma, with an
       exponent of 2, then a plus sign, then an N with the subscript
       ed.
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.4  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.3  1996/05/09 00:22:17  mcraig
       Added error handling, cleaned up documentation.

       Revision 1.2  1996/02/08 18:52:50  mcraig
       Added ability to use hardware fonts for PostScript device.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_TRAN">
<H2>EXOFAST_TRAN</H2></A>
<A HREF="#EXOFAST_TEXTOIDL[2]">[Previous Routine]</A>
<A HREF="#EXOFAST_TWILIGHT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   EXOFAST_TRAN

   PURPOSE:
      Computes a transit model given a complete set of physical
      parameters

  CALLING SEQUENCE:
      model = EXOFAST_TRAN(time, inc, ar, tp, period, e, omega, p, u1, u2, f0, $
                       rstar=rstar, thermal=thermal, reflect=reflect, $
                       dilute=dilute, tc=tc, q=q,x1=x1,y1=y1,z1=z1,
                       au=au,c=c)

  INPUTS:
     TIME   - The BJD_TDB time of the model to compute. Scalar or
              array.
     INC    - The inclination of the planetary orbit, in radians
     AR     - a/Rstar, the semi-major axis of the planetary orbit in
              units of stellar radii
     TP     - The time of periastron, in BJD_TDB
     PERIOD - The planetary orbital period, in days
     E      - The planetary eccentricity
     OMEGA  - The argument of periastron, in radians
     P      - Rp/Rstar, the planetary radius in units of stellar
              radii
     U1     - The linear limb darkening parameter
     U2     - The quadratic limb darkening parameter
     F0     - The transit baseline level

 OPTIONAL INPUTS:
     RSTAR   - The stellar radius **in AU**. If supplied, it will
               apply the light travel time correction to the target's
               barycenter
     THERMAL - The thermal emission contribution from the planet, in ppm.
     REFLECT - The reflected light from the planet, in ppm. 
     DILUTE  - The fraction of to basline flux that is due to
               contaminating sources. DILUTE = F2/(F1+F2), where F1
               is the flux from the host star, and F2 is the flux
               from all other sources in the aperture.
     TC      - The time of conjunction, used for calculating the
               phase of the reflected light component. If not
               supplied, it is computed from e, omega, period.
     Q       - M1/M2. The mass ratio of the primary to companion. If
               supplied, the stellar reflex motion is computed and
               applied.
     X1      - The X motion of the star due to all other bodies in the
               system, in units of Rstar with the origin at the
               barycenter. Output from exofast_getb2.pro.
     Y1      - Same as X1, but in the Y direction
     Z1      - Same as X1, but in the Z direction
     AU      - The value of the AU, in solar radii, default is
               215.094177d0
     C       - The speed of light, in AU/day (default is computed in
               TARGET2BJD).
  OUTPUTS:
    MODEL - The transit model as a function of time
 
  REVISION HISTORY:
    2015 (?) - Written by Jason Eastman (CfA)
    2018/10  - Documented (JDE)
    2019/01/28 - Replaced incorrect arg_present check with n_elements
               check. Didn't convert to target frame before,
               as called by exofast_chi2v2.pro
    
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_tran.pro)</STRONG><P>
<HR>
 
<A NAME="EXOFAST_TWILIGHT">
<H2>EXOFAST_TWILIGHT</H2></A>
<A HREF="#EXOFAST_TRAN">[Previous Routine]</A>
<A HREF="#GETAVPRIOR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   exofast_twilight
 PURPOSE:
   Calculate the time of twilight (sunrise/sunset) to ~2 minute
   accuracy (as compared to sunpos/eq2hor, which claims 2.2"/1"
   accuracy, respectively).

   Algorithm from http://williams.best.vwh.net/sunrise_sunset_algorithm.htm
   Almanac for Computers, 1990
   published by Nautical Almanac Office
   United States Naval Observatory
   Washington, DC 20392

 INPUTS:
   JD        - The Julian date of days to calculate the twilight, in
               UT. Scalar or vector.
   OBSNAME   - Name of the observatory (calls
               observatory.pro). Either OBSNAME or
               LATITUDE/LONGITUDE must be specified.
   LATITUDE  - Latitude of the observatory, in degrees.
   LONGITUDE - Longitude of the observatory, in degrees West.

 OPTIONAL INPUTS:
   HORIZON   - The Sun altitude that is considered twilight, in
               degrees.
               Civil Twilight = -6 degrees.
               Nautical Twilight = -12 degrees. (Default)
               Astronomical Twilight = -18 degrees.
   TZ        - The timezone of the observatory, in hours west of
               Greenwich. Ignored unless /LOCAL is set.

 OPTIONAL KEYWORDS:
   SUNSET    - Return the time of sunset instead of sunrise.
   LOCAL     - Return the result in local time. TZ must be specified
               if this keyword is set.
               NOTE: This does not take into account DST.

 RESULT:
   Returns the julian date of sunrise (or sunset, if /SUNSET is
   set). If the sun is always down for the particular date, the
   result will be -1. If the sun is always up for the particular
   date, the result will be -2.

 REVISION HISTORY:
   2011/01/27 - Written: Jason Eastman - The Ohio State University
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_twilight.pro)</STRONG><P>
<HR>
 
<A NAME="GETAVPRIOR">
<H2>GETAVPRIOR</H2></A>
<A HREF="#EXOFAST_TWILIGHT">[Previous Routine]</A>
<A HREF="#GETBURNNDX">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   GETAVPRIOR

 PURPOSE:

   Returns the maximum V-band extinction (Av) from Schlafly and
   Finkbeiner (2011) to be used as an upper bound on EXOFASTv2 SED
   fits.

   If you use this code in your research, please cite:
   Schlafly and Finkbeiner (2011)
   http://adsabs.harvard.edu/abs/2011ApJ...737..103S
 
 CALLING SEQUENCE:
   maxav = getavprior(ra=ra,dec=dec,object=object,line=line)

 OPTIONAL INPUTS:
 
   RA     - The J2000 RA of the object in decimal degrees, from which to get the Av.
   DEC    - The J2000 Dec of the object in decimal degrees, from which to get the Av.
   OBJECT - The name of the object to be resolved by SIMBAD. Either
            OBJECT or RA and DEC must be specified
 OPTIONAL OUTPUTS:
   LINE   - The line in the prior file to impose an upper bound at
            the maxav from the Schlegel maps.
 
  RESULT 
   The maximum V-band extinction (Av)

 MODIFICATION HISTORY
 
  2018/04 -- Written, Jason Eastman (CfA)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/getavprior.pro)</STRONG><P>
<HR>
 
<A NAME="GETBURNNDX">
<H2>GETBURNNDX</H2></A>
<A HREF="#GETAVPRIOR">[Previous Routine]</A>
<A HREF="#GOLDENRATIO">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   GETBURNNDX
 PURPOSE:
   Returns the index of the first useable link in a Markov chain.

 DESCRIPTION: 
   Determines the point at which all chains have had at least one
   chi^2 lower than the median chi^2 of the best chain. If some
   chains never reach this point or reach this point very late, they
   are ignored in the calculation.
   
   nsteps*0.1 <= burnndx <= nsteps*0.9
 
   That is...

   It will always discard at least 10% of the steps in case the
   initialization of the chains is insufficiently scattered around
   the best fit, which would bias the results toward the starting
   value.
 
   It will never discard more than 90% of the steps to enable the
   robust calculation of mixing criteria.

 CALLING SEQUENCE: 
   burnndx = getburnndx(chi2 [,GOODCHAINS=,BADCHAINS=])

 INPUTS:
   
   CHI2 - An NSTEPS x NCHAINS array of chi2 values
 
 OPTIONAL OUTPUTS:
 
   GOODCHAINS - An array of indices of chains that are good, meaning
                they have at least one point below the median of the
                best chain.  
   BADCHAINS  - An array of indices of chains that are bad, meaning
                their chi2 is never below the median of the best
                chain

   MEDCHI2    - The median chi2 of the best chain

 REVISION HISTORY:
   2018/03 - Written -- Jason Eastman (CfA)
   2018/04 - Modified goodchains to maximize the total number of
             saved links
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/getburnndx.pro)</STRONG><P>
<HR>
 
<A NAME="GOLDENRATIO">
<H2>GOLDENRATIO</H2></A>
<A HREF="#GETBURNNDX">[Previous Routine]</A>
<A HREF="#JSON_PARSE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   GOLDENRATIO

 PURPOSE: 
   Uses the golden section search to find the minimum of a unimodal
   function between the supplied bounds.  

   Implementation translated from here:
   https://en.wikipedia.org/wiki/Golden-section_search

 CALLING SEQUENCE:
    min = goldenratio('func', min, max)

 INPUTS:

    FUNC - A string specifying the name of the function to be
           minimized
    A    - The minimum bound on the function to be minimized
    B    - The maximum bound on the function to be minimized

 OPTIONAL INPUTS:
 
    TOL  - The tolerance, after which the function is deemed
           sufficiently close to the minimum
 RESULT:

    The minimum value

 MODIFICATION HISTORY
 
  2018/11/13 -- Written by Jason Eastman, CfA

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/goldenratio.pro)</STRONG><P>
<HR>
 
<A NAME="JSON_PARSE">
<H2>JSON_PARSE</H2></A>
<A HREF="#GOLDENRATIO">[Previous Routine]</A>
<A HREF="#KTOM2">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 :Description:
    The JSON_PARSE function takes a JSON string and converts it into
    an IDL variable.

 :Returns:
    If *String* begins with a curly brace "{", then the result is
    a HASH, containing the unordered name-value pairs from the JSON string.
    If *String* begins with a square bracket "[", then the result is
    a LIST, containing the ordered collection of values.
    If *String* is a scalar string that does not begin with "{" or "[",
    then it is assumed to be a file name. If the file exists, then the
    contents of the file are read and parsed.

    *Note*: When converting JSON strings into IDL variables,
    the following rules are used:
      "null" becomes !NULL.
      "false" becomes byte 0, "true" becomes byte 1.
      Integer values become IDL variables of type LONG64.
      Floating-point numbers become IDL variables of type DOUBLE.
      Strings will be converted to IDL strings, and all \ escaped characters
      will be converted back to normal characters.
      JSON arrays will become IDL LIST variables.
      JSON objects will become IDL HASH variables.
   
    *Note*: Since the HASH stores its name-value pairs in an arbitrary
    order, the HASH::Keys() method may return the name-value pairs
    in a different order compared to the original JSON string.
   
 :Params:
    String:
      *String* must be a valid JSON string containing either a
      JSON *object* of name-value pairs, or a JSON *array* of values.

 :Keywords:
    None


 :Author:
   CT, VIS, Jan 2012. Based on the IDLffJSON, written by Dawn Lenz.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/json_parse.pro)</STRONG><P>
<HR>
 
<A NAME="KTOM2">
<H2>KTOM2</H2></A>
<A HREF="#JSON_PARSE">[Previous Routine]</A>
<A HREF="#LEGEND">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   KTOM2

 PURPOSE: 
   Determine the mass of the secondary given the velocity
   semi-amplitude, eccentricity, inclination, Period, and mass of
   the primary.
 
 DESCRIPTION:
   Determines the mass of the secondary by analytically solving the
   cubic equation (only for the real root):

   m2^3 - (m1+m2)^2*(K*sqrt(1d0-e^2)/sin(i))^3*Period/(2d0*!dpi*G) = 0

   Inputs may be vectors or scalars, but must have the same number of
   elements.

   K must not be 0. 

 CALLING SEQUENCE:
   m2 = ktom2(K, e, i, P, m1)

 INPUTS:
   K           - The velocity semi-amplitude (m/s)
   e           - The eccentricity of the orbit
   i           - inclination of orbit (radians). To calculate the
                 minimum mass (msini, assuming M1 >> M2), use
                 i=!dpi/2d0.
   Period      - Period of orbit (days)
   M1          - The mass of the Primary (m_sun)
 OPTIONAL INPUTS:

   GMSun       - The solar gravitational parameter (G*MSun) in SI
                 units (m^3/s^2). If not set, the value from Standish
                 1995 is used (1.3271244d20), which has been adopted
                 by the IAU resolution.

 OUTPUTS:
   M2          - The mass of the secondary (m_sun)

 MODIFICATION HISTORY 
  2011/08 -- Jason Eastman (Ohio State University)
  2017/07 -- Jason Eastman, add optional GMSun input
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/ktom2.pro)</STRONG><P>
<HR>
 
<A NAME="LEGEND">
<H2>LEGEND</H2></A>
<A HREF="#KTOM2">[Previous Routine]</A>
<A HREF="#LINLD">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       LEGEND
 PURPOSE:
       Create an annotation legend for a plot.
 EXPLANATION:
       This procedure makes a legend for a plot.  The legend can contain
       a mixture of symbols, linestyles, Hershey characters (vectorfont),
       and filled polygons (usersym).  A test procedure, legendtest.pro,
       shows legend's capabilities.  Placement of the legend is controlled
       with keywords like /right, /top, and /center or by using a position
       keyword for exact placement (position=[x,y]) or via mouse (/position).
 CALLING SEQUENCE:
       LEGEND [,items][,keyword options]
 EXAMPLES:
       The call:
               legend,['Plus sign','Asterisk','Period'],psym=[1,2,3]
         produces:
               -----------------
               |               |
               |  + Plus sign  |
               |  * Asterisk   |
               |  . Period     |
               |               |
               -----------------
         Each symbol is drawn with a plots command, so they look OK.
         Other examples are given in optional output keywords.

       lines = indgen(6)                       ; for line styles
       items = 'linestyle '+strtrim(lines,2)   ; annotations
       legend,items,linestyle=lines            ; vertical legend---upper left
       items = ['Plus sign','Asterisk','Period']
       sym = [1,2,3]
       legend,items,psym=sym                   ; ditto except using symbols
       legend,items,psym=sym,/horizontal       ; horizontal format
       legend,items,psym=sym,box=0             ; sans border
       legend,items,psym=sym,delimiter='='     ; embed '=' betw psym & text
       legend,items,psym=sym,margin=2          ; 2-character margin
       legend,items,psym=sym,position=[x,y]    ; upper left in data coords
       legend,items,psym=sym,pos=[x,y],/norm   ; upper left in normal coords
       legend,items,psym=sym,pos=[x,y],/device ; upper left in device coords
       legend,items,psym=sym,/position         ; interactive position
       legend,items,psym=sym,/right            ; at upper right
       legend,items,psym=sym,/bottom           ; at lower left
       legend,items,psym=sym,/center           ; approximately near center
       legend,items,psym=sym,number=2          ; plot two symbols, not one
       legend,items,/fill,psym=[8,8,8],colors=[10,20,30]; 3 filled squares
 INPUTS:
       items = text for the items in the legend, a string array.
               For example, items = ['diamond','asterisk','square'].
               You can omit items if you don't want any text labels.
 OPTIONAL INPUT KEYWORDS:

       linestyle = array of linestyle numbers  If linestyle[i] < 0, then omit
               ith symbol or line to allow a multi-line entry.     If 
               linestyle = -99 then text will be left-justified.  
       psym = array of plot symbol numbers.  If psym[i] is negative, then a
               line connects pts for ith item.  If psym[i] = 8, then the
               procedure usersym is called with vertices define in the
               keyword usersym.   If psym[i] = 88, then use the previously
               defined user symbol
       vectorfont = vector-drawn characters for the sym/line column, e.g.,
               ['!9B!3','!9C!3','!9D!3'] produces an open square, a checkmark,
               and a partial derivative, which might have accompanying items
               ['BOX','CHECK','PARTIAL DERIVATIVE'].
               There is no check that !p.font is set properly, e.g., -1 for
               X and 0 for PostScript.  This can produce an error, e.g., use
               !20 with PostScript and !p.font=0, but allows use of Hershey
               *AND* PostScript fonts together.
       N. B.: Choose any of linestyle, psym, and/or vectorfont.  If none is
               present, only the text is output.  If more than one
               is present, all need the same number of elements, and normal
               plot behaviour occurs.
               By default, if psym is positive, you get one point so there is
               no connecting line.  If vectorfont[i] = '',
               then plots is called to make a symbol or a line, but if
               vectorfont[i] is a non-null string, then xyouts is called.
       /help = flag to print header
       /horizontal = flag to make the legend horizontal
       /vertical = flag to make the legend vertical (D=vertical)
       box = flag to include/omit box around the legend (D=include)
		  outline_color = color of box outline (D = !P.color)
       clear = flag to clear the box area before drawing the legend
       delimiter = embedded character(s) between symbol and text (D=none)
       colors = array of colors for plot symbols/lines (D=!P.color)
       font = scalar font graphics keyword (-1,0 or 1) for text
       textcolors = array of colors for text (D=!P.color)
       margin = margin around text measured in characters and lines
       spacing = line spacing (D=bit more than character height)
       pspacing = psym spacing (D=3 characters) (when number of symbols is
             greater than 1)
       charsize = just like !p.charsize for plot labels
       charthick = just like !p.charthick for plot labels
       thick = array of line thickness numbers (D = !P.thick), if used, then 
               linestyle must also be specified
       position = data coordinates of the /top (D) /left (D) of the legend
       normal = use normal coordinates for position, not data
       device = use device coordinates for position, not data
       number = number of plot symbols to plot or length of line (D=1)
       usersym = 2-D array of vertices, cf. usersym in IDL manual. 
             (/USERSYM =square, default is to use existing USERSYM definition)
       /fill = flag to fill the usersym
       /left_legend = flag to place legend snug against left side of plot
                 window (D)
       /right_legend = flag to place legend snug against right side of plot
               window.    If /right,pos=[x,y], then x is position of RHS and
               text runs right-to-left.
       /top_legend = flag to place legend snug against top of plot window (D)
       /bottom = flag to place legend snug against bottom of plot window
               /top,pos=[x,y] and /bottom,pos=[x,y] produce same positions.

       If LINESTYLE, PSYM, VECTORFONT, THICK, COLORS, or TEXTCOLORS are
       supplied as scalars, then the scalar value is set for every line or
       symbol in the legend.
 Outputs:
       legend to current plot device
 OPTIONAL OUTPUT KEYWORDS:
       corners = 4-element array, like !p.position, of the normalized
         coords for the box (even if box=0): [llx,lly,urx,ury].
         Useful for multi-column or multi-line legends, for example,
         to make a 2-column legend, you might do the following:
           c1_items = ['diamond','asterisk','square']
           c1_psym = [4,2,6]
           c2_items = ['solid','dashed','dotted']
           c2_line = [0,2,1]
           legend,c1_items,psym=c1_psym,corners=c1,box=0
           legend,c2_items,line=c2_line,corners=c2,box=0,pos=[c1[2],c1[3]]
           c = [c1[0]<c2[0],c1[1]<c2[1],c1[2]>c2[2],c1[3]>c2[3]]
           plots,[c[0],c[0],c[2],c[2],c[0]],[c[1],c[3],c[3],c[1],c[1]],/norm
         Useful also to place the legend.  Here's an automatic way to place
         the legend in the lower right corner.  The difficulty is that the
         legend's width is unknown until it is plotted.  In this example,
         the legend is plotted twice: the first time in the upper left, the
         second time in the lower right.
           legend,['1','22','333','4444'],linestyle=indgen(4),corners=corners
                       ; BOGUS LEGEND---FIRST TIME TO REPORT CORNERS
           xydims = [corners[2]-corners[0],corners[3]-corners[1]]
                       ; SAVE WIDTH AND HEIGHT
           chdim=[!d.x_ch_size/float(!d.x_size),!d.y_ch_size/float(!d.y_size)]
                       ; DIMENSIONS OF ONE CHARACTER IN NORMALIZED COORDS
           pos = [!x.window[1]-chdim[0]-xydims[0] $
                       ,!y.window[0]+chdim[1]+xydims[1]]
                       ; CALCULATE POSITION FOR LOWER RIGHT
           plot,findgen(10)    ; SIMPLE PLOT; YOU DO WHATEVER YOU WANT HERE.
           legend,['1','22','333','4444'],linestyle=indgen(4),pos=pos
                       ; REDO THE LEGEND IN LOWER RIGHT CORNER
         You can modify the pos calculation to place the legend where you
         want.  For example to place it in the upper right:
           pos = [!x.window[1]-chdim[0]-xydims[0],!y.window[1]-xydims[1]]
 Common blocks:
       none
 Procedure:
       If keyword help is set, call doc_library to print header.
       See notes in the code.  Much of the code deals with placement of the
       legend.  The main problem with placement is not being
       able to sense the length of a string before it is output.  Some crude
       approximations are used for centering.
 Restrictions:
       Here are some things that aren't implemented.
       - An orientation keyword would allow lines at angles in the legend.
       - An array of usersyms would be nice---simple change.
       - An order option to interchange symbols and text might be nice.
       - Somebody might like double boxes, e.g., with box = 2.
       - Another feature might be a continuous bar with ticks and text.
       - There are no guards to avoid writing outside the plot area.
       - There is no provision for multi-line text, e.g., '1st line!c2nd line'
         Sensing !c would be easy, but !c isn't implemented for PostScript.
         A better way might be to simply output the 2nd line as another item
         but without any accompanying symbol or linestyle.  A flag to omit
         the symbol and linestyle is linestyle[i] = -1.
       - There is no ability to make a title line containing any of titles
         for the legend, for the symbols, or for the text.
 Side Effects:
 Modification history:
       write, 24-25 Aug 92, F K Knight (knight@ll.mit.edu)
       allow omission of items or omission of both psym and linestyle, add
         corners keyword to facilitate multi-column legends, improve place-
         ment of symbols and text, add guards for unequal size, 26 Aug 92, FKK
       add linestyle(i)=-1 to suppress a single symbol/line, 27 Aug 92, FKK
       add keyword vectorfont to allow characters in the sym/line column,
         28 Aug 92, FKK
       add /top, /bottom, /left, /right keywords for automatic placement at
         the four corners of the plot window.  The /right keyword forces
         right-to-left printing of menu. 18 Jun 93, FKK
       change default position to data coords and add normal, data, and
         device keywords, 17 Jan 94, FKK
       add /center keyword for positioning, but it is not precise because
         text string lengths cannot be known in advance, 17 Jan 94, FKK
       add interactive positioning with /position keyword, 17 Jan 94, FKK
       allow a legend with just text, no plotting symbols.  This helps in
         simply describing a plot or writing assumptions done, 4 Feb 94, FKK
       added thick, symsize, and clear keyword Feb 96, W. Landsman HSTX
               David Seed, HR Wallingford, d.seed@hrwallingford.co.uk
       allow scalar specification of keywords, Mar 96, W. Landsman HSTX
       added charthick keyword, June 96, W. Landsman HSTX
       Made keyword names  left,right,top,bottom,center longer,
                                 Aug 16, 2000, Kim Tolbert
       Added ability to have regular text lines in addition to plot legend 
       lines in legend.  If linestyle is -99 that item is left-justified.
       Previously, only option for no sym/line was linestyle=-1, but then text
       was lined up after sym/line column.    10 Oct 2000, Kim Tolbert
       Make default value of thick = !P.thick  W. Landsman  Jan. 2001
       Don't overwrite existing USERSYM definition  W. Landsman Mar. 2002
	     Added outline_color BT 24 MAY 2004
       Pass font keyword to xyouts commands.  M. Fitzgerald, Sep. 2005
       Default spacing, pspacing should be relative to charsize. M. Perrin, July 2007
       Don't modify position keyword  A. Kimball/ W. Landsman Jul 2007
       Small update to Jul 2007 for /NORMAL coords.  W. Landsman Aug 2007
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_legend.pro)</STRONG><P>
<HR>
 
<A NAME="LINLD">
<H2>LINLD</H2></A>
<A HREF="#LEGEND">[Previous Routine]</A>
<A HREF="#MASSRADIUS_MIST[1]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   LINLD

 PURPOSE: 
   Interpolates the linear limb darkening tables of Claret and
   Bloemen (2011). http://adsabs.harvard.edu/abs/2011A%26A...529A..75C

 DESCRIPTION:
   Loads an IDL save file found in $EXOFAST_PATH/quadld/, then
   does a 3D linear interpolation of the table. 

 CALLING SEQUENCE:
    coeffs = linld(logg, teff, feh, band [,MODEL=, METHOD=, VT=]);
 INPUTS:
    LOGG - The log of the stellar surface gravity
    TEFF - The stellar effective temperature
    FEH  - The stellar metallicity
    BAND - The observed bandpass. Allowed values are those defined in
           Claret and Bloemen:
             U,B,V,R,I,J,H,K, (Johnson/Cousins)
             u',g',r',i',z', (Sloan)
             Kepler, CoRoT, 
             Spitzer 3.6 um, Spitzer 4.5 um, Spitzer 5.8 um Spitzer 8.0 um, 
             u,b,v,y (Stromgren)

 OPTIONAL INPUTS:
    MODEL  - The atmospheric model used to determine the limb
             darkening values. Choose ATLAS or PHOENIX (default ATLAS).
    METHOD - The method used. Choose L or F (default L)
    VT     - The microturbulent velocity (0,2,4,or 8, default 2)
 
 RESULT:
    The linear limb darkening parameter

 COMMON BLOCKS:
   LINLD_BLOCK - This is a self-contained block that stores the
                 contents of the IDL save files. This common block saves
                 the expensive step of restoring the same save files
                 for repeated calls (e.g., during and MCMC fit).

 MODIFICATION HISTORY
 
  2012/06 -- Public release -- Jason Eastman (LCOGT)
  2013/01 -- Changed save filenames so they're not case sensitive
             (now works with OSX)
             Thanks Stefan Hippler
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/linld.pro)</STRONG><P>
<HR>
 
<A NAME="MASSRADIUS_MIST[1]">
<H2>MASSRADIUS_MIST[1]</H2></A>
<A HREF="#LINLD">[Previous Routine]</A>
<A HREF="#MASSRADIUS_MIST[2]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   massradius_mist

 PURPOSE: 
   Interpolate the MIST stellar evolutionary models to derive Teff
   and Rstar from mass, metallicity, and age. Intended to be a drop in
   replacement for the Yonsie Yale model interpolation
   (massradius_yy3.pro).

 CALLING SEQUENCE:
   chi2 = massradius_mist(mstar, feh, age, teff, rstar, $
                          VVCRIT=vvcrit, ALPHA=alpha, SPAN=span,$
                          MISTRSTAR=mistrstar, MISTTEFF=mistteff)
 INPUTS:

    MSTAR  - The mass of the star, in m_sun
    FEH    - The metallicity of the star [Fe/H]
    AGE    - The age of the star, in Gyr
    RSTAR  - The radius you expect; used to calculate a chi^2
    TEFF   - The Teff you expect; used to calculate a chi^2
    
 OPTIONAL INPUTS:
   VVCRIT    - The rotational velocity normalized by the critical
               rotation speed. Must be 0.0d0 or 0.4d0 (default 0.0d0).
   ALPHA     - The alpha abundance. Must be 0.0 (default 0.0). A
               placeholder for future improvements to MIST models.
   SPAN      - The interpolation is done at the closest value +/-
               SPAN grid points in the evolutionary tracks in mass,
               age, metallicity. The larger this number, the longer it
               takes. Default=1. Change with care.
   EPSNAME   - A string specifying the name of postscript file to plot
               the evolutionary track. If not specified, no plot is
               generated.

 OPTIONAL KEYWORDS:
   DEBUG     - If set, will plot the teff and rstar over the MIST
               Isochrone.

 OPTIONAL OUTPUTS:
   MISTRSTAR - The rstar interpolated from the MIST models.
   MISTTEFF  - The Teff interpolated from the MIST models.

 RESULT:
   The chi^2 penalty due to the departure from the MIST models,
   assuming 3% errors in the MIST model values.

 COMMON BLOCKS:
   MIST_BLOCK:
     Loading EEPs (model tracks) is very slow. This common block
     allows us to store the tracks in memory between calls. The first
     call will take ~3 seconds. Subsequent calls that use the same
     EEP files take 1 ms.

 EXAMPLE: 
   ;; penalize a model for straying from the MIST models 
   chi2 += massradius_mist(mstar, feh, age, rstar=rstar, teff=teff)

 MODIFICATION HISTORY
 
  2018/01 -- Written, JDE
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/massradius_mist.pro)</STRONG><P>
<HR>
 
<A NAME="MASSRADIUS_MIST[2]">
<H2>MASSRADIUS_MIST[2]</H2></A>
<A HREF="#MASSRADIUS_MIST[1]">[Previous Routine]</A>
<A HREF="#MASSRADIUS_MIST[3]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   massradius_mist

 PURPOSE: 
   Interpolate the MIST stellar evolutionary models to derive Teff
   and Rstar from mass, metallicity, and age. Intended to be a drop in
   replacement for the Yonsie Yale model interpolation
   (massradius_yy3.pro).

 CALLING SEQUENCE:
   chi2 = massradius_mist(mstar, feh, age, teff, rstar, $
                          VVCRIT=vvcrit, ALPHA=alpha, SPAN=span,$
                          MISTRSTAR=mistrstar, MISTTEFF=mistteff)
 INPUTS:

    MSTAR  - The mass of the star, in m_sun
    FEH    - The metallicity of the star [Fe/H]
    AGE    - The age of the star, in Gyr
    RSTAR  - The radius you expect; used to calculate a chi^2
    TEFF   - The Teff you expect; used to calculate a chi^2
    
 OPTIONAL INPUTS:
   VVCRIT    - The rotational velocity normalized by the critical
               rotation speed. Must be 0.0d0 or 0.4d0 (default 0.0d0).
   ALPHA     - The alpha abundance. Must be 0.0 (default 0.0). A
               placeholder for future improvements to MIST models.
   SPAN      - The interpolation is done at the closest value +/-
               SPAN grid points in the evolutionary tracks in mass,
               age, metallicity. The larger this number, the longer it
               takes. Default=1. Change with care.
   EPSNAME   - A string specifying the name of postscript file to plot
               the evolutionary track. If not specified, no plot is
               generated.

 OPTIONAL KEYWORDS:
   DEBUG     - If set, will plot the teff and rstar over the MIST
               Isochrone.

 OPTIONAL OUTPUTS:
   MISTRSTAR - The rstar interpolated from the MIST models.
   MISTTEFF  - The Teff interpolated from the MIST models.

 RESULT:
   The chi^2 penalty due to the departure from the MIST models,
   assuming 3% errors in the MIST model values.

 COMMON BLOCKS:
   MIST_BLOCK:
     Loading EEPs (model tracks) is very slow. This common block
     allows us to store the tracks in memory between calls. The first
     call will take ~3 seconds. Subsequent calls that use the same
     EEP files take 1 ms.

 EXAMPLE: 
   ;; penalize a model for straying from the MIST models 
   chi2 += massradius_mist(mstar, feh, age, rstar=rstar, teff=teff)

 MODIFICATION HISTORY
 
  2018/01 -- Written, JDE
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/massradius_parsec.pro)</STRONG><P>
<HR>
 
<A NAME="MASSRADIUS_MIST[3]">
<H2>MASSRADIUS_MIST[3]</H2></A>
<A HREF="#MASSRADIUS_MIST[2]">[Previous Routine]</A>
<A HREF="#MASSRADIUS_TORRES">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   massradius_mist

 PURPOSE: 
   Interpolate the MIST stellar evolutionary models to derive Teff
   and Rstar from mass, metallicity, and age. Intended to be a drop in
   replacement for the Yonsie Yale model interpolation
   (massradius_yy3.pro).

 CALLING SEQUENCE:
   chi2 = massradius_mist(mstar, feh, age, teff, rstar, $
                          VVCRIT=vvcrit, ALPHA=alpha, SPAN=span,$
                          MISTRSTAR=mistrstar, MISTTEFF=mistteff)
 INPUTS:

    MSTAR  - The mass of the star, in m_sun
    FEH    - The metallicity of the star [Fe/H]
    AGE    - The age of the star, in Gyr
    RSTAR  - The radius you expect; used to calculate a chi^2
    TEFF   - The Teff you expect; used to calculate a chi^2
    
 OPTIONAL INPUTS:
   VVCRIT    - The rotational velocity normalized by the critical
               rotation speed. Must be 0.0d0 or 0.4d0 (default 0.0d0).
   ALPHA     - The alpha abundance. Must be 0.0 (default 0.0). A
               placeholder for future improvements to MIST models.
   SPAN      - The interpolation is done at the closest value +/-
               SPAN grid points in the evolutionary tracks in mass,
               age, metallicity. The larger this number, the longer it
               takes. Default=1. Change with care.
   EPSNAME   - A string specifying the name of postscript file to plot
               the evolutionary track. If not specified, no plot is
               generated.

 OPTIONAL KEYWORDS:
   DEBUG     - If set, will plot the teff and rstar over the MIST
               Isochrone.

 OPTIONAL OUTPUTS:
   MISTRSTAR - The rstar interpolated from the MIST models.
   MISTTEFF  - The Teff interpolated from the MIST models.

 RESULT:
   The chi^2 penalty due to the departure from the MIST models,
   assuming 3% errors in the MIST model values.

 COMMON BLOCKS:
   MIST_BLOCK:
     Loading EEPs (model tracks) is very slow. This common block
     allows us to store the tracks in memory between calls. The first
     call will take ~3 seconds. Subsequent calls that use the same
     EEP files take 1 ms.

 EXAMPLE: 
   ;; penalize a model for straying from the MIST models 
   chi2 += massradius_mist(mstar, feh, age, rstar=rstar, teff=teff)

 MODIFICATION HISTORY
 
  2018/01 -- Written, JDE
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/massradius_parsec_rosen.pro)</STRONG><P>
<HR>
 
<A NAME="MASSRADIUS_TORRES">
<H2>MASSRADIUS_TORRES</H2></A>
<A HREF="#MASSRADIUS_MIST[3]">[Previous Routine]</A>
<A HREF="#MKCONSTANTS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   MASSRADIUS_TORRES

 PURPOSE: 
   Uses the Torres relation
   (http://adsabs.harvard.edu/abs/2010A%26ARv..18...67T) to determine
   the stellar mass and radius given the logg, Teff, and [Fe/H].

   NOTE the errors in the empirical model of ulogm = 0.027d0, ulogr = 0.014d0

 CALLING SEQUENCE:
    massradius_torres, logg, teff, feh, mstar, rstar

 INPUTS:
    LOGG - The log of the stellar surface gravity
    TEFF - The stellar effective temperature
    FEH  - The stellar metallicity

 OUTPUTS:
    MSTAR - The stellar mass, in solar masses
    RSTAR - The stellar radius, in solar radii

 MODIFICATION HISTORY
 
  2012/06 -- Public release -- Jason Eastman (LCOGT)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/massradius_torres.pro)</STRONG><P>
<HR>
 
<A NAME="MKCONSTANTS">
<H2>MKCONSTANTS</H2></A>
<A HREF="#MASSRADIUS_TORRES">[Previous Routine]</A>
<A HREF="#MKPRIOR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   mkconstants
 PURPOSE:
   Returns a structure containing all the physical constants used
   throughout EXOFASTv2, in cgs units and double precision.

 DESCRIPTION:
   Unit constants (converted to cgs)
   As defined by IAU resolutions B2, B3
   https://www.iau.org/static/resolutions/IAU2012_English.pdf
   https://arxiv.org/abs/1510.07674, 
   https://arxiv.org/abs/1507.07956, Table 1
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mkconstants.pro)</STRONG><P>
<HR>
 
<A NAME="MKPRIOR">
<H2>MKPRIOR</H2></A>
<A HREF="#MKCONSTANTS">[Previous Routine]</A>
<A HREF="#MKSED">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   mkprior
 PURPOSE:

   Prints the contents of an EXOFASTv2 prior file so the next fit
   starts at the most likely model from a previous EXOFASTv2
   run. Often times such iteration can be helpful to make the fit
   converge faster, since it is often difficult to find a good best
   fit of complex fits with strong covariances and many parameters.

   Note: If priors widths or bounds were supplied in the original
   fit, these will be preserved and override the best-fit values.

 INPUTS:

   FILENAME - The name of an IDL save file containing an MCMCSS
              structure output by EXOFASTv2. Takes precendence over
              MCMCSS.

              Hint: a poorly behaving run can be terminated and still
              generate this file by typing "ctrl+c", then
              "!stopnow=1" and ".con" in the window.

   MCMCSS   - The stellar stucture output by EXOFASTv2.

   PRIORFILENAME - If specified, create a new priorfile with this
                   name. Otherwise, output to the screen.

 REVISION HISTORY:
   2018/03 - Public Release - Jason Eastman (CfA)

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mkprior.pro)</STRONG><P>
<HR>
 
<A NAME="MKSED">
<H2>MKSED</H2></A>
<A HREF="#MKPRIOR">[Previous Routine]</A>
<A HREF="#OMC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
    MKSED
 PURPOSE:
    Given an object name (resolved with simbad) or RA and DEC, return
    available broad band photometry from a variety of catalogs in the
    format expected by EXOFASTv2 to perform an SED fit.
    $EXOFAST_PATH/sed/mag2fluxconv.pro reads this file.

    NOTE: Priors on extinction and parallax should be included (see
    mkpriors.pro), as well as a prior on Teff.

 INPUTS:
 
    References included in the output file -- please cite the appropriate catalogs.
 Modification 
    20??-??-??: Written: Keivan Stassun, Vanderbilt
    2018-04-12: Jason Eastman, CfA
                Renamed, documented, and cleaned up for distribution
                with EXOFASTv2
    2019-01-18: Now can be run without a license (use mksed.sav)

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mksed.pro)</STRONG><P>
<HR>
 
<A NAME="OMC">
<H2>OMC</H2></A>
<A HREF="#MKSED">[Previous Routine]</A>
<A HREF="#PARS2STR">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   OMC

 PURPOSE: 
   Calculates the best ephemeris from a list of transit times and
   plots the O-C diagram
 
 CALLING SEQUENCE:
    OMC, 'filename' [,period, t0=t0,/ps,epsname=epsname]

 INPUTS:

    FILENAME - The filename of a text file with columns T_C, error,
               and optionally telescope name. If telescope name is
               given, each unique telescope name will be plotted
               with a different color. The error must be in days.
               NOTE: "#" may be used as a comment string.

 OPTIONAL INPUTS:
    
    PERIOD   - The period of the transit. If not given, the program
               will attempt to calculate it from the lowest common
               multiple of transits.
               NOTE: This may result in integer aliases depending on
               when the transits were taken.
    T0       - The zero point of the ephemeris. If not specified, the
               transit time closest to the error-weighted mean of all
               input times will be used, which minimizes the error in
               the ephemeris.
    EPSNAME  - The name of the encapsulated postscript file; default
               is omc.eps.

 OPTIONAL KEYWORDS:
    
    PS       - If set, an encapsulated postscript plot will be
               created. Otherwise, it will plot to the screen. It is
               not necessary to specify both PS and EPSNAME.

 OUTPUTS:

   1) Plots the O-C diagram
   2) Prints the best fit ephemeris with errors
   3) Prints the chi^2/dof of the best fit
   4) Prints the epoch, transit time, error (sec), residual (sec),
      and residual/err for each transit

 MODIFICATION HISTORY

  2011/07 -- Written, Jason Eastman (OSU)

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/omc.pro)</STRONG><P>
<HR>
 
<A NAME="PARS2STR">
<H2>PARS2STR</H2></A>
<A HREF="#OMC">[Previous Routine]</A>
<A HREF="#PLOTIMAGE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   PARS2STR

 PURPOSE: 
   Translates a parameter array (for use with EXOFAST_DEMC) into the
   stellar system structure (for use with EXOFASTv2)

 CALLING SEQUENCE:
    pars2str(pars,str)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/pars2str.pro)</STRONG><P>
<HR>
 
<A NAME="PLOTIMAGE">
<H2>PLOTIMAGE</H2></A>
<A HREF="#PARS2STR">[Previous Routine]</A>
<A HREF="#QUADLD">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   PLOTIMAGE

 AUTHOR:
   Craig B. Markwardt, NASA/GSFC Code 662, Greenbelt, MD 20770
   craigm@lheamail.gsfc.nasa.gov

 PURPOSE:
   Displays an image via a "PLOT"-like interface.

 CALLING SEQUENCE:
   PLOTIMAGE, img, [xrange=xrange,] [yrange=yrange,] ...

 DESCRIPTION:

   PLOTIMAGE displays an image (or slice of an image) on the current
   graphics device.  The syntax is very similar to the PLOT command,
   in the sense that an XRANGE and YRANGE for the plot can be
   specified.  

   PLOTIMAGE keeps separate the notions of the image coordinate
   system and the displayed coordinate system, which allows any input
   image to be "cropped," "zoomed," or "flipped."

   PLOTIMAGE allows the user to express image extents in physical
   units rather than pixel units.

   The image coordinate system specifies the physical coordinates of
   original image data, IMG.  The image is considered to be a 2D
   array (IMG = ARRAY(NX,NY)), where the values are attached to the
   midpoint of each geometric pixel.  The image has NX columns and NY
   rows.  Physical coordinates are attached to each pixel by using
   the IMGXRANGE and IMGYRANGE keywords.  The IMGXRANGE keyword is a
   two-element array specifying the "left" and "right" boundaries of
   the image pixels in physical units; the IMGYRANGE keyword
   specifies the "top" and "bottom" boundaries of the image.  This is
   illustrated in Figure 1 for a simplified case.

                                   ___
         +-----------+-----------+  ^  IMGYRANGE[1]
         |           |           |  |
         | IMG[0,1]  | IMG[1,1]  |  |
         |     +     |     +     |  |
         |           |           |  |
         |           |           |  |
         +-----------+-----------+  |
         |           |           |  |
         | IMG[0,0]  | IMG[1,0]  |  |
         |     +     |     +     |  |
         |           |           |  |
         |           |           |  v
         +-----------+-----------+ ___ IMGYRANGE[0]
        |                         |
        |<----------------------->|
        IMGXRANGE[0]   IMGXRANGE[1]

      Figure 1.  Simplified example of a 2x2 input image,
      demonstrating that IMG[*,*] values refer to the pixel
      mid-points, and that IMGXRANGE and IMGYRANGE ranges specify the
      physical coordinates of the outer edges of the image extent in
      X and Y, respectively.
 

   The displayed plot coordinate system is entirely independent of
   the native image coordinates.  Users can set up the plot scale
   using any combination of {X,Y}RANGE, {X,Y}STYLE and/or {X,Y}LOG,
   as they would for any IDL plot, using physical units.  The input
   image will then be overlayed on this coordinate system.

   If the displayed plot coordinates are narrower than the native
   image coordinates, then the displayed portion of the image will be
   cropped to fit.  If the displayed coordinates are wider than the
   native image coordinates, then the image will be displayed with
   blank spaces on either side (see Figure 2).  A mirror "flip" is
   also possible in X and/or Y, if XRANGE or YRANGE are specified in
   reverse order.
                                                 ___
      +---------------------------------------+   ^
      |            ___                        |   |
      |             ^  +---------------+      |   |
      |             |  |               |      |   |
      |             |  |               |      |   |
      |    IMGYRANGE|  |     IMG       |      |   | YRANGE
      |             |  |               |      |   |
      |             v  |               |      |   |
      |            ___ +---------------+      |   |
      |               |<-- IMGXRANGE -->|     |   |
      |                                       |   v
      +---------------------------------------+  ___
     |<-------------   XRANGE   -------------->|

     Figure 2.  Example of an image whose native image coordinates
     are embedded in a wider plot display range.

   The standard [XY]STYLE keywords can be used to style either axis.
   However at the very least [XY]STYLE=1 is always implied, i.e. the
   plot limits exactly obey the [XY]RANGE keyword values.

   If XLOG or YLOG are set, then the image is assumed to be sampled
   on a logarithmic grid, and logarithmic axes are displayed
   accordingly.  PLOTIMAGE does not attempt to resample the image
   from linear scale to logarithmic scale, or reverse.

   Psuedocolor images may be of any type, but must rescaled to a byte
   range by using the RANGE keyword.  By default the color range used
   in the rescaling operation is 0 to !D.N_COLORS - 3B.  The extra
   two color values are reserved for the background and default pen
   colors.  This behavior can be adjusted by specifying the BOTTOM
   and/or NCOLORS keywords.

   Truecolor images must always be of type BYTE and one of their
   dimensions must have 3 elements, corresponding to the three color
   planes of the image.


 INPUTS:

   IMG - Array to be displayed.  For single-plane images (i.e.,
         pseudocolor), the image must be two dimensional and of any
         real numeric type.  For images that are not of BYTE type,
         the RANGE keyword must be supplied, and then PLOTIMAGE will
         rescale the image values to a byte range.

         An image declared as ARRAY(NX,NY) will be NX pixels in the
         x-direction and NY pixels in the y-direction.  The image is
         resampled to fill the desired display region (and optionally
         smoothed).

         For three-plane images (i.e., truecolor) the image must be
         of type BYTE.  One of the dimensions of the array must have
         three elements.  Hence it must be one of BYTARR(NX, NY, 3),
         BYTARR(NX, 3, NY) or BYTARR(3, NX, NY).  The 3-element
         dimension is recognized automatically.

 OPTIONAL INPUTS:
   NONE

 INPUT KEYWORD PARAMETERS:

   IMGXRANGE, IMGYRANGE - Each is a two component vector that
                          describes the X and Y position of the outer
                          edges of the first and last pixels.
                          Default: IMGXRANGE = [0,NX]
                                   IMGYRANGE = [0,NY]

   XRANGE, YRANGE - Each is a two component vector that specifies the
                    X and Y plot ranges, respectively.  These values
                    are not required to coincide with IMG[XY]RANGE.
                    Default: XRANGE=IMGXRANGE
                             YRANGE=IMGYRANGE

   POSITION - Position of the inner plot window in the standard
              graphics keyword format.  Overrides PANEL and SUBPANEL.

   INTERP - if set, interpolate (smooth) the image before displaying.
            This keyword applies to the screen displays.  For printed
            images that are coarser than MIN_DPI, the image is
            implicitly interpolated regardless of INTERP.

   PRESERVE_ASPECT - if set, preserve the aspect ratio of the
                     original image (in pixels).  The result will be
                     the largest image that fits in the display
                     region while maintaining approximately square
                     pixels.  However, PIXEL_ASPECT_RATIO overrides
                     PRESERVE_ASPECT.  The POSITION keyword will be
                     reset upon output to the ultimate image
                     position.
                     DEFAULT: not set (image will fill POSITION rectangle)

   PIXEL_ASPECT_RATIO - The ratio of width to height for each pixel.
                        If specified, then the image will be scaled
                        so that each pixel has the specified aspect
                        ratio.  If not specified, then the image will
                        be scaled independently in X and Y in order
                        to fill the POSITION rectangle.  NOTE: If you
                        want to change the overall image aspect
                        ratio, then use the POSITION keyword.
                  DEFAULT: undefined (image will fill POSITION rectangle)

   MIN_DPI - if printing, the minimum dot-per-inch pixel resolution
             for the resulting image.  Output images that would be
             coarser than this value are resampled to have a
             resolution of at least MIN_DPI, and smoothed.  Some
             common resolutions are: screen, 90 dpi; dot matrix, 72
             dpi; laser printer 300-600 dpi.  Note that large values
             of MIN_DPI will produce very large output files.
             Default: 0 (i.e., the output image will not be smoothed)

   RANGE - a two element vector.  If the image is single plane (i.e.,
           pseudocolor) the input image can be of any real numeric
           type, and then must be rescaled into byte range with this
           keyword.  In contrast, truecolor images must always be of
           type BYTE.  Values are scaled into byte range with the
           following statement:
              RESULT = BYTSCL(INPUT, MIN=RANGE(0), MAX=RANGE(1), $
                              TOP=NCOLORS-1) + BOTTOM
           so that pixels with an intensity RANGE(0) are set to
           BOTTOM; those with RANGE(1) are set to the maximum color.
           Default: no range scaling occurs (and the image must hence
                    be of type BYTE -- otherwise an error occurs)

   NCOLORS - number of color table values be used in the byte
             rescaling operation.
             Default: !D.N_COLORS - BOTTOM - 1 (for default pen color)

   BOTTOM - bottom-most value of the color table to be used in the
            byte rescaling operation.
            Default: 1 (for default background color)

   NOERASE - If set, the display is not erased before graphics
             operations.

   NODATA - If set, the image is not actually displayed, but
            coordinate axes may be drawn.

   NOAXES - An attempt is made to render the image without coordinate
            axes.  However, it's usually more straightforward to set 
            XSTYLE=4 or YSTYLE=4, which is the standard IDL way to
            disable coordinate axes.

   ORDER - same interpretation as the !ORDER system variable; 
           if ORDER=0, then the first pixel is drawn in the lower
           left corner; if ORDER=1, then the first pixel is drawn in
           the upper left corner.
           Default: 0


   PANEL, SUBPANEL - An alternate way to more precisely specify the
                     plot and annotation positions.  See SUBCELL.

   PLOTIMAGE will pass other keywords directly to the PLOT command
   used for generating the plot axes.  XSTYLE=1 and YSTYLE=1 are
   enforced.

 OUTPUTS:
   NONE

 PROCEDURE:

 EXAMPLE:

   This example constructs an image whose values are found by
       z(x,y) = cos(x) * sin(y)
   and x and y are in the range [-2,2] and [4,8], respectively.
   The image is then plotted, with appropriate axes.

   x = findgen(20)/5. - 2. + .1   ; 0.1 = half-pixel
   y = findgen(20)/5. + 4. + .1
   zz = cos(x) # sin(y)
   imgxrange = [-2.,2.]           ; extend to pixel edges
   imgyrange = [4.,8.]
   plotimage, bytscl(zz), imgxrange=imgxrange, imgyrange=imgyrange

   This second example plots the same image, but with a plot range
   much larger than the image's.

   xr=[-10.,10]
   yr=[-10.,10]
   plotimage, bytscl(zz), imgxrange=imgxrange, imgyrange=imgyrange, $
      xrange=xr, yrange=yr

 SEE ALSO:

   OPLOTIMAGE, BYTSCL

 EXTERNAL SUBROUTINES:

   SUBCELL, DEFSUBCELL

 MODIFICATION HISTORY:
   Written, CM, 1997
   Correct various one-off problems, 02 Feb 1999, CM
   Made self-contained with some pre-processing, 17 Oct 1999, CM
   Corrected bug in newly introduced CONGRID functions, 18 Oct 1999, CM
   Correct behavior with no POSITION keyword, 17 Nov 1999, CM
   Simplified axis plotting, 17 Nov 1999, CM
   Use _EXTRA keyword in first PLOT, but with blank TITLEs, 11 Jan
     2000, CM
   Correct implementation of X/YSTYLE in first PLOT, 11 Feb 2000, CM
   Correct CONGRID implementation (small effect when enlarging most
     images), 14 Feb 2000, CM
   Major changes: 19 Apr 2000
      - now handle decomposed color, automatic color mapping via
        RANGE, and 24-bit multiplane images
      - new PRESERVE_ASPECT keyword to keep square pixels
      - removed legacy TVIMAGE code
      - smoothing is more configurable, esp. for printers, but is not
        done by default; more printers are supported
   Corrected INTERPOLATE behavior (thanks to Liam Gumley
     <Liam.Gumley@ssec.wisc.edu>), other minor tweaks, CM 20 Apr 2000
   Added ability to use PRESERVE_ASPECT with POSITION, PANEL or
     SUBPANEL keywords CM 20 Oct 2000
   Oops, a typo is now fixed, CM 23 Oct 2000
   Add fix for MacIntoshes and DECOMPOSED color, Tupper, 02 Aug 2001
   Better behavior with fractional pixels (ie, when the image pixels
     are very large compared to the screen), 23 Aug 2001
   Add support for Z buffer, CM, 20 Oct 2002
   Memory conservation: use REVERSE() to reverse IMG; rewrote
     PLOTIMAGE_RESAMP to rescale entire image instead of each color plane
     separately.  Jeff Guerber, 30 July 2003
   Add PIXEL_ASPECT_RATIO keyword, 22-25 Nov 2005
   Check for the case of an 1xNXxNY 3D image and treat it as a 2D
     image.  The "1" dimension can be anywhere, CM, 03 Sep 2006
   Add the ORDER keyword parameter, CM, 20 Mar 2007
   Enable XLOG and YLOG keywords, for logarithmic axes;
     doesn't actually resample the image from linear<->log, CM
     21 Jan 2009
   Documentation, CM, 21 Jan 2009
   Allow reverse color scale, CM, 13 Nov 2010

   $Id: plotimage.pro,v 1.15 2010/11/13 09:53:39 cmarkwar Exp $

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/multifast_dt_plotimage.pro)</STRONG><P>
<HR>
 
<A NAME="QUADLD">
<H2>QUADLD</H2></A>
<A HREF="#PLOTIMAGE">[Previous Routine]</A>
<A HREF="#READIPAC">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   QUADLD

 PURPOSE: 
   Interpolates the quadratic limb darkening tables of Claret and
   Bloemen (2011). http://adsabs.harvard.edu/abs/2011A%26A...529A..75C

 DESCRIPTION:
   Loads an IDL save file found in $EXOFAST_PATH/quadld/, then
   does a 3D linear interpolation of the table. 

 CALLING SEQUENCE:
    coeffs = quadld(logg, teff, feh, band [,MODEL=, METHOD=, VT=]);
 INPUTS:
    LOGG - The log of the stellar surface gravity
    TEFF - The stellar effective temperature
    FEH  - The stellar metallicity
    BAND - The observed bandpass. Allowed values are those defined in
           Claret and Bloemen:
             U,B,V,R,I,J,H,K, (Johnson/Cousins)
             u',g',r',i',z', (Sloan)
             Kepler, CoRoT, 
             Spitzer 3.6 um, Spitzer 4.5 um, Spitzer 5.8 um Spitzer 8.0 um, 
             u,b,v,y (Stromgren)

 OPTIONAL INPUTS:
    MODEL  - The atmospheric model used to determine the limb
             darkening values. Choose ATLAS or PHOENIX (default ATLAS).
    METHOD - The method used. Choose L or F (default L)
    VT     - The microturbulent velocity (0,2,4,or 8, default 2)
   
 RESULT:
    The quadradic limb darkening parameters

 COMMON BLOCKS:
   LD_BLOCK - This is a self-contained block that stores the
              contents of the IDL save files. This common block saves
              the expensive step of restoring the same save files
              for repeated calls (e.g., during and MCMC fit).

 MODIFICATION HISTORY
 
  2012/06 -- Public release -- Jason Eastman (LCOGT)
  2013/01 -- Changed save filenames so they're not case sensitive
             (now works with OSX) -- thanks Stefan Hippler.
  2019/08 -- Now rejects steps outside of bounds
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/quadld.pro)</STRONG><P>
<HR>
 
<A NAME="READIPAC">
<H2>READIPAC</H2></A>
<A HREF="#QUADLD">[Previous Routine]</A>
<A HREF="#SETDEFAULTVALUE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   READIPAC

 PURPOSE:
   Reads the http://exoplanets.org/csv-files/exoplanets.csv database into an
   IDL structure for easy plotting and manipulation.

   See http://exoplanets.org/help/common/data for the definitions
   of each tag.

 OPTIONAL KEYWORDS:
   UPDATE - By default, if exoplanets.csv exists, it will not
            retrieve a new copy. Set this keyword to wget the csv
            file and overwrite exoplanets.csv. It will only overwrite
            it if the copy on the server is newer. This program is
            about 25% slower when this keyword is specified
            unnecessarily and 2x slower when it actually needs to
            update.

 CALLING SEQUENCE:
   result = readexo([/update])

 EXAMPLE - Print all data for HAT-P-13 b:

   planetdata = readexo(/update)
   match = where(planetdata.name eq 'HAT-P-13 b')
   names = tag_names(planetdata)
   if match[0] ne -1 then for i=0, n_tags(planetdata)-1 do $
     print, names[i], planetdata.(i)[match], format='(a15,a100)'

 DEPENDENCIES:
   wget

 ENVIRONMENT VARIABLES:
   EXOFAST_PATH  - The environment variable specifying the directory
                   in which to save/look for the CSV file. If not set,
                   the program will use the current working directory.

 NOTES: 
   All data types are strings for robustness and generality (no
   update to this program is required if new rows or columns are
   added to the database). Converting to numeric values is trivial,
   but be sure to use the appropriate precision (eg, to convert ra
   from hours to degrees, do radeg = planetdata.ra*15.d0, not radeg =
   planetdata.ra*15).

   Be aware that the order of tags or even the tagnames may change if
   the database changes.

 REVISION HISTORY
   Created: 2011/01/19 Jason Eastman, OSU
            2012/06/15 Updated for change to exoplanets.org.
            2013/01/14 Updated for change to URL.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/readipac.pro)</STRONG><P>
<HR>
 
<A NAME="SETDEFAULTVALUE">
<H2>SETDEFAULTVALUE</H2></A>
<A HREF="#READIPAC">[Previous Routine]</A>
<A HREF="#SPLITPDF">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 This procedure sets default values for positional and keyword arguments to
 IDL procedures and functions.

 :Categories:
    Utilities

 :Params:
    argument: in, required
         The augument variable you are setting the default value of. If this variable
         is undefined, the `defaultValue` will be assigned to it. Otherwise, the argument
         variable will not change.
    defaultvalue: in, required
         The default value that will be assigned to the argument variable ONLY if the argument
         variable is undefined. If this variable is undefined, the argument variable will
         be treated as if the BOOLEAN keyword had been set.

 :Keywords:
    boolean: in, optional, type=integer
         If this keyword is set, the argument value will always be forced to return with a 
         value of 0 or 1.
    range: in, optional
         A two-element array that gives the accepted range of the variable. The output argument
         will be forced into this data range: range[0] > argument < range[1].

 :Examples:
    Here is how to use this program::
    
      FUNCTION Action, arg1, arg2, MULTIPLY=multiply
  
         SetDefaultValue, arg1, 1
         SetDefaultValue, arg2, 2
         SetDefaultValue, multiply, 1, /BOOLEAN 
     
         IF multiply THEN RETURN, arg1 * arg2 ELSE RETURN, arg1 + arg2
     
      END

 :Author:
    FANNING SOFTWARE CONSULTING::
       David W. Fanning
       1645 Sheely Drive
       Fort Collins, CO 80526 USA
       Phone: 970-221-0438
       E-mail: david@idlcoyote.com
       Coyote's Guide to IDL Programming: http://www.idlcoyote.com

 :History:
     Change History::
        Written by: David W. Fanning, November 26, 2008, from suggestion by Carsten Lechte on
           IDL newsgroup on this date.
        Made a change to the way the BOOLEAN keyword works. Now argument is set to BOOLEAN before
           return, if required. 3 Dec 2008. DWF.
        Added RANGE keyword. 22 March 2014. DWF.

 :Copyright:
     Copyright (c) 2008-2014, Fanning Software Consulting, Inc.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/setdefaultvalue.pro)</STRONG><P>
<HR>
 
<A NAME="SPLITPDF">
<H2>SPLITPDF</H2></A>
<A HREF="#SETDEFAULTVALUE">[Previous Routine]</A>
<A HREF="#STROM_CONV[1]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   SPLITPDF

 PURPOSE: 
   Splits an EXOFASTv2 output IDL file and reports two
   solutions. Intended to summarize bimodal distributions.

 CALLING SEQUENCE:
   splitpdf, idlfile, 1.0

 INPUTS:
   IDLFILE - The name of the EXOFAST output IDL file
   MASSCUT - The value to cut on, in solar masses

 MODIFICATION HISTORY
 
  2019/10/11 -- added
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/splitpdf.pro)</STRONG><P>
<HR>
 
<A NAME="STROM_CONV[1]">
<H2>STROM_CONV[1]</H2></A>
<A HREF="#SPLITPDF">[Previous Routine]</A>
<A HREF="#STROM_CONV[2]">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   STROM_CONV
 PURPOSE:
    Translates stromgren color combinations from the catalog to
    individual uvby magnitudes
 Modification 
    2018-04-12: Jason Eastman, CfA
                Renamed, documented, and cleaned up for distribution with EXOFASTv2

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mksed.pro)</STRONG><P>
<HR>
 
<A NAME="STROM_CONV[2]">
<H2>STROM_CONV[2]</H2></A>
<A HREF="#STROM_CONV[1]">[Previous Routine]</A>
<A HREF="#TEXTOIDL_MATCHDELIM">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   STROM_CONV
 PURPOSE:
    Translates stromgren color combinations from the catalog to
    individual uvby magnitudes
 Modification 
    2018-04-12: Jason Eastman, CfA
                Renamed, documented, and cleaned up for distribution with EXOFASTv2

</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/mkticsed.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_MATCHDELIM">
<H2>TEXTOIDL_MATCHDELIM</H2></A>
<A HREF="#STROM_CONV[2]">[Previous Routine]</A>
<A HREF="#TEXTOIDL_NEXTTOK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_MATCHDELIM
 PURPOSE:
        Match open/close delimiters in a string.
 CATEGORY:
        text/strings
 CALLING SEQUENCE:
        position = textoidl_matchdelim( strn, [openpos])
 INPUTS:
        strn        -- a string containing an open                 in
                       delimiter (e.g. '{') in which you 
                       want to find the matching closing  
                       delimiter (e.g. '}')
 KEYWORD PARAMETERS:
        OPEN_DELIM  -- A single character containing the opening   in
                       delimiter (e.g. '(').  Default is '{'
        CLOSE_DELIM -- A single character containing the closing   in
                       delimiter (e.g. ')').  Default is '}'
 OUTPUTS:
        position -- returns the position in strn of the            out
                    closing delimiter, -1 if no closing found.
        openpos  -- Set to a named variable to receive the         out
                    position of the first opening delimiter.
                    Optional.
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
        - Any pair of (nonidentical) characters can be used as
          delimiters. 
 EXAMPLE:
        textoidl_matchdelim('{one{two}}three') returns 9, the character just
        before 'three'.  
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.3  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.2  1996/05/09 00:22:17  mcraig
       Removed restriction that open delim must be first char.  Added argument
       to allow for return of position of open delim.

       Revision 1.1  1996/01/31 18:41:06  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_NEXTTOK">
<H2>TEXTOIDL_NEXTTOK</H2></A>
<A HREF="#TEXTOIDL_MATCHDELIM">[Previous Routine]</A>
<A HREF="#TEXTOIDL_STRCNT">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_NEXTTOK
 PURPOSE:
       Find the next occurance of any of a set of characters in a
       string and return the character which occurs next.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       tok = textoidl_nexttok( strn, tokens )
 INPUTS:
       strn   -- string to be searched for sub/superscripts    in
       tokens -- string containing characters to be found.     in
 KEYWORD PARAMETERS:
       POSITION -- Set to a named variable to get position     out
                   of next token, or -1 if none found.
       /HELP    -- Print useful message and exit.
 OUTPUTS:
       tok    -- Contains the character among tokens which     out
                 occurs next in strn, or null '' if none found.
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
 EXAMPLE:
       textoidl_nexttok( 'x^2 + N_j^3', '^_', position=pos ) returns '^' and sets
       pos to 1.
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.3  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.2  1996/05/09 00:22:17  mcraig
       Generalized so that the next occurence of any of a set of characters will
       be returned.

       Revision 1.1  1996/01/31 18:41:06  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_STRCNT">
<H2>TEXTOIDL_STRCNT</H2></A>
<A HREF="#TEXTOIDL_NEXTTOK">[Previous Routine]</A>
<A HREF="#TEXTOIDL_STRTOK">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_STRCNT
 PURPOSE:
       Count number of occurrences of a substring in a string.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       num = textoidl_strcnt(strn, substring, [pos])
 INPUTS:
       string    -- The string in which to count occurences.     in
       substring -- The substring to count occurrences of.       in
       pos       -- the position at which to begin the search.   [in]
                    If not supplied, start at beginning of
                    string.
 KEYWORD PARAMETERS:
       /HELP     -- Print useful message and return.
 OUTPUTS:
       num       -- Number of occurances of substring in string. out
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
       Overlapping occurances are not counted separately.  For
       example, counting occurances of 'bb' in 'blah bbb' returns one
       occurance. 
 EXAMPLE:
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.3  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.2  1996/05/09 00:22:17  mcraig
       Added fast processing using BYTE arrays if we are counting occurences of
       a single character.  Added error handling.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_STRTOK">
<H2>TEXTOIDL_STRTOK</H2></A>
<A HREF="#TEXTOIDL_STRCNT">[Previous Routine]</A>
<A HREF="#TEXTOIDL_STRTRANS">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_STRTOK
 PURPOSE:
       Retrieve portion of string up to token.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       new = textoidl_strtok( old, token )
 INPUTS:
       old   -- String to be split.  Contains text after    in, out
                token on output.
       token -- Token to use in splitting old.              in
 KEYWORD PARAMETERS:
       /TRIM -- set to remove leading blanks from old 
                before returning.
       /HELP -- print useful message and exit.
 OUTPUTS:
       new   -- portion of string up to token.              out
       old   -- portion of old after token.                 out, in
 COMMON BLOCKS:
 SIDE EFFECTS:
       Input parameter old is modified.
 NOTES:
       Token may be one or more characters.
       If token is not found, returns old and sets old to ''.
 EXAMPLE:
       If old is 'foo44 bar', then textoidl_strtok( old, '44' ) would return
       'foo', and upon return, old will be left with ' bar'.  If /TRIM
       were set, old would be 'bar' on return.

       If old='xyz', then new=textoidl_strtok(old,'a') would return with
       new='xyz' and old=''.
 THANKS:
       To D. Linder who wrote GETTOK, part of the goddard library,
       upon which this is based.
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.3  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.2  1996/05/09 00:22:17  mcraig
       Added built in help.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_STRTRANS">
<H2>TEXTOIDL_STRTRANS</H2></A>
<A HREF="#TEXTOIDL_STRTOK">[Previous Routine]</A>
<A HREF="#TEXTOIDL_SUB_SUP">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_STRTRANS
 PURPOSE:
       Translate all occurences of one substring to another.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       new = textoidl_strtrans(oldstr,from,to,ned)
 INPUTS:
       oldstr -- string on which to operate.              in
                 May be an array.
       from   -- substrings to be translated. May be      in
                 an array.
       to     -- what strings in from should be           in
                 translated to. May be an array.
 KEYWORD PARAMETERS:
       /HELP  -- Set this to print useful message and 
                 exit.
 OUTPUTS:
       new    -- Translated string. Array if oldstr is    out          
                 an array.
       ned    -- number of substitutions performed in     out
                 oldstr.  Array if oldstr is an array.
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
       - Any of old, from, and to can be arrays.  
       - from and to must have the same number of elements.
 EXAMPLE:
       inp='Many*bad!chars+in_here'
       from=['*','!','+','_']
       to  =[' ',' ',' ',' ']
       out = textoidl_strtrans(inp,from,to,ned)
       Will produce out='Many bad chars in here', and set ned to 4.
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $

       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.7  2000/11/19 18:25:00  dfink / Jonathan Swift
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.3  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.2  1996/05/09 00:22:17  mcraig
       Sped up significantly by using str_sep to handle the translation.  No longer
       relies on routines fromother user libraries.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_SUB_SUP">
<H2>TEXTOIDL_SUB_SUP</H2></A>
<A HREF="#TEXTOIDL_STRTRANS">[Previous Routine]</A>
<A HREF="#TEXTOIDL_TABLE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_SUB_SUP
 PURPOSE:
       Return the proper IDL font positioning command for TeX
       sub/superscripts. 
 CATEGORY:
       TeXtoIDL
 CALLING SEQUENCE:
       fnt = textoidl_sub_sup( strn )
 INPUTS:
       strn      -- Either '^' or '_', the TeX super/subscript       in
                    characters
 KEYWORD PARAMETERS:
       /FORCE_UD -- Set this to use !U/!D instead of !E/!I for
                    sub/superscripts .
       /HELP     -- Set to print useful message and exit.
 OUTPUTS:
       fnt       -- Either '!U' or !E' for superscripts,             out
                    or '!D' or '!I' for subscripts.
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
       Used only by textoidl_trans_sub_super.  Should be kept in same
       file. 
 EXAMPLE:
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.4  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.3  1996/05/09 00:22:17  mcraig
       Changed some function calls to reflect changes in those functions, moved
       some code out of the main loop that didn't need to be there, added
       documentation.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $
 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_TABLE">
<H2>TEXTOIDL_TABLE</H2></A>
<A HREF="#TEXTOIDL_SUB_SUP">[Previous Routine]</A>
<A HREF="#TEXTOIDL_TRANS_SUB_SUPER">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_TABLE
 PURPOSE:
       Returns a translation table from TeX to IDL.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       table = textoidl_table()
 INPUTS:
       None
 KEYWORD PARAMETERS:
       /POSTSCRIPT -- If set, return postscript translation
                      table rather than vector fonts table.
                      Default is translations for vector
                      fonts.
       /HELP       -- Print help and exit.
 OUTPUTS:
       table -- a 2D text array.  table(0,*) contains          out
                the words to be translated away, table(1,*)
                contains the words to translate them to.   
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
       To find out what TeX sequences are available, look at
       table(0,*).
 EXAMPLE:
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $

       Revision 1.81 2018/03/08, eastman
       Rename to EXOFAST_TEXTOIDL, Remove \AA option, which is broken
       in IDL 8.7.

       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.7  1996/07/22 23:56:08  mcraig
       Added \vartheta.

       Revision 1.6  1996/07/12 21:31:42  mcraig
       Fixed \varphi in vector font, added \circ.

       Revision 1.5  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.4  1996/05/09 00:22:17  mcraig
       Added command to return to previous font after switching to Greek or
       symbol font.

       Revision 1.3  1996/02/08 19:49:35  mcraig
       Removed control sequence \perp because the postscript code for it is '^'.

       Revision 1.2  1996/02/08 18:53:38  mcraig
       Added translations for PostScript fonts, and added several new TeX
       control sequences.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TEXTOIDL_TRANS_SUB_SUPER">
<H2>TEXTOIDL_TRANS_SUB_SUPER</H2></A>
<A HREF="#TEXTOIDL_TABLE">[Previous Routine]</A>
<A HREF="#TRANSITGIF">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       TEXTOIDL_TRANS_SUB_SUPER
 PURPOSE:
       Translate TeX sub/superscripts to IDL sub/superscripts.
 CATEGORY:
       text/strings
 CALLING SEQUENCE:
       new = textoidl_trans_sub_super( old )
 INPUTS:
       old       -- string to be translated from TeX to IDL.   in
 KEYWORD PARAMETERS:
       /RECURSED -- set if this function is being called 
                    recursively.                  
       /HELP     -- Set to print useful message and exit.
 OUTPUTS:
       new       -- string old converted from TeX to IDL       out
 COMMON BLOCKS:
 SIDE EFFECTS:
 NOTES:
       - For best results, when both a sub and superscript are used,
         place the shorter of the two first (e.g. 'N^{a}_{bbbb}' is
         better than 'N_{bbbb}^{a}').
       - Single character sub/super scripts do not need to be
         protected by braces.
       - Sub/superscripts may be nested (e.g. 'N^{N_1^N}').
 EXAMPLE:
       out = textoidl_trans_sub_super( 'N^2_{big}' )
       Then out='N!U2!N!Dbig!N' which looks like it should on the
       display. 
 LIBRARY FUNCTIONS CALLED:
       textoidl_strtok      -- Text/string (mcraig)
       textoidl_sub_sup -- contained in this file
 MODIFICATION HISTORY:
       $Id: textoidl.pro,v 1.9 2007-08-28 17:04:45 blanton Exp $
       $Log: not supported by cvs2svn $
       Revision 1.8  2004/07/19 16:48:04  schlegel
       Replace calls to the obsolete function RSTRPOS() with STRPOS(/REVERSE_SEARCH).

       Revision 1.7  2000/11/20 02:27:24  dfink
       Added \AA option for Anstroms

       Revision 1.6  2000/07/12 14:31:33  hogg
       fixed another ()/[] bug.

       Revision 1.5  2000/06/15 18:21:23  hogg
       fixed tiny () -> [] bugs

       Revision 1.4  2000/06/03 17:12:42  dfink
       Fink's new textoidl - all procedures in one file; avoid name conflict

       Revision 1.4  1996/06/14 20:00:27  mcraig
       Updated Copyright info.

       Revision 1.3  1996/05/09 00:22:17  mcraig
       Changed some function calls to reflect changes in those functions, moved
       some code out of the main loop that didn't need to be there, added
       documentation.

       Revision 1.2  1996/02/08 18:54:20  mcraig
       Changed default sub/superscript size to be !D/!U rather than !I/!E to
       improve readability of plat annotations.

       Revision 1.1  1996/01/31 18:47:37  mcraig
       Initial revision

 RELEASE:
       $Name: not supported by cvs2svn $

 COPYRIGHT:
  Copyright (C) 1996 The Regents of the University of California, All
  Rights Reserved.  Written by Matthew W. Craig.
  See the file COPYRIGHT for restrictions on distrubting this code.
  This code comes with absolutely NO warranty; see DISCLAIMER for details.
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_textoidl.pro)</STRONG><P>
<HR>
 
<A NAME="TRANSITGIF">
<H2>TRANSITGIF</H2></A>
<A HREF="#TEXTOIDL_TRANS_SUB_SUPER">[Previous Routine]</A>
<A HREF="#UPDATETIME">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   TRANSITGIF

 PURPOSE: 
   Creates an animated gif of a transit from exoplanets.org.

 CALLING SEQUENCE:
   TRANSITGIF, ['pname',PARS=,BAND=,CADENCE=,PARS=,YMIN=,BAK=,
                /YELLOW,/DISPLAY,/SAVEFRAMES,/UPDATE]

 OPTIONAL INPUTS:
   PNAME     - The name of the planet from exoplanets.org (not case
               sensitive). The output file will be the planet name
               stripped of spaces + .gif. 
   PARS      - A 10 element array of custom parameters with which to
               make a transit animation:
                PARS[0] = period (days)
                PARS[1] = eccentricity
                PARS[2] = omega_star (radians)
                PARS[3] = inclination (radians)
                PARS[4] = a/Rstar 
                PARS[5] = Rp/Rstar
                PARS[6] = logg (cgs)
                PARS[7] = Teff (K)
                PARS[8] = [Fe/H]
                PARS[9] = Rstar (R_sun)
               NOTE: PNAME or PARS must be specified. If PARS is
               specified and PNAME is not, the output will be "transit.gif".
   BAND      - The bandpass for the limb darkening calculation (see
               quadld.pro for allowed values). Default = 'Sloanz'
   CADENCE   - A frame is generated every CADENCE minutes for a
               duration of 2*T_FWHM*MAXSTAR/RSTAR. This duration
               forces the X axis of the plot to be on the same scale as
               the drawing, ignoring the curvature of the planet's orbit.
               Default = 5.
               NOTE: A constant cadence between animations means the
               duration of the animation (number of frames)
               corresponds to the duration of the transit.
   NPOINTS   - The number of pixels in the image of the star. Larger
               images may break the conversion to gif.
               Default = 299. 
   YMIN      - The minimum of transit plot. Default is 0.985
               NOTE: A constant minimum makes the plots to scale from
               animation to animation, but this default cuts off some
               deeper planets.
   BAK       - A 3-element array containing the RGB values of the
               background color. Default is [135,206,250]; (sky blue)
               Use [255,255,255] for white.
   MAXSTAR   - The size of the maximum star, in R_sun. A star of this
               size will be centered left/right and span the top half of
               the image. The total image is 4*MAXSTAR
               square. Keeping MAXSTAR the same (positive value)
               for multiple animations means they will be to
               scale. Default = 1.5.
               Numbers between -1 and 0 are interpreted as a
               fractions of RSTAR (e.g, -1 ensures the star will take
               up the entire range; -0.9 leaves a nice margin). Negative
               numbers are useful if you're making a single
               animation and want it to fit nicely.
               NOTE: If the Rstar is larger than MAXSTAR, it will
               produce an error.
 OPTIONAL KEYWORDS:
   YELLOW     - Makes the star yellow and the planet black, instead of
                their color temperatures. 
                NOTE: Output file is then PNAME.yellow.gif
   DISPLAY    - Spawns firefox to display the animated gif.
   SAVEFRAMES - The individual PNG frames are deleted upon
                completion. Set this keyword to keep them.
   UPDATE     - Update the local copy of exoplanets.csv

 OUTPUTS:
  pname.gif - An animated gif of the transit.

 EXAMPLES:  
   ;; creates an animation of HAT-P-3b, called 'HAT-P-3b.gif'
   transitgif, 'HAT-P-3b'

   ;; creates an animation Earth, called 'transit.gif'
   pars = [365.242199d0,0.01671123d0,!dpi/2d0,!dpi/2d0,215.094177d0,$
           0.0091705248d0,4.43834417d0,5778d0,0d0,1d0]
   transitgif, pars=pars

   ;; creates an animation of Jupiter, called "Jupiter.gif'
   transitgif, 'Jupiter',pars=[4332.59d0,0.048498,!dpi/2d0,!dpi/2d0,215.094177d0*5.20260d,0.102792236d0,4.43834417d0,5778d0,0d0,1d0]

   ;; Creates animations for all transiting exoplanets from exoplanets.org
   planets = readexo(/update)
   transit = where(planets.transit,ntransits)
   for i=0, ntransits-1 do $
      transitgif, strcompress(planets.name[transit[i]],/remove_all),$
      maxstar=max(double(planets.rstar[transit])), band='Sloanz',$
      ymin=1d0-max(double(planets.depth[transit]))

 DEPENDENCIES:
   convert. While IDL can write animated gifs directly,
   they're only 8 bit. In color, that creates unsightly
   ringing, so we use convert instead.
   EXOFAST (http://astroutils.astronomy.ohio-state.edu/exofast/)

 MODIFICATION HISTORY
   2012/06 -- Public Release, Jason Eastman (LCOGT)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/transitgif.pro)</STRONG><P>
<HR>
 
<A NAME="UPDATETIME">
<H2>UPDATETIME</H2></A>
<A HREF="#TRANSITGIF">[Previous Routine]</A>
<A HREF="#WAVELETLIKE">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
   UPDATETIME

 NOTE: READ THE DOCUMENTATION -- ITS USE IS EASY TO GET WRONG!!!!

 PURPOSE:
   This function updates three files required to maintain the most
   precise time. These files are used by EXOFAST and related codes.

   1) The leap second file, updates whenever there is a new leap
      second. Typically every ~6 months. It is requires for ~1 second
      precision.

   2) The IERS file keeps track of meausured changes in the
      Earth's rotation and is required for ms precision.

   3) The BIPM file tracks the difference between TT(TAI) and
      TT(BIPM) and is required for microsecond precison. Note that
      this can only be done precisely months after the time in
      question.

 NOTE:
   There are no requirements that these files are maintained in a
   backward compatible way. Changes to the source file formats or
   file locations may occur, which could break this code. Care should
   be taken to ensure this function is operating as intended. We will
   update it as required, but may be slow to identify such
   changes. Please email me (jason.eastman@cfa.harvard.edu) if the
   most up to date version does not work.

 CALLING SEQUENCE:
   updatetime

 NOTE: The files this code grabs update regularly. This function
 should be run at least monthly. The easiest way to ensure this is to
 set it up as a cronjob by adding a line like this in your crontab:

   0 0 15 * * . /h/onion0/.bashrc ; idl -e "updatetime"

 ****** BE SURE TO TEST THIS! IT IS TRICKIER THAN IT SEEMS ******

 The first part
   0 0 15 * * 
 will run it at midnight on the 15th of every month. You may wish to
 randomize the day and time to distribute the load on their FTP
 server. The second part
   . /h/onion0/.bashrc 
 sources a bashrc file that defines the required environment
 variables ($ASTRO_DATA, $IDL_PATH, and $PATH). Just because it works
 in your terminal does not mean it will work inside crontab. You must
 change it so it sources your profile file. If your crontab shell is
 different than your usual shell, you may need to write a new profile
 file for your crontab. The last part
   idl -e "updatetime"
 runs this program. idl must be in your $PATH for this to work (or
 you can specify the full path to IDL in the call). 

 DEPENDENCIES:
   You must have the $ASTRO_DATA environment variable set. This is
   the directory where the files will be copied.

 REVISION HISTORY:
   2021/04/13 - Updated and documented, Jason Eastman (CfA)
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/updatetime.pro)</STRONG><P>
<HR>
 
<A NAME="WAVELETLIKE">
<H2>WAVELETLIKE</H2></A>
<A HREF="#UPDATETIME">[Previous Routine]</A>
<A HREF="#WEBGET()">[Next Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME:
       WAVELETLIKE
 PURPOSE:
       Calculates the (log) likelihood for a given vector to be
       described for parameters sigma_r and sigma_w as 1/f noise plus
       white noise as detailed by Carter & Winn (2009)

 CALLING SEQUENCE:
       result = waveletlike(x, sigma_r, sigma_w)

 INPUTS:
       X - Data vector, must be a power of two
       SIGMA_R - Red noise amplitude parameter (not equal to
                 1/f-component RMS)
       SIGMA_W - White noise amplitude parameter (approximately equal
                 to white-component RMS)

 OUTPUTS:
       RESULT - log(likelihood) as defined in Eqn. (32) of Carter &
                Winn (2009)

 NOTES:
       Refer to the paper by Carter & Winn (2009) for theory and
       details.  In the notation of that paper, gamma=1 for this
       algorithm.

 REVISION HISTORY:
       Written,    J. Carter               September, 2009
       Removed inner for loop (~7x speed gain). JDE, Dec 2012
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/exofast_wavelike.pro)</STRONG><P>
<HR>
 
<A NAME="WEBGET()">
<H2>WEBGET()</H2></A>
<A HREF="#WAVELETLIKE">[Previous Routine]</A>
<A HREF="#ROUTINELIST">[List of Routines]</A>
<PRE>
 NAME: 
    WEBGET()

 PURPOSE: 
    Use the IDL SOCKET procedure to get data from http servers

 EXPLANATION: 
     WEBGET() can access http servers - even from behind a firewall - 
     and perform simple downloads. Currently, text and FITS files can be 
     accessed.    

     The IDLNetURL object is a much more robust way of 
     transferring files across the Web.     However, WEBGET() is still
     useful for opening a remote file unit (e.g. a FITS file) and 
     processing it 

 CALLING SEQUENCE: 
      a=webget(URL)

 INPUTS: 
      URL - scalar string giving a fully qualified url of the form
          'http://server.eso.org/path/file.html'.    WEBGET() can
          also use other valid URLs that contain 'GET' or 'POST' codes.

 OPTIONAL INPUT KEYWORD PARAMETERS: 
       COPYFILE - if set to a valid filename (file must have write permission),
            the data contents of the web server's answer is copied to that 
            file.
       HTTP10 - If set, then use the HTTP 1.0 
       POST - if set to a structure, the structure tags and values
              will be used as post variables and POST'ed to the URL.
              If POST is not set, the normal HTTP GET is used to
              retrieve the URL.
       /SILENT - If set, the information error messages are suppressed
       TIMEOUT - Integer scalar giving number of seconds to wait to connect 
                or for data to arrive before giving up and issuing an error.
                Default=15 seconds 
 OUTPUTS: A structure with the following fields:

            .Header - the HTTP header sent by the server

            .Text   - The text part of the downloaded file. If the
                     content type of the file was not of class
                     'text',  this will be an empty string.

            .ImageHeader - Header file of a FITS-image. FITS images
                          are read when the content type is
                          'image/fits' or 'application/octet-stream'
                          (for dss-access). If the file is not a FITS
                          image,  this will be an empty string.

            .Image - The FITS image read from the server. If the file
                    did not contain a FITS image,  this will be zero.


 RESTRICTIONS: 
     The mime-type recognition is extremely limited. Only the content-type is 
     determined. Any text-file  will be stored in out.Text. The only other 
     category which can be fetched is FITS files,  which will be stored in 
     out.Image and out.ImageHeader.

     PROXY: If you are behind a firewall and have to access the net through a 
         Web proxy,  set the environment variable 'http_proxy' to point to 
         your proxy server and port, e.g. 
         'setenv http_proxy=http://web-proxy.mpia-hd.mpg.de:3128'

               The URL *MUST* begin with "http://".

 PROCEDURE: 
     Open a socket to the webserver and download the header. After deciding 
     whether it is text or binary, either store the text or try to read a 
     FITS file.

 EXAMPLE: 
      IDL> a=webget('http://www.mpia.de/index.html')
      IDL> print,a.Text
      or

          > PointingRA=0.0
          > PointingDE=30.0
          > QueryURL = strcompress("http://archive.eso.org/dss/dss/image?ra="+$
          >                          string(PointingRA)+$
          >                          "&dec="+$
          >                          string(PointingDE)+$
          >                          "&x=10&y=10&Sky-Survey=DSS1&mime-type=download-fits", $
          >                          /remove)
          > a=webget(QueryURL)
          > tvscl,a.Image
          > print,a.ImageHead


 MODIFICATION HISTORY: 
     Written by M. Feldt, Heidelberg, Oct 2001 <mfeldt@mpia.de>
     Use /swap_if_little_endian keyword to SOCKET  W. Landsman August 2002
     Less restrictive search on Content-Type   W. Landsman   April 2003
     Modified to work with FIRST image server-  A. Barth, Nov 2006
     Better recovery from errors  W. Landsman  April 2007
     Add support for POST access               J.D. Smith    June 2007
     Recognize "fits" image type used by SKYVIEW   W. Landsman  June 2007
     Upgraded, partially, to HTTP 1.1				M. Perrin, July 2007
       The HTTP 1.1 support is presently INCOMPLETE: virtual servers are
       supported, but chunked transfer encoding is not yet supported, so
       technically this is not fully HTTP 1.1 compliant.
     Added http10 keyword  W. Landsman   August 2007
     Assume since V5.6, sockets always available  W. Landsman Nov 2007
     Fix problem when using proxy server   W. Landsman July 2008
     Fix problem with /SILENT keyword  W. Landsman  Jan 2009
     Added check for missing Mime TYPE in CLASSANDTYPE, Zarro, December 2011
     Timeout applies to connecting as well as reading, default is now 15
               seconds  W Landsman January 2012
     Allow http_proxy to be upper or lower case W.L./D. Palmer Feb 2013
</PRE><P>
<STRONG>(See /h/onion0/scratch/EXOFASTv2/webget.pro)</STRONG><P>
<HR>
 
</body>
</html>
